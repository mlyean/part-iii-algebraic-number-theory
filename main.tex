\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper]{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{array}
\usepackage{bbm}
\usepackage{chngcntr}
\usepackage{commath}
\usepackage{comment}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{stmaryrd}
\usepackage{thmtools}
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{titlesec}
\usepackage{mathtools}

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{example}[definition]{Example}
\newtheorem*{example*}{Example}
\newtheorem{notation}[definition]{Notation}
\newtheorem*{fact}{Fact}

\theoremstyle{plain}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{proposition}[definition]{Proposition}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{corollary}[definition]{Corollary}

\theoremstyle{remark}
\newtheorem{remark}[definition]{Remark}
\newtheorem*{remark*}{Remark}

\renewcommand{\qedsymbol}{$\blacksquare$}

\let\Re\undefined
\let\Im\undefined
\DeclareMathOperator{\Re}{Re}
\DeclareMathOperator{\Im}{Im}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Cl}{Cl}
\DeclareMathOperator{\res}{res}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\mult}{mult}
\DeclareMathOperator{\Frob}{Frob}

\newcommand{\xrightarrowdbl}[2][]{%
  \xrightarrow[#1]{#2}\mathrel{\mkern-14mu}\rightarrow
}

\newcommand{\bA}{\mathbb{A}}
\newcommand{\II}{\mathbb{I}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\cC}{\mathcal{C}}
\newcommand{\cD}{\mathcal{D}}
\newcommand{\cO}{\mathcal{O}}
\newcommand{\cp}{\mathfrak{P}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\cN}{\mathcal{N}}
\newcommand{\fa}{\mathfrak{a}}
\newcommand{\fd}{\mathfrak{d}}
\newcommand{\ff}{\mathfrak{f}}
\newcommand{\fp}{\mathfrak{p}}
\newcommand{\fq}{\mathfrak{q}}
\newcommand{\fm}{\mathfrak{m}}
\newcommand{\fn}{\mathfrak{n}}
\newcommand{\rprod}{\mathrlap{\prod}{\coprod}}
\newcommand{\leg}[2]{\left(\frac{#1}{#2}\right)}
\newcommand{\subsetdot}{\stackrel{\centerdot}{\subset}}
\newcommand{\eqdot}{\stackrel{\centerdot}{=}}
\newcommand{\ab}{\mathrm{ab}}
\newcommand{\sep}{\mathrm{sep}}

\setlist[enumerate,1]{label=\arabic*), nosep}
\setlist[enumerate,2]{label=\roman*), nosep}
\setlist[itemize,1]{nosep}

% Uncomment to exclude proofs
% \excludecomment{proof}

\title{Part III Algebraic Number Theory Lecture Notes}
\author{Ming Yean Lim}

\begin{document}

\maketitle

\noindent These lecture notes were based on the Part III course Algebraic Number Theory taught during Lent 2023 by Dr. Hanneke Wiersema.

This is not a faithful copy of what was on the board in lectures, although I have tried to maintain the same numbering. {\color{blue} Text in blue are my own additions.}

\tableofcontents

\newcommand{\sectionbreak}{\clearpage}

\section{Introduction} % No section title was given
\marginpar{\fbox{Lecture 1}}

\subsection{Recap of Algebraic Number Theory}

Let $K$ be a number field, $\cO_K$ the ring of integers of $K$. Let $L/K$ be a finite extension of number fields. Let $\fp$ be a prime ideal of $\cO_K$, then $\fp \cO_L$ is an ideal in $\cO_L$, and factors as $\fp \cO_L = \cp_1^{e_1} \ldots, \cp_g^{e_g}$, where $\cp_i$ are distinct primes ideals of $\cO_L$.

Suppose $\cp \subseteq \cO_L$. If $\cp \mid \fp \cO_L$, then we say that $\cp$ \emph{lies above} $\fp$, or $\fp$ \emph{lies under} $\cp$. Note that
\begin{equation*}
    \cp \mid \fp \cO_L \iff \fp = \cp \cap \cO_K \iff \fp \subseteq \cp
\end{equation*}

The $e_i = e_{\cp_i / \fp}$ is called the \emph{ramification index} of $\cp_i$ over $\fp$. We say that $\fp$ \emph{ramifies} in $L$ if $e_i > 1$ for some $i$.

For $\cp \subseteq \cO_L$, write $k_\cp = \cO_L / \cp$ for the corresponding residue field. Similarly, set $k_\fp = \cO_K / \fp$.

If $\cp \mid \fp$, we have an extension of residue fields $k_\cp / k_\fp$. The degree of this extension is called the \emph{inertial degree} of $\cp$ over $\fp$, denoted $f = f_{\cp / \fp}$.

\begin{theorem}\label{thm:1_1}
    Let $\fp \subseteq \cO_K$ and $\fp \cO_L = \cp_1^{e_1} \ldots \cp_g^{e_g}$ as above. Then
    \begin{equation*}
        [L : K] = \sum_{i=1}^g e_i f_i
    \end{equation*}
\end{theorem}

\subsubsection*{Galois Extensions}

Let $L/K$ be Galois.

\begin{theorem}\label{thm:1_2}
    Let $\fp \subseteq \cO_K$ be a prime ideal.
    \begin{enumerate}
        \item The Galois group $\Gal(L/K)$ acts transitively on primes of $\cO_L$ lying above $\fp$, i.e. if $\cp, \cp' \mid \fp$, then there is a $\sigma \in \Gal(L/K)$ such that $\sigma(\cp) = \cp'$.

        \item Primes $\cp_1, \ldots, \cp_g$ of $\cO_L$ lying above $\fp$ have the same ramification index $e$ and inertial degree $f$, so that $[L : K] = e f g$.
    \end{enumerate}
\end{theorem}

\noindent Let $\cp \subseteq \cO_L$ be such that $\cp \mid \fp$.

\begin{definition}\label{def:1_3}
    The \emph{decomposition group} of $\cp$ is
    \begin{equation*}
        D_{\cp / \fp} = \{\sigma \in \Gal(L/K) \mid \sigma(\cp) = \cp\}
    \end{equation*}
    and the \emph{inertial group} is
    \begin{equation*}
        I_{\cp / \fp} = \{\sigma \in \Gal(L/K) \mid \forall \alpha \in \cO_L, \sigma(\alpha) \equiv \alpha \pmod{\cp}\}
    \end{equation*}
    Note that $I_{\cp/\fp} \subseteq D_{\cp/\fp}$.
\end{definition}

The extension of residue fields $k_\cp / k_\fp$ is Galois. Each $\sigma \in D_{\cp / \fp}$ induces an automorphism $\widetilde{\sigma}$ on $k_\cp$, which is the identity on $k_\fp$. We have a map $D_{\cp / \fp} \to \Gal(k_\cp / k_\fp)$, $\sigma \mapsto \widetilde{\sigma}$.

\begin{proposition}\label{prop:1_4}\phantom{}
    \begin{enumerate}
        \item $\Gal(k_\cp / k_\fp)$ is a cyclic group with canonical generator the Frobenius automorphism $x \mapsto x^q$, where $q = \abs{\cO_K / \fp}$.

        \item We have a surjective homomorphism $D_{\cp / \fp} \to \Gal(k_\cp / k_\fp)$, $\sigma \mapsto \widetilde{\sigma}$ with kernel $I_{\cp / \fp}$.

        \item $\abs{I_{\cp / \fp}} = e_{\cp / \fp}$, $\abs{D_{\cp / \fp}} = e_{\cp / \fp} f_{\cp / \fp}$.
    \end{enumerate}
\end{proposition}

\subsection{The Artin Symbol}

\begin{lemma}\label{lem:1_5}
    Let $L/K$ be Galois, and $\fp \subseteq \cO_K$ unramified in $L$. Suppose $\cp \subseteq \cO_L$ is such that $\cp \mid \fp$. Then there exists a unique $\sigma \in \Gal(L/K)$ such that for all $\alpha \in \cO_L, \sigma(\alpha) \equiv \alpha^{N(\fp)} \pmod{\cp}$, where $N(\fp) = \abs{\cO_K / \fp}$.
\end{lemma}
\begin{proof}
    By \autoref{prop:1_4}, since $\fp$ is unramified, $\abs{I_{\cp / \fp}} = 1$, and so $D_{\cp / \fp} \cong \Gal(k_\cp / k_\fp)$. Let $\sigma \in D_{\cp / \fp}$ be the unique element mapping to the Frobenius automorphism $x \mapsto x^q$. Note that $q = N(\fp)$, so we find that
    \begin{equation}\label{eqn:1_5_star}
        \sigma(\alpha) \equiv \alpha^{N(\fp)} \pmod{\cp} \qquad \forall \alpha \in \cO_L
    \end{equation}
    Note that any $\sigma \in \Gal(L/K)$ satisfying \eqref{eqn:1_5_star} is an element of $D_{\cp / \fp}$, so uniqueness follows.
\end{proof}

\begin{definition}\label{def:1_6}
    The unique element from \autoref{lem:1_5} is called the \emph{Artin symbol}, denoted $\leg{L/K}{\cp}$.
\end{definition}

\begin{corollary}\label{cor:1_7}
    Let $L/K$ be Galois, $\fp \subseteq \cO_K$ unramified, $\cp \subseteq \cO_L$ lying above $\fp$. Then
    \begin{enumerate}
        \item $\leg{L/K}{\sigma(\cp)} = \sigma \leg{L/K}{\cp} \sigma^{-1}$ for all $\sigma \in \Gal(L/K)$;

        \item The order of $\leg{L/K}{\cp}$ is $f = f_{\cp / \fp}$;

        \item $\fp$ splits completely in $L$ if and only if $\leg{L/K}{\cp} = 1$.
    \end{enumerate}
\end{corollary}
\begin{proof}\phantom{}
    \begin{enumerate}
        \item Follows from uniqueness of the Artin symbol, for details see Example Sheet 1 Exercise 1.

        \item Since $\abs{I_{\cp / \fp}} = 1$, we have $D_{\cp / \fp} \cong \Gal(k_\cp / k_\fp)$. The Artin symbol maps to a generator of $\Gal(k_\cp / k_\fp)$, which has order $f_{\cp / \fp}$.

        \item Note that $\fp$ splits completely in $L$ means that $e = f = 1$. Since $\fp$ is unramified, $e = 1$. Thus by $2)$, $\leg{L/K}{\cp} = 1$ if and only if $f = 1$. \qedhere
    \end{enumerate}
\end{proof}

\begin{definition}\label{def:1_8}
    We say $L/K$ is an \emph{abelian extension} if $L/K$ is Galois with abelian Galois group.
\end{definition}

If $L/K$ is abelian, then $\leg{L/K}{\cp}$ depends only on $\fp$: Let $\cp' \subseteq \cO_L$ be a prime lying over $\fp$. Then $\cp' = \sigma(\cp)$ for some $\sigma \in \Gal(L/K)$ by \autoref{thm:1_2}. Then
\begin{equation*}
    \leg{L/K}{\cp'} = \leg{L/K}{\sigma(\cp)} = \sigma \leg{L/K}{\cp} \sigma^{-1} = \leg{L/K}{\cp}
\end{equation*}
by \autoref{cor:1_7}.

\begin{notation}\label{not:1_9}
    If $L/K$ is abelian, write $\leg{L/K}{\fp}$ for the Artin symbol for any $\cp \mid \fp$.
\end{notation}

\begin{example}\label{eg:1_10}
    Let $K = \QQ$, $L = \QQ(\sqrt{d})$, where $d \in \ZZ$ is squarefree. Recall that the discriminant is
    \begin{equation*}
        D = D_{L/K} =
        \begin{cases}
            d &\text{if } d \equiv 1 \pmod{4}\\
            4d &\text{otherwise}
        \end{cases}
    \end{equation*}
    and that $\fp = (p)$ ramifies in $L$ if and only if $p \mid D$. Identify $\Gal(L/K)$ with the multiplicative group $\{\pm 1\}$. Let $(p)$ be unramified. Then
    \begin{equation*}
        \leg{\QQ(\sqrt{d}) / \QQ}{(p)} = \leg{D}{p}
    \end{equation*}
    where $\leg{D}{p}$ is the Kronecker symbol. {\color{blue} This can be seen for example by \autoref{cor:1_7}}
\end{example}

\section{The Artin Map} % No section title was given
\marginpar{\fbox{Lecture 2}}

\subsection{Some Background and Recap}

\begin{definition}\label{def:2_1}
    A \emph{fractional ideal} of $K$ is a non-zero $\cO_K$-submodule $\fa$ of $K$ such that there is a non-zero $x \in \cO_K$ such that $x \fa \subseteq \cO_K$.
\end{definition}

\begin{notation}\label{not:2_2}
    The set of fractional $\cO_K$-ideals is a group, which we denote by $I_K$. We write $P_K$ for the subgroup of principal fractional ideals.
\end{notation}

\begin{remark}\label{rem:2_3}
    Recall that for any $\fa \in I_K$, we have a unique prime factorisation
    \begin{equation}\label{eqn:2_3_fact}
        \fa = \prod_{i=1}^r \fp_i^{r_i}
    \end{equation}
    where $r_i \in \ZZ$, and the $\fp_i$'s are distinct prime ideals of $\cO_K$.
\end{remark}

\subsection{The Artin Map for Unramified Extensions}
We will extend the Artin symbol to non-prime ideals, in particular, we can use the above factorisation to extend it to any $\fa \in I_K$.

\begin{definition}\label{def:2_4}
    Suppose $L/K$ is abelian and unramified, then we define the \emph{Artin map} to be the homomorphism $\leg{L/K}{\cdot} : I_K \to \Gal(L/K)$ by setting
    \begin{equation}\label{eqn:2_4_star}
        \leg{L/K}{\fa} = \prod_{i=1}^r \leg{L/K}{\fp_i}^{r_i}
    \end{equation}
    for $\fa$ with factorisation \eqref{eqn:2_3_fact}.
\end{definition}

\subsection{The Artin Map for Abelian Extensions}

If $L/K$ is ramified, we can define the Artin symbol for unramified primes, but not all primes. To define the Artin map, we work with a subgroup of $I_K$.

\begin{definition}[Modulus]\label{def:2_5}
    Let $K$ be a number field, then a \emph{modulus} in $K$ is a formal product
    \begin{equation*}
        \fm = \prod_\fp \fp^{n_\fp}
    \end{equation*}
    over all primes $\fp$, finite and infinite\footnote{see the section on finite and infinite primes later}, such that
    \begin{enumerate}
        \item $n_\fp \ge 0$ and at most finitely many are non-zero;
        \item $n_\fp = 0$ if $\fp$ is a complex infinite prime;
        \item $n_\fp \le 1$ is $\fp$ is a real infinite prime.
    \end{enumerate}
    When all exponents $n_\fp = 0$, then we set $\fm = 1$.
\end{definition}

\begin{example}\label{eg:2_6}
    If $K$ is a purely imaginary field, i.e. a number field that cannot be embedded into $\RR$, then a modulus is just an ideal of $\cO_K$.
\end{example}

\begin{definition}\label{def:2_7}
    Let $\fm$ be a modulus, we define $I_K(\fm)$ to be the group of all fractional $\cO_K$-ideals of $\cO_K$ are relatively prime to $\fm$.
\end{definition}

For any $\fm$, we can write $\fm = \fm_0 \fm_\infty$, where $\fm_0$ is the finite part, and $\fm_\infty$ is the infinite part. A fractional ideal $\fa$ being relatively prime to $\fm$ means primes occurring in $\fm_0$ do not occur in the factorisation of $\fa$.

\begin{example}\label{eg:2_8}
    If $\fm = 1$, then $I_K(\fm) = I_K$.
\end{example}

\begin{example}\label{eg:2_9}
    If $K = \QQ$, $\fm = (m)$ where $m$ is any integer, then
    \begin{equation*}
        I_\QQ(\fm) = \bigg\{ \frac{a}{b}\ZZ \,\bigg\vert\, (a, m) = (b, m) = 1 \bigg\}
    \end{equation*}
\end{example}

Let $L/K$ be abelian. Let $\fm$ be a modulus of $K$ that is divisible by all ramified primes of $K$, then for each $\fp$ in $I_K(\fm)$, we can define the Artin symbol $\leg{L/K}{\fp} \in \Gal(L/K)$.

\begin{definition}\label{def:2_10}
    Let $\fm$ be as above, then the \emph{Artin map} for $L/K$ and $\fm$ is a homomorphism $\Phi_{\fm} : I_K(\fm) \to \Gal(L/K)$ defined by extending the Artin symbol multiplicatively as in \eqref{eqn:2_4_star}.
\end{definition}

\begin{example}\label{eg:2_11}
    Let $\fm$ be a positive integer, $\zeta_m$ a primitive $m$\textsuperscript{th} root of unity. Let $K = \QQ$, $L = \QQ(\zeta_m)$. Recall that
    \begin{enumerate}
        \item $\Gal(\QQ(\zeta_m) / \QQ) \cong (\ZZ / m \ZZ)^\times$, where the isomorphism sends $\sigma : \zeta_m \mapsto \zeta_m^h$ to $[h]$, where $[h] = h \pmod{m}$;
        \item If a prime $p$ ramifies in $\QQ(\zeta_m)$, then $p \mid m$.
    \end{enumerate}
    Write $\infty$ for the real infinite prime of $\QQ$. Let $\fm = (m) \infty$. Then $\fm$ contains all ramified primes, so we have a well-defined map $\Phi_\fm : I_\QQ(\fm) \to \Gal(\QQ(\zeta_m) / \QQ)$.

    {\color{blue}
        Fix a prime $p \nmid m$. Let $\sigma \in \Gal(\QQ(\zeta_m) / \QQ)$ be such that $\sigma(\zeta_m) = \zeta_m^p$. By the uniqueness in \autoref{lem:1_5}, we have $\leg{\QQ(\zeta_m) / \QQ}{p} = \sigma$, so $\Phi((p)) = [p] \in (\ZZ / m \ZZ)^\times$.
    }

    Let $\frac{a}{b}\ZZ \in I_\QQ(\fm)$, then $\Phi_\fm(\frac{a}{b} \ZZ) = [a][b]^{-1} \in (\ZZ / m \ZZ)^\times$.
    The map is clearly surjective.
\end{example}

\subsection{Generalised Ideal Class Group}

\begin{definition}\label{def:2_12}
    Let $P_K(\fm)$ be the subgroup of $I_K(\fm)$ consisting of all principal fractional ideals $(\alpha)$, where $\alpha \in K^\times$ is such that
    \begin{itemize}
        \item $v_\fp(\alpha - 1) \ge v_\fp(\fm_0) = n_\fp$ for any $\fp \mid \fm_0$;
        \item $\sigma(\alpha) > 0$ for every real infinite prime $\sigma \mid \fm_\infty$.
    \end{itemize}
\end{definition}
{\color{blue}
    $P_K(\fm)$ is indeed a subgroup of $I_K(\fm)$: If $\alpha, \beta \in K^\times$ are such that $v_\fp(\alpha - 1), v_\fp(\beta - 1) \ge n_\fp \ge 1$, then $v_\fp(\alpha \beta - 1) = v_\fp((\alpha - 1)\beta + (\beta - 1)) \ge \min\{v_\fp(\alpha - 1), v_\fp(\beta - 1)\} \ge n_\fp$, since $v_\fp(\beta - 1) \ge 1$ implies $v_\fp(\beta) = 0$.
}

\begin{example}\label{eg:2_13}
    Let $\fm = 1$, then $P_K(\fm) = P_K$.
\end{example}

\begin{example}\label{eg:2_14}
    Let $K = \QQ$, $\fm = (m)$. Note a fractional ideal $(\alpha)$ is generated by both $+\alpha$ and $-\alpha$. If $(\alpha) \in P_\QQ(\fm)$, then we must have $v_p(\alpha - 1) \ge v_p(m)$ for $p \mid m$, so
    \begin{equation*}
        P_\QQ(\fm) = \bigg\{\frac{a}{b}\ZZ \in I_\QQ(\fm) \,\big\vert\, a \equiv b \pmod{m}\bigg\}
    \end{equation*}

    \noindent Next let $\fm' = (m) \infty$, then $I_\QQ(\fm') = I_\QQ(\fm')$, but $P_\QQ(\fm) \neq P_\QQ(\fm')$, as
    \begin{equation*}
        P_\QQ(\fm') = \bigg\{\frac{a}{b}\ZZ \in I_\QQ(\fm) \,\big\vert\, a \equiv b \pmod{m},\, \frac{a}{b} > 0\bigg\}
    \end{equation*}
\end{example}

\begin{remark}\label{remark:2_15}
    In the setting of \autoref{eg:2_11}, we have $\ker \Phi_\fm = P_\QQ(\fm)$ for $\fm = (m) \infty$.
\end{remark}

The group $P_K(\fm)$ for any $K$ or $\fm$ is sometimes called a \emph{ray}, or the \emph{ray group}.

\begin{proposition}\label{prop:2_16}
    The subgroup $P_K(\fm)$ has finite index in $I_K(\fm)$.
\end{proposition}
\begin{proof}
    Omitted, a special case will be an exercise.
\end{proof}

\subsubsection*{Interlude -- Finite an Infinite Primes}
\marginpar{\fbox{Lecture 3}}
A \emph{finite prime} is a prime ideal of $\cO_K$. An \emph{infinite prime} is determined by embeddings of $K \hookrightarrow \CC$.
\begin{itemize}
    \item A \emph{real infinite prime} is an embedding $K \hookrightarrow \RR$;
    \item A \emph{complex infinite prime} is a pair of complex conjugate embeddings $\sigma, \overline{\sigma} : K \hookrightarrow \CC$, $\sigma \neq \overline{\sigma}$.
\end{itemize}

\begin{remark*}
    Compare this with places or absolute values, archimedian and non-archimedian, from the Local Fields course.
\end{remark*}

\begin{example*}\phantom{}
    \begin{itemize}
        \item $\QQ$ has one real infinite prime, which is the identity.
        \item $\QQ(\sqrt{2})$ has two real infinite primes, determined by $\sigma(\sqrt{2}) = \sqrt{2}$ and $\sigma(\sqrt{2}) = -\sqrt{2}$.
        \item $\QQ(\sqrt{-2})$ has one pair of complex infinite primes, $\sigma(\sqrt{-2}) = \sqrt{-2}$ and $\overline{\sigma}(\sqrt{-2}) = -\sqrt{-2}$.
    \end{itemize}
\end{example*}

\begin{remark*}
    Let $L/K$ be an extension of number fields, an infinite prime $\sigma$ of $K$ ramifies in $L$ if $\sigma$ is real and extends to a complex prime of $L$.
\end{remark*}

\begin{example*}
    The real infinite prime of $\QQ$ is unramified in $\QQ(\sqrt{2})$, but ramified in $\QQ(\sqrt{-2})$.
\end{example*}

\noindent Now we return to the topic of generalised ideal class groups.

\begin{definition}\label{def:2_17}
    A subgroup $H \subseteq I_K(\fm)$ is a \emph{congruence subgroup} for $\fm$ if $P_K(\fm) \subseteq H \subseteq I_K(\fm)$.
\end{definition}

\begin{definition}\label{def:2_18}
    Let $H$ be a congruence subgroup for $\fm$. Then the quotient $I_K(\fm)/H$ is a \emph{generalised ideal class group}.
\end{definition}

\begin{definition}\label{def:2_19}
    The quotient $I_K(\fm)/P_K(\fm)$ is called the \emph{ray class group}.
\end{definition}

\begin{example}\label{eg:2_20}
    Let $\fm = 1$, $I_K(\fm)/P_K(\fm) = I_K/P_K = \Cl(K)$, where $\Cl(K)$ is the ideal class group of $K$.
\end{example}

\begin{proposition}\label{prop:2_21}
    Write $P_\fm \subseteq I_K(\fm)$ for the subgroup of principal fractional ideals that are relatively prime to $\fm$. Thern we have an exact sequence
    \begin{equation*}
        1 \longrightarrow P_\fm/P_K(\fm) \longrightarrow I_K(\fm)/P_K(\fm) \longrightarrow \Cl(K) \longrightarrow 1
    \end{equation*}
\end{proposition}

\begin{remark}\label{rem:2_22}
    In fact, writing $h_K(\fm) = \abs{I_K(\fm)/P_K(\fm)}$, we see that $h_K \mid h_K(\fm)$, where $h_K$ is the class number of $K$.
\end{remark}

\begin{remark}\label{rem:2_23}
    If we have any $\cO_K$-ideal $I$, then every ideal class in $\Cl(K)$ can be represented by an ideal coprime to $I$.

    {\color{blue}
        Indeed, let $\fa$ be a fractional ideal. By scaling, we may assume $\fa$ is an ideal. By the Chinese remainder theorem, there is an $x \in \cO_K$ such that for each $\fp \mid I$, $v_\fp(x) = v_\fp(\fa)$. Then $x^{-1} \fa$ is a fractional ideal coprime to $I$. Thus we may assume $v_\fp(\fa) = 0$ for all $\fp \mid I$. By the Chinese remainder theorem, we may pick $y \in \cO_K$ such that $v_\fp(y) = -v_\fp(\fa)$ if $v_\fp(\fa) < 0$ and $v_\fp(x) = 0$ if $\fp \mid I$. Then $y \fa$ is an ideal coprime to $I$, representing $\fa$.
    }
\end{remark}

\begin{proof}[Proof of \autoref{prop:2_21} (Sketch)]
    Let $\fa \in I_K(\fm)$. Define $h : I_K(\fm) \to \Cl(K)$ by $h(\fa) = [\fa] \in \Cl(K)$. This is a group homomorphism with kernel $P_\fm$, and is surjective by \autoref{rem:2_23}. Thus we have an exact sequence
    \begin{equation*}
        1 \longrightarrow P_\fm \longrightarrow I_K(\fm) \overset{h}{\longrightarrow} \Cl(K) \longrightarrow 1
    \end{equation*}
    Since $h$ is trivial on $P_K(\fm)$, we can rewrite this as
    \begin{equation*}
        1 \longrightarrow P_\fm/P_K(\fm) \longrightarrow I_K(\fm)/P_K(\fm) \longrightarrow \Cl(K) \longrightarrow 1 \qedhere
    \end{equation*}
\end{proof}

\begin{example}\label{eg:2_24}
    Let $K = \QQ$, and $m$ a positive integer. Then $I_\QQ((m))/P_\QQ((m)) \cong (\ZZ/m\ZZ)^\times / \{\pm 1\}$, and $I_\QQ((m)\infty)/P_\QQ((m)\infty) \cong (\ZZ/m\ZZ)^\times$ (c.f. \autoref{eg:2_9} and \autoref{eg:2_14}).

    Recall the Artin map $\Phi_\fm : I_\QQ(\fm) \to \Gal(\QQ(\zeta_\fm) / \QQ)$ for $\QQ(\zeta_m)/\QQ$ from \autoref{eg:2_11}, where $\fm = (m) \infty$. It is surjective with $\ker \Phi_\fm = P_\QQ(\fm)$, so we see that $I_\QQ(\fm)/P_\QQ(\fm) \cong \Gal(\QQ(\zeta_m)/\QQ) \cong (\ZZ/m\ZZ)^\times$.
\end{example}

\begin{remark}\label{rem:2_25}
    The idea of class field theory is that generalised ideal class groups are Galois groups of abelian extensions of $K$, and that the link is given by the Artin map.
\end{remark}

\noindent We need to know how the Artin map behaves in field towers:

\begin{proposition}\label{prop:2_26}
    Let $K \subseteq L \subseteq M$ be a tower of abelian extensions. Suppose $\fm$ contains all primes of $\cO_K$ that ramify in $M$. Then we have a commutative diagram
    \begin{equation*}
    \begin{tikzcd}
        I_K(\fm) \arrow[r, "\Phi_{M/K,\fm}"] \arrow[rd, "\Phi_{L/K,\fm}"'] & \Gal(M/K) \arrow[d, "\res"] & \sigma \arrow[d, mapsto]\\
                                                                           & \Gal(L/K) & \sigma \vert_L
    \end{tikzcd}
    \end{equation*}
\end{proposition}
\begin{proof}
    See Example Sheet 1 Exercise 6.
\end{proof}

\section{Statements of Global Class Field Theory}

\subsection{The Conductor}

\begin{lemma}\label{lem:3_1}
    Let $L/K$ be abelian, and let $\fm$ be a modulus containing all ramified primes (finite and infinite) of $K$. Let $\fn$ be another modulus with $\fm \mid \fn$. If $P_K(\fm) \subseteq \ker \Phi_\fm$, then $P_K(\fn) \subseteq \ker \Phi_\fn$.
\end{lemma}
\begin{proof}
    Since $\fm \mid \fn$, $P_K(\fn) \subseteq P_K(\fm)$, and $\Phi_\fn = \Phi_\fm \vert_{I_K(\fn)}$. Then
    \begin{equation*}
        P_K(\fn) \subseteq P_K(\fm) \cap I_K(\fn) \subseteq \ker \Phi_\fm \cap I_K(\fn) = \ker \Phi_\fn \qedhere
    \end{equation*}
\end{proof}

\noindent In the setting of the lemma, this means that if $\ker \Phi_\fm$ is a congruence subgroup for $\fm$, then so is $\ker \Phi_\fn$ for $\fn$.

The is one special modulus:

\begin{theorem}[The Conductor Theorem]\label{thm:3_2}
    Let $L/K$ be abelian, then there is a modulus $\ff(L/K)$ such that
    \begin{enumerate}
        \item a prime of $K$, finite or infinite, ramifies in $L$ if and only if it divides $\ff(L/K)$;
        \item if $\fm$ is a modulus divisible by all primes of $K$ that ramify in $L$, then $\ker \Phi_\fm$ is a congruence subgroup for $\fm$ if and only if $\ff(L/K) \mid \fm$.
    \end{enumerate}
    The modulus is uniquely determined by $L/K$, and is called the \emph{conductor} of $L/K$.
\end{theorem}

\begin{example}\label{eg:3_3}
    Let $K = \QQ$, and $L = K(\sqrt{d})$, with $d \in \ZZ$ squarefree. Then
    \begin{equation*}
        \ff(L/K) =
        \begin{cases}
            \abs{D} & \text{if } d>0\\
            \abs{D}\infty & \text{if } d<0
        \end{cases}
    \end{equation*}
    where $D$ is the discriminant of $L$, and $\infty$ is the real infinite prime of $\QQ$. %TODO: Explain
\end{example}

\begin{example}\label{eg:3_4}
\marginpar{\fbox{Lecture 4}}
    The conductor of the cyclotomic extensions $\QQ(\zeta_m)/\QQ$ is
    \begin{equation*}
        \ff(L/K) =
        \begin{cases}
            1 & \text{if } m \le 2\\
            (\frac{m}{2}) \infty &\text{if } m = 2n, n>1 \text{ odd}\\
            (m) \infty &\text{otherwise}
        \end{cases}
    \end{equation*}
    See Example Sheet 1 Question 7.
\end{example}

\begin{remark}\label{rem:3_5}
    The conductor is not always the product of ramified primes. In the example sheet, we will see an example of a cubic extensions $L/\QQ$ ramified only at $3$, but for $\fm = (3), (3)\infty$, $\ker(\Phi_{L/\QQ, \fm})$ is not a congruence subgroup, so $\ff(L/Q) \nmid (3)$ or $(3) \infty$.
\end{remark}

\subsection{Artin Reciprocity}

For each abelian extension $L/K$, $\Gal(L/K)$ is a generalised ideal class group:

\begin{theorem}\label{thm:3_6}
    Let $L/K$ be an abelian extension. Let $\fm$ be a modulus divisible by $\ff(L/K)$. Then the Artin map $\Phi_\fm : I_K(\fm) \to \Gal(L/K)$ is surjective, $\ker{\Phi_\fm}$ is a congruence subgroup, and we have an isomorphism $I_K(\fm)/\ker \Phi_\fm \cong \Gal(L/K)$ induced by $\Phi_\fm$.
\end{theorem}

We will next describe the kernel.

\begin{notation}\label{not:3_7}
    Write $N_{L/K} : I_L \to I_K$ for the norm map defined by
    \begin{equation*}
        \prod_i \cp_i^{n_i} \mapsto \prod_i \fp_i^{f_{\cp_i / \fp_i} n_i}
    \end{equation*}
    so in particular, if $\cp \mid \fp$, then $N_{L/K}(\cp) = \fp^{f_{\cp/\fp}}$.
\end{notation}

\begin{definition}\label{def:3_8}
    Let $L/K$ be abelian, $\fm$ a modulus divisible by $\ff(L/K)$. Then the \emph{norm group} (also known as \emph{Takagi group}) associated to $\fm$ is the congruence subgroup
    \begin{equation*}
        T_{L/K}(\fm) = N_{L/K}(I_L(\fm))P_K(\fm)
    \end{equation*}
    where $I_L(\fm) \subseteq I_L$ consists of fractional ideals that are coprime to $\fm \cO_L$.
\end{definition}

\begin{theorem}[Artin Reciprocity Continued]\label{thm:3_9}
    We have $\ker \Phi_\fm = T_{L/K}(\fm)$.
\end{theorem}

We will prove surjectivity of $\Phi_\fm$ using density theorems later in the course. The proof of the following will be given later:

\begin{proposition}\label{prop:3_10}
    Let $L/K$ be abelian, $\fm$ divisible by $\ff(L/K)$. Then $\ker \Phi_\fm \subseteq T_{L/K}(\fm)$.
\end{proposition}

\noindent Artin reciprocity gives us information about the decomposition of primes:

\begin{theorem}[Decomposition Theorem]\label{thm:3_11}
    Let $L/K$ be abelian of degree $n$. Let $\fp \subseteq \cO_K$ be unramified in $L$. Let $\fm$ be divisible by $\ff(L/K)$, but not divisible by $\fp$. Write $H = \ker \Phi_\fm$ for the congruence subgroup for $\fm$. Suppose $f$ is the smallest positive integer such that $\fp^f \in H$, i.e. the order of $\fp \pmod{H}$ in $I_K(\fm) / H$. Then $\fp$ decomposes in $L$ into a product $\fp = \cp_1 \ldots \cp_g$ of $g = \frac{n}{f}$ distinct prime ideals of inertia degree $f$ over $\fp$.
\end{theorem}
\begin{proof}
    Let $\fp = \cp_1 \ldots \cp_g$ be the prime decomposition of $\fp$ in $L$. The $\cp_i$ are distinct a $\fp$ is unramified. They have the same inertia degree $f$ (by \autoref{thm:1_2}). We know $f$ is the order of $\leg{L/K}{\fp}$, so under the isomorphism $I_K(\fm) / H \cong \Gal(L/K)$, this means that it is also the order of $\fp \pmod{H}$ in $I_K(\fm) / H$. The result follows from $n = fg$ by \autoref{thm:1_2}.
\end{proof}

\subsection{The Existence Theorem}

Every generalised ideal class group is the Galois group of some abelian extension.

\begin{theorem}[Existence Theorem]\label{thm:3_12}
    Let $\fm$ be a modulus of $K$, and $H$ any congruence subgroup for $\fm$. Then there is a unique abelian extension $L/K$ with the property that all its ramified (finite and infinite) primes divide $\fm$, such that $\ker \Phi_{L/K, \fm} = H$. In particular, $I_K(\fm) / H \xrightarrow{\sim} \Gal(L/K)$ under $\Phi_{L/K, \fm}$, and $H = N_{L/K}(I_L(\fm)) P_K(\fm)$.
\end{theorem}

\begin{definition}[Ray Class Field]\label{def:3_13}
    Let $\fm$ be any modulus. Let $H$ be the congruence subgroup $P_K(\fm)$. Then the \emph{ray class field} is the unique abelian extension $K_\fm$ of $K$ such that $P_K(\fm) = \ker(\Phi_{K_\fm / K, \fm})$, given by the Existence \autoref{thm:3_12}.

    In particular, $\Gal(K_\fm / K) \cong I_K(\fm)/P_K(\fm)$ is the ray class group.
\end{definition}

\begin{example}\label{eg:3_14}
    Let $m$ be a positive integer, $m \not\equiv 2 \pmod{4}$. Let $K = \QQ$. If $\fm = (m) \infty$, then $K_\fm = \QQ(\zeta_m)$. If $\fm = (m)$, then $K_\fm = \QQ(\zeta_m + \zeta_m^{-1})$, the maximal real subfield of $\QQ(\zeta_m)$. See Example Sheet 1 Exercise 8.
\end{example}

\begin{corollary}\label{cor:3_15}
\marginpar{\fbox{Lecture 5}}
    Let $L/K$, $M/K$ be abelian extensions. Then $L \subseteq M$ iff there is a modulus $\fm$ divisible by all primes of $K$ ramified in either $L$ or $M$, such that $P_K(\fm) \subseteq \ker \Phi_{M/K, \fm} \subseteq \ker \Phi_{L/K, \fm}$.
\end{corollary}

\begin{remark}\label{rem:3_16}
    This implies every abelian extension is contained in a ray class field: If $L/K$ is abelian and $\ff(L/K) \mid \fm$, then $H = \ker \Phi_{L/K, \fm}$ is a congruence subgroup by \autoref{thm:3_6}, $P_K(\fm) \subseteq H$, so by \autoref{cor:3_15}, $L \subseteq K_\fm$.
\end{remark}

\begin{proof}[Proof of \autoref{cor:3_15}]\phantom{}

    ($\Rightarrow$) Suppose that $L \subseteq M$. Take $\fm = \ff(M/K)$. By \autoref{thm:3_2}, $P_K(\fm) \subseteq \ker \Phi_{M/K,\fm}$. By \autoref{prop:2_26}, $\ker\Phi_{M/K, \fm} \subseteq \ker \Phi_{L/K, \fm}$.

    ($\Leftarrow$) Suppose $P_K(\fm) \subseteq \ker \Phi_{M/K, \fm} \subseteq \ker \Phi_{L/K, \fm}$ for some $\fm$. We have the following correspondences:
    \begin{center}
    \begin{tabular}{ccc}
        $I_K(\fm)$ & $\xrightarrowdbl{\Phi_{M/K, \fm}}$ & $\Gal(M/K)$\\
        $H = \ker_{L/K, \fm}$ & $\longleftrightarrow$ & $\Gal(M/\widetilde{L})$\\
        $\ker_{M/K}$ & $\longleftrightarrow$ & $\{1\}$
    \end{tabular}
    \end{center}
    for some $K \subseteq \widetilde{L} \subseteq M$. Thus
    \begin{equation*}
        I_K(\fm) / H \cong \Gal(M/K) / \Gal(M/\widetilde{L}) \cong \Gal(\widetilde{L}/K)
    \end{equation*}
    with the isomorphism being induced by $\res \circ \Phi_{M/K, \fm} = \Phi_{\widetilde{L}/K, \fm}$. By the uniqueness part in the Existence \autoref{thm:3_12}, we have $L = \widetilde{L} \subseteq M$.
\end{proof}

\begin{theorem}\label{thm:3_17}
    Let $K$ be a number field. There is a 1-to-1 inclusion reversing correspondence
    \begin{equation*}
        \{\text{abelian extensions of } K\} \longleftrightarrow \{\text{generalised ideal class groups of } K\}
    \end{equation*}
\end{theorem}

\section{Applications of Global Class Field Theory}

\subsection{Kronecker-Weber}

\begin{theorem}\label{thm:4_1}
    Let $L/\QQ$ be an abelian extension. Then there is a positive integer $m$ such that $L \subseteq \QQ(\zeta_m)$.
\end{theorem}
\begin{proof}
    By Artin reciprocity, there is a modulus $\fm$ such that $P_\QQ(\fm) \subseteq \ker \Phi_{L/\QQ, \fm}$. By \autoref{lem:3_1}, we may assume that $\fm = (m) \infty$. We have seen (see \autoref{remark:2_15}) that $P_\QQ(\fm) = \ker \Phi_{\QQ(\zeta_m)/\QQ, \fm}$, so $P_\QQ(\fm) = \ker \Phi_{\QQ(\zeta_m)/\QQ, \fm} \subseteq \ker \Phi_{L/\QQ, \fm}$. Then $L \subseteq \QQ(\zeta_m)$ by \autoref{cor:3_15}.
\end{proof}

\subsection{Hilbert Class Field}

The Existence \autoref{thm:3_12} gives us an abelian extension that is unramified and has Galois group equal to the ideal class group of $K$. Let $\fm = 1$ and let $K_\fm$ be the corresponding ray class field. Then $K_\fm / K$ is unramified\footnote{at finite and infinite primes, also for \autoref{thm:4_5}} and $\Gal(K_\fm/K) \cong I_K(1) / P_K(1) \cong \Cl(K)$.

\stepcounter{definition} % Numbering issue

\begin{definition}\label{def:4_3}
    This $K_\fm$ is called the \emph{Hilbert class field} of $K$.
\end{definition}

\begin{example}\label{eg:4_4}
    If $K = \QQ$, then the Hilbert class field is $\QQ$.
\end{example}

\begin{theorem}\label{thm:4_5}
    The Hilbert class field is the maximal unramified abelian extension of $K$.
\end{theorem}
\begin{proof}
    Write $F$ for the Hilbert class field of $K$. Suppose $M/K$ is an unramified abelian extension. By the Conductor \autoref{thm:3_2}, $\ff(M/K) = 1$ and $P_K(\ff(M/K)) = P_K(1) \subseteq \ker \Phi_{M/K, 1}$ also by the Conductor Theorem. Thus $P_K(1) = P_K = \ker \Phi_{F/K, 1}$, so $M \subseteq F$ by \autoref{cor:3_15}.
\end{proof}

\begin{corollary}[Class Field Theory for Unramified Extensions]\label{cor:4_6}
    Let $K$ be a number field. Then there is a 1-to-1 inclusion reversing correspondence
    \begin{equation*}
        \{\text{unramified abelian extensions of } K\} \longleftrightarrow \{\text{subgroups of } \Cl(K)\}
    \end{equation*}
    If $M/K$ corresponds to $H \subseteq \Cl(K)$, then the Artin map induces an isomorphism $\Cl(K)/H \xrightarrow{\sim} \Gal(M/K)$.
\end{corollary}
\begin{proof}\color{blue}
    Let $F$ be the Hilbert class field of $K$. Subgroups of $\Cl(K)$ are identified with subgroups of $\Gal(F/K)$ via the isomorphism $\Cl(K) \xrightarrow{\sim} \Gal(F/K)$ induced by the Artin map. Unramified abelian extensions of $K$ are identified with subextensions of $F/K$. Then the correspondence in the statement is just the Galois correspondence.

    If $M/K$ corresponds to $H \subseteq \Cl(K)$, then
    \begin{equation*}
        \Cl(K) / H \cong \Gal(F/K) / \Phi_{F/K,1}(H) = \Gal(F/K) / \Gal(F/M) \cong \Gal(M/K)
    \end{equation*}
    as required.
\end{proof}

\begin{example}\label{eg:4_7}
    Let $K = \QQ(\sqrt{-5})$. We show that the Hilbert class field $F$ is equal to $L = \QQ(\sqrt{-5}, i)$.

    We use (without proof) that $h_K = 2$, so
    \begin{equation*}
        \abs{\Gal(F/K)} = \abs{I_K/P_K} = \abs{\Cl(K)} = 2
    \end{equation*}
    so $F$ is an unramified quadratic extension.
    \begin{equation*}
    \begin{tikzcd}
        & \QQ(\sqrt{-5}, i) \arrow[dl, dash] \arrow[d, dash] \arrow[dr, dash] &\\
        \QQ(i) \arrow[dr, dash, "\text{only } 2 \text{ ramifies}"'] & \QQ(\sqrt{-5}) \arrow[d, dash] & \QQ(\sqrt{5}) \arrow[dl, dash, "\text{only } 5 \text{ ramifies}"]\\
        & \QQ
    \end{tikzcd}
    \end{equation*}
    If $p \neq 2, 5$, then $p$ is unramified in both $\QQ(\sqrt{5})$ and $\QQ(i)$. Therefore in $\QQ(\sqrt{-5}, i)$. Thus primes of $\QQ(\sqrt{-5})$ not above $2$ or $5$ are unramified. Note that $2, 5$ are already ramified in $\QQ(\sqrt{-5})$, so primes above them are unramified in $\QQ(\sqrt{-5}, i)/\QQ(\sqrt{-5})$. Thus $F = \QQ(\sqrt{-5}, i)$.
\end{example}

\marginpar{\fbox{Lecture 6}}
\noindent We characterise which primes split in the Hilbert class field:

\begin{corollary}\label{cor:4_8}
    Let $F$ be the Hilbert class field of $K$. Let $\fp \subseteq \cO_K$ be a prime ideal. Then $\fp$ splits completely in $F$ iff $\fp$ is a principal ideal.
\end{corollary}
\begin{proof}
    We know by \autoref{cor:1_7} that $\fp$ splits completely in $F$ iff $\leg{F/K}{\fp} = 1$. The Artin map induces an isomorphism $\Cl(K) \cong \Gal(F/K)$, so $\leg{F/K}{\fp} = 1$ iff $[p] = [1]$ in $\Cl(K)$.
\end{proof}

\begin{theorem}[Principal Ideal Theorem]\label{thm:4_9}
    In the Hilbert class field, every ideal of $K$ becomes principal.
\end{theorem}

\begin{example}\label{eg:4_10}
    Let $K = \QQ(\sqrt{-5})$. Then $\Cl(K) = \{[\cO_K], [(2, 1+\sqrt{-5})]\}$. We have seen the Hilbert class field of $K$ is $F = \QQ(i, \sqrt{-5})$, and $(2, 1+\sqrt{-5}) \cO_F$ is generated by $1+i$ in $\cO_F$.
\end{example}

\subsection{Reciprocity Theorems}

Let $K$ be a number field containing a primitive $n$\textsuperscript{th} root of unity $\zeta$. Let $\fp$ be a prime ideal of $\cO_K$. Then for $\alpha \in \cO_K$ prime to $\fp$, we have $\alpha^{N(\fp) - 1} \equiv 1 \pmod{\fp}$ by Fermat's Little Theorem. Suppose in addition $\fp$ is prime to $n$. Then $\zeta$ has order $n$ in $\cO_K / \fp$ {\color{blue} as the polynomial $x^n - 1$ is separable modulo $\fp$}. Thus $x = \alpha^{\frac{N(\fp)-1}{n}}$ is a solution to the congruence $x^n \equiv 1 \pmod{\fp}$, so
\begin{equation*}
    \alpha^{\frac{N(\fp)-1}{n}} \equiv 1, \zeta, \ldots, \zeta^{n-1} \pmod{\fp}
\end{equation*}
Since the $n$\textsuperscript{th} roots of unity are distinct modulo $\fp$, $\alpha^{\frac{N(\fp)-1}{n}}$ is congruent to a unique $n$\textsuperscript{th} root of unity. We define the \emph{$n$\textsuperscript{th} power Legendre symbol} $\leg{\alpha}{\fp}_n$ as that unique root of unity, so $\alpha^{\frac{N(\fp)-1}{n}} \equiv \leg{\alpha}{\fp}_n \pmod{\fp}$. More generally, let $\fa = \fp_1 \ldots \fp_r$ be an ideal of $\cO_K$, prime to $n$ and $\alpha$. Then set
\begin{equation*}
    \leg{\alpha}{\fa}_n = \prod_{i=1}^r \leg{\alpha}{\fp_i}_n
\end{equation*}
Thus if $\fm$ is a modulus of $K$ such that every prime containing $n\alpha$ divides $\fm$, then we obtain a homomorphism
\begin{equation*}
    \leg{\alpha}{\cdot}_n : I_K(\fm) \to \mu_n
\end{equation*}
where $\mu_n \subseteq \CC^\times$ is the group of $n$\textsuperscript{th} roots of unity.

\subsubsection*{Galois Theory}
If $K$ has a primitive $n$\textsuperscript{th} root of unity, then for $\alpha \in K$, letting $L = K(\sqrt[n]{\alpha})$, $L/K$ is Galois and for $\sigma \in \Gal(L/K)$, $\sigma(\sqrt[n]{\alpha}) = \zeta \sqrt[n]{\alpha}$ for some $n$\textsuperscript{th} root of unity $\zeta$. Thus we have a map $\sigma \mapsto \zeta$. This gives an injective homomorphism $\Gal(L/K) \hookrightarrow \mu_n$.

\begin{theorem}[Weak Reciprocity]\label{thm:4_11}
    Let $K$ be a number field containing a primitive $n$\textsuperscript{th} root of unity. Let $L = K(\sqrt[n]{\alpha})$ for some non-zero $\alpha \in \cO_K$. Assume $\fm$ is divisible by all primes containing $n\alpha$. Then the diagram
    \begin{equation*}
    \begin{tikzcd}
        I_K(\fm) \arrow[r, "\Phi_{L/K, \fm}"] \arrow[rd, "\leg{\alpha}{\cdot}_n"'] & \Gal(L/K) \arrow[d, hookrightarrow]\\
                           & \mu_n
    \end{tikzcd}
    \end{equation*}
    commutes. If furthermore $\ker(\Phi_{L/K, \fm})$ is a congruence subgroup for $\fm$, and $G$ is the image of $\Gal(L/K)$ in $\mu_n$, then $\leg{\alpha}{\cdot}_n$ induces a surjective homomorphism $I_K(\fm)/P_K(\fm) \to G \subseteq \mu_n$.
\end{theorem}
\begin{proof}
    Using the definition of the Artin symbol, we see that
    \begin{equation*}
        \zeta^k \sqrt[n]{\alpha} = \leg{L/K}{\fp}(\sqrt[n]{\alpha}) \equiv \sqrt[n]{\alpha}^{N(\fp)} \pmod{\fp}
    \end{equation*}
    for some $k$. Thus
    \begin{equation*}
        \zeta^k \equiv \alpha^\frac{N(\fp)-1}{n} \equiv \leg{\alpha}{\fp}_n \pmod{\fp}
    \end{equation*}
    so
    \begin{equation*}
        \leg{L/K}{\fp}(\sqrt[n]{\alpha}) = \leg{\alpha}{\fp}_n \sqrt[n]{\alpha} \qedhere
    \end{equation*}
\end{proof}

\noindent Strong reciprocity gives a formula for $\leg{\alpha}{\fa}_n$ in terms of $n$\textsuperscript{th} power Hilbert symbols.

\noindent Recall that for $p$ odd,
\begin{gather*}
    \leg{a}{p} =
    \begin{cases}
        0 & \text{if } p \mid a\\
        1 & \text{if } p \nmid a \text{ and } a \text{ is a quadratic residue modulo } p\\
        -1 & \text{if } p \nmid a \text{ and } a \text{ is not a quadratic residue modulo } p
    \end{cases}\\
    \leg{-1}{p} = (-1)^{\frac{p-1}{2}}\\
    \leg{ab}{p} = \leg{a}{p} \leg{b}{p}
\end{gather*}

\begin{theorem}[Quadratic Reciprocity]\label{thm:4_12}
    Let $p, q$ be two distinct odd primes. Then
    \begin{equation*}
        \leg{p}{q} \leg{q}{p} = (-1)^{\frac{(p-1)(q-1)}{4}}
    \end{equation*}
\end{theorem}
\begin{proof}
    This is equivalent to $\leg{p^*}{q} = \leg{q}{p}$, where $p^* = (-1)^{\frac{p-1}{2}} p$. Recall $\Gal(\QQ(\zeta_p)/\QQ)$ is a generalised class group for $\fm = p \infty$ (see \autoref{eg:2_24}), so the same holds for any subfield of $\QQ(\zeta_p)$ (Example Sheet 1 Exercise 5). Since $\Gal(\QQ(\zeta_p)/\QQ)$ is cyclic of order $p-1$, there is a unique subfield $\QQ \subseteq K \subseteq \QQ(\zeta_p)$ which is quadratic over $\QQ$, so $\Gal(K/\QQ)$ is a generalised ideal class group for $p \infty$. $p$ is the only finite prime of $\QQ$ ramified in $K$. Thus $K = \QQ(\sqrt{p^*})$ (Example Sheet 1 Exercise 11). Thus $\ker \Phi_{\QQ(p^*)/\QQ, p \infty}$ is a congruence subgroup for $p \infty$. By Weak Reciprocity \autoref{thm:4_11}, % TODO: Don't we need 2 dividing the modulus?
    we have a surjective homomorphism
    \begin{equation}\label{eqn:4_12_star}
        \leg{p^*}{\cdot} : I_\QQ(p \infty) / P_\QQ(p \infty) \to \{\pm 1\}
    \end{equation}
    Consider the map $(\ZZ / p \ZZ)^\times \to I_\QQ(p\infty)/P_\QQ(p\infty)$ given by $[a] \mapsto [a \ZZ]$. This is an isomorphism. Composing this with \eqref{eqn:4_12_star}, we get a surjective homomorphism $(\ZZ/p\ZZ)^\times \to \{\pm 1\}$. But the Legendre symbol $\leg{\cdot}{p}$ also gives a surjective homomorphism $(\ZZ/p\ZZ)^\times \to \{\pm 1\}$. Since $(\ZZ/p\ZZ)^\times$ is cyclic, there is only one such homomorphism. Thus $\leg{p^*}{q} = \leg{q}{p}$.
\end{proof}

\section{Zeta Functions and \texorpdfstring{$L$}{L}-series}
\marginpar{\fbox{Lecture 7}}
In number theory, many arithmetic properties of objects (i.e. number fields, elliptic curves, \textellipsis) are captured in analytic objects like zeta functions and $L$-functions.

\subsection{Dirichlet Series}

\begin{definition}\label{def:5_1}
    A \emph{Dirichlet series} is a series $f(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}$, with $a_n \in \CC$, $s \in \CC$.
\end{definition}

We write $s = \sigma + i t$, where $\sigma, t$ are real. Suppose $\{a_n\}$ is a sequence of complex numbers, let $A(N) = \sum_{n=1}^N a_n$, and let $A(M, N) = \sum_{n=M}^N a_n$.

\begin{theorem}\label{thm:5_2}
    If the Dirichlet series $\sum_{n=1}^\infty \frac{a_n}{n^s}$ converges for some $s = s_0$, then it converges for any $s$ with $\Re s > \sigma_0 = \Re s_0$, uniformly on any compact subset.
\end{theorem}
\begin{proof}
    We will prove that the series converges uniformly in every region $\abs{\arg(s-s_0)} \le \frac{\pi}{2} - \delta < \frac{\pi}{2}$. Every compact set $K$ contained in $\{s \in \CC \mid \sigma > \sigma_0 \}$ lies in such a region. Since $f(s) = \sum_{n=1}^\infty \frac{1}{n^{s_0}} \frac{a_n}{n^{s-s_0}} = \sum_{n=1}^{\infty} \frac{\widetilde{a}_n}{n^{s-s_0}}$, where $\widetilde{a}_n = \frac{a_n}{n^{s_0}}$. Thus we may assume $s_0 = 0$. Then $\sum_{n=1}^\infty a_n$ converges, and for each $\varepsilon > 0$, we have $N_0$ such that $\abs{A(M, N)} < \varepsilon$ for all $N > M \ge N_0$. For each $N > M \ge N_0$, we find
    \begin{align*}
        \sum_{n=M}^{N} \frac{a_n}{n^s}
        &= \sum_{n=M}^{N} (A(M,n) - A(M,n-1)) n^{-s}\\
        &= \sum_{n=M}^{N-1} A(M,n) (n^{-s} - (n+1)^{-s}) + A(M, N) N^{-s}
    \end{align*}
    This is called Abel summation or summation by parts. We have
    \begin{equation*}
        \abs{n^{-s} - (n+1)^{-s}} = \abs{s \int_{n}^{n+1} \frac{dx}{x^{s+1}}} \le \abs{s} \int_{n}^{n+1} \frac{dx}{x^{\sigma+1}} = \frac{\abs{s}}{\sigma} (n^{-\sigma} - (n+1)^{-\sigma})
    \end{equation*}
    and $\frac{\abs{s}}{\sigma}$ is bounded in the region $\arg s \in (-\frac{\pi}{2} + \delta, \frac{\pi}{2} - \delta)$ by some constant $C$. Thus
    \begin{align*}
        \abs{\sum_{n=M}^{N} \frac{a_n}{n^s}}
        &\le \sum_{n=M}^{N-1} \abs{A(M,n)} \abs{n^{-s} - (n+1)^{-s}} + \abs{A(M, N)} \abs{N^{-s}}\\
        &\le C \varepsilon \sum_{n=M}^{N-1} (n^{-\sigma} - (n+1)^{-\sigma}) + \varepsilon N^{-\sigma}\\
        &\le C \varepsilon M^{-\sigma} + \varepsilon N^{-\sigma}\\
        &< (C + 1) N_0^{-\sigma} \varepsilon
    \end{align*}
\end{proof}

\begin{definition}\label{def:5_3}
    The smallest real number $\sigma_0$ such that the Dirichlet series converges for $\Re s > \sigma_0$ is called the \emph{abscissa of convergence}.
\end{definition}

We see the series converges in the half plane to the right of the line $\sigma = \sigma_0$, but does not converge for $s$ with $\sigma < \sigma_0$. If the Dirichlet series converges for some $s_1 = \sigma_1 + i t_1$, then we must have $a_n = O(n^{\sigma_1})$, and the Dirichlet series converges absolutely and uniformly on compact subsets if $\Re s \ge \sigma_1 + 1 + \delta$ if $\delta > 0$. (This follows by comparison with $\sum_{n=1}^{\infty} \frac{1}{n^{1+\delta}}$.)

\begin{theorem}\label{thm:5_4}
    Assume there exists a number $C$ and some $\sigma_1 \ge 0$ such that $\abs{A(N)} = \abs{a_1 + \ldots + a_N} \le C N^{\sigma_1}$ for all $N$. Then the abscissa of convergence of $\sum \frac{a_n}{n^s}$ is at most $\sigma_1$.
\end{theorem}
\begin{proof}
    See Example Sheet 2 Exercise 2.
\end{proof}

\subsection{Riemann Zeta Function}

\begin{definition}\label{def:5_5}
    For $s \in \CC$ with $\Re s \ge 1$, we define the \emph{Riemann zeta function} as $\zeta(s) = \sum_{n=1}^\infty \frac{1}{n^s}$.
\end{definition}

\noindent By \autoref{thm:5_4}, we have $\sigma_1 = 1$, so $\zeta(s)$ converges for $\Re s > 1$.

\begin{example}\label{eg:5_6}
    We will show that $\zeta(s)$ has a meromorphic continuation to $\Re s > 0$, with a pole of first order and $\res_{s=1} \zeta(s) = 1$. Let $s > 1$, then we claim $\lim_{s \to 1^+} (s-1) \zeta(s) = 1$. By bounding $\int_1^\infty \frac{dx}{x^s} = \frac{1}{s-1}$ by rectangles, we see that
    \begin{gather*}
        \zeta(s) - 1 \le \int_1^\infty \frac{dx}{x^s} \le \zeta(s)\\
        \frac{1}{s-1} \le \zeta(s) \le 1 + \frac{1}{s-1}\\
        1 \le (s-1) \zeta(s) \le s
    \end{gather*}
    Taking $s \to 1^+$ gives the result.

    To extend the Riemann zeta function to $\Re s > 0$, we use a trick: Set
    \begin{align*}
        \zeta_2(s)
        &= \sum_{n=1}^\infty \frac{(-1)^{n+1}}{n^s}\\
        &= 1 - \frac{1}{2^s} + \frac{1}{3^s} - \ldots\\
        &= \zeta(s) - 2\left(\frac{1}{2^s} + \frac{1}{4^s} + \ldots\right)\\
        &= (1-2^{1-s}) \zeta(s)
    \end{align*}
    The partial sums of $\zeta_2(s)$ are either $1$ or $0$, hence bounded. By \autoref{thm:5_4}, this converges for $\sigma > 0$. We write $\zeta(s) = \frac{\zeta_2(s)}{1-2^{1-s}}$. We see that this has a pole only if
    \begin{align*}
        1 - 2^{1-s} = 0
        &\iff \exp((1-s) \log 2) = 1\\
        &\iff (1-s) \log 2 \in 2 \pi i \ZZ\\
        &\iff s = 1 + \frac{2 \pi i k}{\log 2} \text{ for some } k \in \ZZ
    \end{align*}
\end{example}
Now consider
\begin{equation*}
    \zeta_3(s) = \sum_{n \ge 0} \frac{1}{(3n+1)^s} + \frac{1}{(3n+2)^s} - \frac{2}{(3n+3)^s}
\end{equation*}
Then $\zeta(s) = \frac{\zeta_3(s)}{1-3^{1-s}}$, so similarly poles occur only when $1-3^{1-s} = 0$, so $s = 1 + \frac{2 \pi i k'}{\log 3}$ for some $k' \in \ZZ$. Thus $k = k' = 0$, so the only poles occur at $s = 1$.

\begin{proposition}\label{prop:5_7}
\marginpar{\fbox{Lecture 8}}
    For $\Re s > 1$, $\zeta(s) = \prod_p \frac{1}{1-p^{-s}}$.
\end{proposition}
\begin{proof}
    Recall that an infinite product $\prod_{n=1}^\infty a_n$ of complex numbers $a_n$ is said to \emph{converge} if the sequence of partial products $P_n = a_1 \ldots a_n$ has a non-zero limit. This is the case if and only if the series $\sum_{n=1}^\infty \log a_n$ converges. The product is called \emph{absolutely convergent} if this series converges absolutely.

    Let $E(s) = \prod_p \frac{1}{1-p^s}$, then $\log E(s) = \sum_p \sum_{n=1}^\infty \frac{1}{n p^{ns}}$. This converges absolutely for $\Re s = \sigma \ge 1 + \delta$: Since $\abs{p^{ns}} = p^{n \sigma} \ge p^{(1+\delta) n}$, we have
    \begin{equation*}
        \sum_p \sum_{n=1}^\infty \left(\frac{1}{p^{1+\delta}}\right)^n = \sum_p \frac{1}{p^{1+\delta}-1} \le 2 \sum_p \frac{1}{p^{1+\delta}}
    \end{equation*}
    and this last sum converges. This implies absolute convergence of the product $E(s) = \prod_p \frac{1}{1-p^{-s}} = \exp\left(\sum_p \sum_{n=1}^\infty \frac{1}{n p^{ns}}\right)$. Note that if we expand $\frac{1}{1-p^s} = 1+\frac{1}{p^s}+\frac{1}{p^{2s}}+\ldots$ for all prime numbers $p_1, \ldots, p_r \le N$, we find
    \begin{equation*}
        \prod_{p \le N} \frac{1}{1-p^{-s}} = \sum_{v_1, \ldots, v_r = 0}^{\infty} \frac{1}{(p_1^{v_1} \ldots p_r^{v_r})^s} = \sideset{}{'}\sum_n \frac{1}{n^s}
    \end{equation*}
    where $\sum'$ denotes the sum of all natural numbers divisible only by prime numbers $p \le N$. In particular, $\sum'$ contains the terms corresponding to all $n \le N$, so
    \begin{equation*}
        \prod_{p \le N} \frac{1}{1-p^{-s}} = \sum_{n \le N} \frac{1}{n^s} + \sideset{}{'}\sum_{n > N} \frac{1}{n^s}
    \end{equation*}
    Now compare with $\zeta(s)$ to get
    \begin{equation*}
        \abs{\prod_{p \le N} \frac{1}{1-p^{-s}} - \zeta(s)} \le \abs{\sum_{\substack{n > N \\ p_i \nmid N}} \frac{1}{n^s}} \le \sum_{n > N} \frac{1}{n^{1+\delta}}
    \end{equation*}
    which goes to zero as $N \to \infty$.
\end{proof}

\begin{definition}\label{def:5_8}
    The \emph{gamma function} is the absolutely convergent integral
    \begin{equation*}
        \Gamma(s) = \int_0^\infty e^{-y} y^s \frac{dy}{y}
    \end{equation*}
    defined for $\Re s > 0$.
\end{definition}

\begin{proposition}\label{prop:5_9}\phantom{}
    \begin{enumerate}
        \item $\Gamma(s)$ is analytic and admits a meromorphic continuation to all of $\CC$.

        \item It is nowhere zero, and has only simple poles at $s = -n$, where $n=0, 1, 2, \ldots$, with residues $\frac{(-1)^n}{n!}$.

        \item We have functional equations
            \begin{enumerate}
                \item $\Gamma(s+1) = s \Gamma(s)$
                \item $\Gamma(s) \Gamma(1-s) = \frac{\pi}{\sin \pi s}$
                \item $\Gamma(s) \Gamma(s+\frac{1}{2}) = \frac{2 \sqrt{\pi}}{2^{2s}} \Gamma(2 s)$
            \end{enumerate}
        \item We have $\Gamma(\frac{1}{2}) = \sqrt{\pi}$, $\Gamma(1) = 1$, $\Gamma(n+1) = n!$ for $n=0,1,2,\ldots$.
    \end{enumerate}
\end{proposition}

\noindent In $\Gamma(s)$, substitute $y \mapsto \pi n^2 y$ to get
\begin{equation*}
    \pi^{-s} \Gamma(s) \frac{1}{n^{2s}} = \int_0^\infty e^{-\pi n^2 y} y^s \frac{dy}{y}
\end{equation*}
summing over all $n$, we get
\begin{equation*}
    \pi^{-s} \Gamma(s) \zeta(2s) = \int_0^\infty \sum_{n=1}^\infty e^{-\pi n^2 y} y^s \frac{dy}{y}
\end{equation*}
(check that we can actually swap the sum and integral).

\begin{definition}\label{def:5_10}
    The function $Z(s) = \pi^{-\frac{s}{2}} \Gamma(\frac{s}{2}) \zeta(s)$ is called the \emph{completed zeta function}.
\end{definition}

\begin{proposition}\label{prop:5_11}
    We have
    \begin{equation*}
        Z(s) = \frac{1}{2} \int_0^\infty (\theta(iy)-1) y^{\frac{s}{2}} \frac{dy}{y}
    \end{equation*}
    where $\theta(z) = \sum_{n \in \ZZ} e^{\pi i n^2 z} = 1 + 2\sum_{n=1}^\infty e^{\pi i n^2 z}$ is the Jacobi theta series.
\end{proposition}
\begin{proof}
    This follows from the discussion above.
\end{proof}

\begin{proposition}\label{prop:5_12}
    The series $\theta(z)$ is analytic on $\cH = \{z \in \CC \mid \Im z > 0\}$ and satisfies $\theta(-\frac{1}{z}) = \sqrt{\frac{z}{i}} \theta(z)$, where $\sqrt{\frac{z}{i}} = e^{\frac{1}{2} \log \frac{z}{i}}$.
\end{proposition}

\begin{definition}\label{def:5_13}
    Let $f : \RR_+ \to \CC$ be continuous, where $\RR_+$ is the group of positive real numbers. We define the \emph{Mellin transform} to be the improper integral
    \begin{equation*}
        M(f, s) = \int_0^\infty (f(y) - f(\infty)) y^s \frac{dy}{y}
    \end{equation*}
    provided the limit $f(\infty) = \lim_{y \to \infty} f(y)$ and the integral exists.
\end{definition}

\begin{theorem}[Mellin Principle]\label{thm:5_14}
    Let $f, g : \RR_+ \to \CC$ be continuous, $f(y) = a_0 + O(e^{-c_0 y^\alpha})$ and $g(y) = b_0 + O(e^{-c_0 y^\alpha})$ as $y \to \infty$, with positive constants $c_0, \alpha$. If
    \begin{equation*}
        f\left(\frac{1}{y}\right) = C y^k g(y)
    \end{equation*}
    for some real $k > 0$ and $C \neq 0$ complex, then
    \begin{enumerate}
        \item The integrals $M(f,s)$, $M(g,s)$ converge absolutely and uniformly for $s$ in a compact subset of $\{s \in \CC \mid \Re s > k\}$. Therefore they are holomorphic on $\{s \in \CC \mid \Re s > k\}$ and admit a holomorphic continuation to $\CC \setminus \{0, k\}$.

        \item They have simple poles at $s=0$ and $s=k$, where
            \begin{align*}
                \Res_{s=0} M(f,s) &= -a_0 & \Res_{s=k} M(f,s) &= C b_0\\
                \Res_{s=0} M(g,s) &= -b_0 & \Res_{s=k} M(g,s) &= C^{-1} a_0
            \end{align*}

        \item We have $M(f,s) = C M(f,k-s)$.
    \end{enumerate}
\end{theorem}

\begin{theorem}\label{thm:5_15}
    The completed zeta function $Z(s)$ admits an analytic continuation to $\CC \setminus \{0, 1\}$, has simple poles at $s=0,1$ with residues $-1,1$ respectively, and satisfies the functional equation $Z(s) = Z(1-s)$.
\end{theorem}
\begin{proof}
    By \autoref{prop:5_11} and \autoref{def:5_13}, we have $Z(s) = M(f,s)$, where $f(y) = \frac{1}{2} \theta(iy)$. Since $\theta(i y) = 1 + 2e^{-\pi y} (1 + \sum_{n=2}^\infty e^{\pi (n^2-1) y})$, we have $f(y) = \frac{1}{2} + O(e^{-\pi y})$. By \autoref{prop:5_12}, we have
    \begin{equation*}
        f\left(\frac{1}{y}\right) = \frac{1}{2} \theta\left(\frac{-1}{iy}\right) = \frac{1}{2} y^{\frac{1}{2}} \theta(iy) = y^{\frac{1}{2}} f(y)
    \end{equation*}

    By \autoref{thm:5_14}, $M(f,s)$ has a holomorphic continuation to $\CC \setminus \{0, \frac{1}{2}\}$, with simple poles at $s = 0, \frac{1}{2}$, with residues $-\frac{1}{2}$ and $\frac{1}{2}$ respectively, and $M(f, s) = M(f, s - \frac{1}{2})$. Thus $Z(s) = M(f, \frac{s}{2})$ has holomorphic continuation to $\CC \setminus \{0,1\}$, with simple poles at $s=0,1$ with residues $-1$ and $1$, and satisfies
    \begin{equation*}
        Z(s) = M\left(f, \frac{s}{2}\right) = M\left(f, \frac{1}{2} - \frac{s}{2}\right) = Z(1-s) \qedhere
    \end{equation*}
\end{proof}

\begin{corollary}\label{cor:5_16}
\marginpar{\fbox{Lecture 9}}
    The function $\zeta(s)$ admits an analytic continuation to $\CC \setminus \{1\}$. It has a simple pole at $s=1$ with residue $1$ and satisfies the functional equation
    \begin{equation*}
        \zeta(1-s) = 2 (2 \pi)^{-s} \Gamma(s) \cos\left(\frac{\pi s}{2}\right) \zeta(s)
    \end{equation*}
\end{corollary}
\begin{proof}
    $Z(s) = \pi^{-\frac{s}{2}} \Gamma\left(\frac{s}{2}\right) \zeta(s)$ has a simple pole at $s=0$, but so does $\Gamma\left(\frac{s}{2}\right)$, so $\zeta(s)$ has no pole at $s=0$. At $s=1$, $Z(s)$ has a simple pole, and hence so does $\zeta(s)$, since $\Gamma\left(\frac{1}{2}\right) = \sqrt{\pi}$. Then the residue is $\Res_{s=1} \zeta(s) = \pi^{\frac{1}{2}} \Gamma\left(\frac{1}{2}\right)^{-1} \Res_{s=1} Z(s) = 1$. By \autoref{thm:5_15}, $Z(s) = Z(1-s)$. This implies
    \begin{equation}\label{eqn:5_16_star}
        \zeta(1-s) = \pi^{\frac{1}{2} - s} \frac{\Gamma\left(\frac{s}{2}\right)}{\Gamma\left(\frac{1-s}{2}\right)} \zeta(s)
    \end{equation}
    Now by \autoref{prop:5_9} (3), we have
    \begin{align*}
        \Gamma\left(\frac{s}{2}\right) \Gamma\left(\frac{1+s}{2}\right) &= \frac{2 \sqrt{\pi}}{2^s} \Gamma(s)\\
        \Gamma\left(\frac{1-s}{2}\right) \Gamma\left(\frac{1+s}{2}\right) &= \frac{\pi}{\cos \frac{\pi s}{2}}
    \end{align*}
    so
    \begin{equation*}
        \frac{\Gamma(\frac{s}{2})}{\Gamma(\frac{1-s}{2})} = \frac{2}{2^s \sqrt{\pi}} \cos{\frac{\pi s}{2}} \Gamma(s)
    \end{equation*}
    Plugging this into \eqref{eqn:5_16_star} gives the result.
\end{proof}

\noindent What are the zeros of $\zeta(s)$?
\begin{itemize}
    \item $\zeta(s) \neq 0$ for $\Re s > 1$ (this follows from the Euler product).
    \item For $\Re(s) < 0$, then $s = -2, -4, -6, \ldots$ are the trivial zeros of $\zeta(s)$ (this follows from the functional equation and \autoref{prop:5_9}).
    \item Other zeros have to lie in the \emph{critical strip} $0 \le \Re s \le 1$. The Riemann hypothesis conjectures that the non-trivial zeros of $\zeta(s)$ lie on the line $\Re s = \frac{1}{2}$.
\end{itemize}

\section{Dedekind Zeta Function}

\begin{definition}\label{def:6_1}
    Let $K$ be a number field. The \emph{Dedekind zeta function} is defined by the series
    \begin{equation*}
        \zeta_K(s) = \sum_{\fa} \frac{1}{N(\fa)^s}
    \end{equation*}
    as $\fa$ varies over the integral ideals of $K$, and $N(\fa)$ is the absolute norm of $\fa$.
\end{definition}

For $K=\QQ$, $\zeta_K(s) = \zeta(s)$ is the Riemann zeta function.

\begin{proposition}\label{prop:6_2}
    The series $\zeta_K(s)$ converges absolutely and uniformly in the domain $\Re(s) \ge 1+\delta$ for every $\delta > 0$, and has an Euler product
    \begin{equation*}
        \zeta_K(s) = \prod_{\fp} \frac{1}{1 - N(\fp)^{-s}}
    \end{equation*}
    where $\fp$ runs through the prime ideals of $K$.
\end{proposition}
\noindent The proof is similar to that of $\zeta(s)$, using that $N(\fa)$ is multiplicative.

We will see that $\zeta_K(s)$ also has an analytic continuation to $\CC \setminus \{1\}$, and satisfies a functional equation $s \longleftrightarrow 1-s$.

By splitting up $\zeta_K(s)$ using a class $\cC \in \Cl(K) = I_K/P_K$, we define a partial zeta function $\zeta(\cC, s) = \sum_{\fa \in \cC} \frac{1}{N(\fa)^s}$ so that $\zeta_K(s) = \sum_{\cC \in \Cl(K)} \zeta(\cC, s)$.

Let $Z_\infty(s) = \abs{d_K}^{\frac{s}{2}} \pi^{ns} \Gamma_K\left(\frac{s}{2}\right)$, where $n = [K:\QQ]$ and $\Gamma_K(s)$ is a version of the gamma function. $Z_\infty(s)$ can be viewed as the Euler factor at infinity. Then set $Z(\cC, s) = Z_\infty(s) \zeta(\cC, s)$.

\begin{theorem}\label{thm:6_3}
    The function $Z(\cC, s)$ admits an analytic continuation to $\CC \setminus \{0, 1\}$ and it satisfies the functional equation
    \begin{equation*}
        Z(\cC, s) = Z(\cC', 1-s)
    \end{equation*}
    where $\cC$ and $\cC'$ are related to each other via $\cC \cC' = [\fd]$, where $\fd$ is the different.

    It has simple poles at $s=0,1$ with residues $-\frac{2^r R}{w}, \frac{2^r R}{w}$ respectively, where $r$ is the number of infinite primes, $w$ is the number of roots of unity in $K$, and $R$ is the regulator.
\end{theorem}

The proof again needs the Mellin principal and some theta series.

\begin{definition}\label{def:6_4}
    Let $Z_K(s) = Z_\infty(s) \zeta_K(s) = \sum_{\cC} Z(\cC, s)$ be the \emph{completed zeta function} of the number field $K$.
\end{definition}

\begin{corollary}\label{cor:6_5}
    The completed zeta function $Z_K(s)$ admits an analytic continuation to $\CC \setminus \{0, 1\}$ and satisfies the functional equation $Z_K(s) = Z_K(1-s)$. It has simple poles at $s=0,1$ with residues $-\frac{2^r h R}{w}, \frac{2^r h R}{w}$ respectively, where $h$ is the class number of $K$.
\end{corollary}

For a number field $K$, let $r_1$ be the number of real places, $r_2$ the number of complex places. After analysing $Z_\infty(s)$, one finds
\begin{corollary}\label{cor:6_6}\phantom{}
    \begin{enumerate}
        \item The Dedekind zeta function $\zeta_K(s)$ has an analytic continuation to $\CC \setminus \{1\}$.
        \item At $s=1$, it has a simple pole with residue $h \kappa$, where $\kappa = \frac{2^{r_1} (2\pi)^{r_2}}{w \, \abs{d_K}^{\frac{r}{2}}} R$.
        \item It satisfies the functional equation $\zeta_K(1-s) = A(s) \zeta_K(s)$ for some factor $A(s)$.
    \end{enumerate}
\end{corollary}

\begin{remark}\label{rem:6_7}
    The formula for the residue
    \begin{equation*}
        \Res_{s=1} \zeta_K(s) = \frac{2^{r_1} (2 \pi)^{r_2}}{w \abs{d_K}^{\frac{r}{2}}} h R
    \end{equation*}
    is called the analytic class number formula.
\end{remark}

\noindent Our next task is to make these explicit for quadratic fields.

\noindent Let $K = \QQ(\sqrt{d})$, where $d$ is squarefree. We know that a prime $p$ is
\begin{enumerate}
    \item split if $p \cO_K = \fp_1 \fp_2$, so $N_{K/\QQ}(\fp_1) = N_{K/\QQ}(\fp_2) = p$;
    \item inert if $p \cO_K$ is prime, so $N_{K/\QQ} (p \cO_K) = p^2$;
    \item ramified if $p \cO_K = \fp^2$, so $N_{K/\QQ}(\fp) = p$.
\end{enumerate}
so
\begin{align*}
    \zeta_K(s)
    &= \prod_{\fp} \left(1 - \frac{1}{N_{K/\QQ}(\fp)^s}\right)^{-1}\\
    &= \prod_{p \text{ splits}} \left(1 - \frac{1}{p^s}\right)^{-2} \prod_{p \text{ inert}} \left(1 - \frac{1}{p^{2s}}\right)^{-1} \prod_{p \text{ ramified}} \left(1 - \frac{1}{p^s}\right)^{-1}
\end{align*}
Note that in each case there is a factor $\left(1-\frac{1}{p^s}\right)^{-1}$, which is the Euler factor of the Riemann zeta function, so $\zeta(s) \mid \zeta_K(s)$. In fact,
\begin{equation*}
    \zeta_K(s) = \zeta(s) \prod_p \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}
\end{equation*}
where
\begin{equation*}
    \chi(p) = \begin{cases}
        1 & \text{if } p \text{ splits}\\
        -1 & \text{if } p \text{ is inert}\\
        0 & \text{if } p \text{ ramifies}
    \end{cases}
\end{equation*}
This is an example of a Dirichlet character, and $\prod_p \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}$ is the Euler product corresponding to the Dirichlet $L$-series $L(\chi, s)$.

\section{Dirichlet \texorpdfstring{$L$}{L}-series}
\marginpar{\fbox{Lecture 10}}

\subsection{Dirichlet Characters}

\begin{definition}\label{def:7_1}
    Let $m$ be a natural number. A \emph{Dirichlet character} mod $m$ is a homomorphism $\chi : (\ZZ/m\ZZ)^\times \to \CC^\times$.
\end{definition}

\begin{example}\label{eg:7_2}
    Let $K = \QQ(\sqrt{d})$, $d$ squarefree. Then set
    \begin{equation*}
        \chi(p) = \begin{cases}
            1 & \text{if } p \text{ splits}\\
            -1 & \text{if } p \text{ is inert}
        \end{cases}
    \end{equation*}
    This depends only on $p \pmod{d_K}$.
\end{example}

\begin{definition}\label{def:7_3}
    A Dirichlet character $\chi$ mod $m$ is called \emph{primitive} if it does not arise as the composite $(\ZZ/m\ZZ)^\times \to (\ZZ/m'\ZZ)^\times \xrightarrow{\chi'} \CC^\times$ of a Dirichlet character $\chi'$ mod $m$ for a proper divisor $m' \mid m$.
\end{definition}

\begin{definition}\label{def:7_4}
    If $\chi$ is a Dirichlet character mod $m$ and $\chi$ is primitive, then $m$ is called the \emph{conductor} of $\chi$.
\end{definition}

The conductor of a Dirichlet character $\chi$ mod $m_0$ is the gcd of all $m' \mid m_0$ such that $\chi$ is induced from a character mod $m'$.

We can extend Dirichlet characters $\chi$ to multiplicative functions $\chi : \ZZ \to \CC$ by setting
\begin{equation*}
    \chi(n) =
    \begin{cases}
        \chi(n \textrm{ mod }{m}) & \text{for } (n, m) = 1\\
        0 & \text{otherwise}
    \end{cases}
\end{equation*}

\stepcounter{definition} % Numbering issue

\begin{example}\label{eg:7_6}
    This is what we did for \autoref{eg:7_2} by setting $\chi(p) = 0$ if $(p, d_K) \neq 1$.
\end{example}

\begin{definition}\label{def:7_7}
    Write $\chi_0$ for the \emph{trivial character} mod $m$. Explicitly,
    \begin{equation*}
        \chi_0(n) =
        \begin{cases}
            1 & \text{if } (n, m) = 1\\
            0 & \text{if } (n, m) \neq 1
        \end{cases}
    \end{equation*}
    This is also called the \emph{principal character}.
    For $m = 1$, we write $\chi_0 = \mathbbm{1}$.
\end{definition}

\begin{example}\label{eg:7_9}
    Let $m=4$, then there are two Dirichlet characters mod $4$, the trivial character $\chi_0$ and
    \begin{equation*}
        \chi_1(n) =
        \begin{cases}
            1 & \text{if } n \equiv 1 \pmod{4}\\
            -1 & \text{if } n \equiv 3 \pmod{4}\\
            0 & \text{if } 2 \mid n
        \end{cases}
    \end{equation*}
\end{example}

\begin{remark}\label{rem:7_9}
    Suppose we have two Dirichlet characters mod $m$, $\chi_1, \chi_2$. Then the product $\chi_1 \chi_2$ is the function $\chi_1 \chi_2(n) = \chi_1(n) \chi_2(n)$. This operation turns the collection of all Dirichlet characters of $(\ZZ/m\ZZ)^\times$ into an abelian group, which we denote by $\widehat{(\ZZ/m\ZZ)^\times}$. The identity is the principal character $\chi_0$ and the inverse of a character $\chi$ is the function $n \mapsto \chi(n)^{-1}$.
\end{remark}

\begin{remark}\label{rem:7_10}
    We can also consider characters more generally. Let $A$ be a finite abelian group, and let $\widehat{A}$ be the group of homomorphisms $\chi : A \to \CC^\times$. $\widehat{A}$ is called the \emph{character group} (or \emph{dual group}) of $A$.
\end{remark}

\begin{proposition}\label{prop:7_11}
    If $A$ is a finite abelian group, then $A \cong \widehat{A}$.
\end{proposition}
\begin{proof}
    We induct on $\abs{A}$, the order of $A$.

    Suppose $A$ is cyclic of order $m$, with generator $y$. Then $y^m = 1$, so $\chi(y)$ is an $m$\textsuperscript{th} root of unity for every character $\chi$ of $A$. Note that by multiplicativity, any character $\chi$ is completely determined by $\chi(y)$. Let $\zeta$ be a primitive $m$\textsuperscript{th} root of unity. Then for each $r=0,\ldots,m-1$, the function $\chi_r(y^j) = (\zeta^r)^j$ is a character, and these are distinct. We have $\chi_r = \chi_1^r$, so $\widehat{A}$ is the cyclic group generated by $\chi_1$. Since $\chi_1^r = 1$ iff $\zeta^r = 1$, $\chi_1$ has order $m$, so that $\widehat{A}$ is cyclic of order $m$, so $\widehat{A} \cong A$.

    Now suppose that $A = A_1 \times A_2$, with $A_i \neq 1$ for $i \neq 1, 2$. We define a map $\widehat{A} \to \widehat{A_1} \times \widehat{A_2}$ by $\chi \mapsto (\chi \vert_{A_1}, \chi \vert_{A_2})$, which is a homomorphism. Define $\widehat{A_1} \times \widehat{A_2} \to \widehat{A}$ by $(\chi_1, \chi_2) \mapsto \chi(a_1, a_2) = \chi_1(a_1) \chi_2(a_2)$. These are mutual inverses, hence isomorphisms. The result follows by induction since $\widehat{A_i} \cong A_i$.
\end{proof}

Recall that $(\ZZ/m\ZZ)^\times$ has order $\phi(m)$, where $\phi$ is the Euler totient function. Thus by the above, $\widehat{(\ZZ/m\ZZ)^\times}$ has order $\phi(m)$.

\begin{example}\label{eg:7_12}
    $\phi(4) = 2$, so we have seen all the characters mod $4$.
\end{example}

\begin{corollary}\label{cor:7_13}
    If $A$ is a finite abelian group, then $A \cong \hat{\hat{A}}$ by the map sending $a \in A$ to the character $\chi \mapsto \chi(a)$.
\end{corollary}
\begin{proof}
    See Example Sheet 2 Exercise 10.
\end{proof}

\begin{proposition}[Orthogonality Relations]\label{prop:7_14}
    Let $\chi_1, \chi_2$ be characters of a finite abelian group $A$, $a, b \in A$. Then
    \begin{enumerate}
        \item $\displaystyle\sum_{a \in A} \chi_1(a) \chi_2(a) =
                \begin{cases}
                    0 & \text{if } \chi_1 \neq \chi_2^{-1}\\
                    \abs{A} & \text{if } \chi_1 = \chi_2^{-1}
                \end{cases}$
        \item $\displaystyle\sum_{\chi \in \widehat{A}} \chi(a) \chi(b) =
                \begin{cases}
                    0 & \text{if } a \neq b^{-1}\\
                    \abs{A} & \text{if } a = b^{-1}
                \end{cases}$
    \end{enumerate}
\end{proposition}
\begin{proof}
    Let $\chi \in \widehat{A}$, $\chi \neq \chi_0$. Let $b \in A$ be such that $\chi(b) \neq 1$. Then
    \begin{equation*}
        \sum_{a \in A} \chi(a) = \sum_{a \in A} \chi(ab) = \chi(b) \sum_{a \in A} \chi(a)
    \end{equation*}
    Since $\chi(b) \neq 1$, we get $\sum_{a \in A} \chi(a) = 0$. Thus the first part of 1) follows with $\chi = \chi_1 \chi_2$. The second part of 1) is immediate.

    To prove 2), use \autoref{cor:7_13}, and 1) with $\widehat{A}$ in place of $A$.
\end{proof}

\subsection{Dirichlet \texorpdfstring{$L$}{L}-series}
\marginpar{\fbox{Lecture 11}}

\begin{definition}\label{def:7_15}
    Let $\chi$ be a Dirichlet character mod $m$, then define
    \begin{equation*}
        L(\chi, s) = \sum_{n=1}^\infty \frac{\chi(n)}{n^s}
    \end{equation*}
\end{definition}

\begin{proposition}\label{prop:7_16}
    For $\Re(s) > 1$, the series is absolutely convergent, and we have an Euler product
    \begin{equation*}
        L(\chi, s) = \prod_p \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}
    \end{equation*}
\end{proposition}
\begin{proof}
    See Example Sheet 2 Exercise 7.
\end{proof}

Note that we can write $L(\chi,s) = \prod_{p \nmid m} \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}$. Now taking $\chi$ to be the trivial character $\chi_0$, $L(\chi_0,s) = \zeta(s) \prod_{p \mid m} \left(1 - \frac{1}{p^s}\right)$. We can relate the Dirichlet $L$-series to the Dedekind zeta function $\zeta_K(s)$.

\begin{proposition}\label{prop:7_17}
    Let $K = \QQ(\zeta_m)$, then
    \begin{equation*}
        \zeta_K(s) = \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \prod_{\chi \in \widehat{(\ZZ / m \ZZ)^\times}} L(\chi, s)
    \end{equation*}
\end{proposition}
\begin{proof}
    Let $p \cO_K = (\fp_1 \ldots \fp_r)^e$ be the decomposition of the prime number $p$ in $K$, and let $f = f_{\fp_1/p}$ be the inertial degree, so that $N(\fp_1) = p^f$. Then $\zeta_K(s)$ contains the factor $\prod_{\fp \mid p} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} = \left(1 - \frac{1}{p^{fs}}\right)^{-r}$. The $L$-series gives the factor $\prod_{\chi} \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}$. For $p \mid m$, this is $1$. Now assume $p \nmid m$. Then $f$ is the order of $p \pmod{m}$ in $(\ZZ/m\ZZ)^\times$ (by \autoref{thm:3_11}), and $e = 1$. % TODO: By Example 2.11 and Corollary 1.7?
    Since $efr = \abs{(\ZZ / m \ZZ)^\times} = \phi(m)$, the quotient $r = \frac{\phi(m)}{f}$ is the index of the subgroup $G_p$ generated by $p$ in $(\ZZ / m \ZZ)^\times$. Then we have an isomorphism $\widehat{G_p} \to \mu_f$, $\chi \mapsto \chi(p)$, and an exact sequence\footnote{$A \mapsto \widehat{A}$ is an exact functor, i.e. preserves short exact sequences, right-exactness can be proved by counting}
    \begin{equation*}
        1 \longrightarrow \widehat{G/G_p} \longrightarrow \widehat{G} \longrightarrow \mu_f \longrightarrow 1
    \end{equation*}
    and there are $\# \widehat{G / G_f} = [G : G_p] = r$ elements in the preimage of $\chi(p)$, so
    \begin{equation*}
        \prod_{\chi} \left(1-\frac{\chi(p)}{p^s}\right)^{-1} = \prod_{\zeta \in \mu_f} \left(1 - \frac{\zeta}{p^s}\right)^{-r} = \left(1-\frac{1}{p^{fs}}\right)^{-r} = \prod_{\fp \mid p} \left(1-\frac{1}{N(\fp)^s}\right)^{-1}
    \end{equation*}
    Taking the product over all primes,
    \begin{equation*}
        \zeta_K(s) = \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \prod_{\chi} L(\chi, s) \qedhere
    \end{equation*}
\end{proof}

\noindent Since $L(\chi_0, s) = \prod_{p \mid m} (1 - \frac{1}{p^s}) \zeta(s)$, we have
\begin{equation*}
    \zeta_K(s) = \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \underbrace{\prod_{p \mid m} \left(1 - \frac{1}{p^s}\right) \zeta(s)}_{L(\chi_0, s)} \prod_{\chi \neq \chi_0} L(\chi, s)
\end{equation*}
Since $\zeta(s)$ and $\zeta_K(s)$ both have simple poles at $s = 1$, so\footnote{note that for $\chi \neq \chi_0$, $L(\chi, 1)$ converges, by \autoref{thm:5_4}}

\begin{proposition}\label{prop:7_18}
    For every non-trivial Dirichlet character $\chi$, one has $L(\chi, 1) \neq 0$.
\end{proposition}

\begin{theorem}[Dirichlet's Prime Number Theorem]\label{thm:7_19}
    Every arithmetic progression $a, a \pm m, a \pm 2m, \ldots$ with $(a, m) = 1$ (i.e. every class $a \pmod{m}$) contains infinitely many prime numbers.
\end{theorem}
\begin{proof}
    Let $\chi$ be a Dirichlet character mod $m$. Then for $\Re(s) > 1$,
    \begin{align*}
        \log L(\chi, s)
        &= -\sum_{p}\log\left(1 - \frac{\chi(p)}{p^s}\right)\\
        &= \sum_p \sum_{n=1}^\infty \frac{\chi(p^n)}{n p^{ns}}\\
        &= \sum_p \frac{\chi(p)}{p^s} + g_\chi(s)
    \end{align*}
    where $g_\chi(s)$ is holomorphic for $\Re(s) > \frac{1}{2}$. Then multiplying by $\chi(a^{-1})$ an summing over all characters mod $m$, we get
    \begin{align*}
        \sum_{\chi} \chi(a^{-1}) \log L(\chi, s)
        &= \sum_\chi \sum_p \frac{\chi(a^{-1} p)}{p^s} + g(s)\\
        &= \sum_{b=1}^n \sum_\chi \chi(a^{-1}b)\sum_{p \equiv b \pmod{m}} \frac{1}{p^s} + g(s)\\
        &= \sum_{p \equiv a \pmod{m}} \frac{\phi(m)}{p^s} + g(s)
    \end{align*}
    by using the orthogonality relations \autoref{prop:7_14}. Now let $s > 1$ be real. Then for $s \to 1$, we know that $\log L(\chi, s)$ stays bounded for $\chi \neq \chi_0$ as we know that $L(\chi, 1) \neq 0$. But $\log L(\chi_0, s)  = \sum_{p \mid m} \log \left(1 - \frac{1}{p^s}\right) + \log \zeta(s)$ goes to infinity as $s \to 1$ because $\zeta(s)$ has a pole at $s = 1$. Thus the first sum of the above equation tends to $\infty$. Since $g(s)$ is holomorphic at $s = 1$, we find $\lim_{s \to 1} \sum_{p \equiv a \pmod{m}} \frac{\phi(m)}{p^s} = \infty$.
\end{proof}

\subsection{Explicit Class Number Formulae}

Let $K$ be any number field. Then for $\Re(s) > 1$, we can write $\zeta_K(s) = \sum_{n=1}^\infty \frac{j_n}{n^s}$ with $j_n$ the number of integral ideals $\fa$ of $K$ with $N(\fa) = n$. Then
\begin{equation*}
    \zeta_K(s) = \sum_{n=1}^\infty \frac{j_n - h_K \kappa}{n^s} + h_K \kappa \zeta(s)
\end{equation*}
for $\Re(s) > 1$, where $\kappa$ is the term we defined in the analytic class number formula \autoref{cor:6_6}, and $h_K$ is the class number. The series $\sum_{n=1}^\infty \frac{j_n - h_K \kappa}{n^s}$ converges for $\Re(s) = 1$ (in fact it converges for $\Re(s) > 1 - \frac{1}{[K : \QQ]}$). Now $h_K = \frac{\rho}{\kappa}$, where $\rho = \lim_{s \to 1} \frac{\zeta_K(s)}{\zeta(s)}$.

\marginpar{\fbox{Lecture 12}}
Let $K$ be an abelian extension of $\QQ$. Then $K \subseteq \QQ(\zeta_m)$ for some $m$. Identify $\Gal(\QQ(\zeta_m) / \QQ)$ with $(\ZZ / m\ZZ)^\times$, and let $G = \Gal(K / \QQ)$. We consider $\widehat{G}$ as a subgroup\footnote{The exact sequence $(\ZZ / m \ZZ)^\times \to G \to 0$ gives an exact sequence $0 \to \widehat{G} \to \widehat{(\ZZ / m \ZZ)^\times}$} of $(\ZZ / m\ZZ)^\times$. Then we adapt the proof of \autoref{prop:7_17} to find for $p \nmid m$,
\begin{equation*}
    \prod_{\chi \in \widehat{G}} \left(1 - \frac{\chi(p)}{p^s}\right) = \left(1 - \frac{1}{p^{fs}}\right)^r = \prod_{\fp \mid p} \left(1 - \frac{1}{N(\fp)^s}\right)
\end{equation*}
where now $f$ is the inertia degree of $p$ in $K$, and $r$ is the number of primes $\fp \subseteq \cO_K$ lying above $p$. Thus for $\Re(s) > 1$,
\begin{equation*}
    \prod_{\chi \in \widehat{G}} L(\chi, s) = \prod_{p \nmid m} \left(1 - \frac{1}{p^{fs}}\right)^{-r} = \prod_{p \nmid m} \prod_{\fp \mid p} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1}
\end{equation*}
so as before,
\begin{align*}
    \zeta_K(s)
    &= \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \prod_{\chi \in \widehat{G}} L(\chi, s)\\
    &= \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \underbrace{\prod_{p \mid m} (1-p^{-s}) \zeta(s)}_{L(\chi_0, s)} \prod_{\chi \neq \chi_0} L(\chi, s)
\end{align*}
so
\begin{equation*}
    \frac{\zeta_K(s)}{\zeta(s)} = \prod_{p \mid m} \left(1-\frac{1}{p^s}\right) \left(1-\frac{1}{p^{f_p s}}\right)^{-r_p} \prod_{\chi \neq \chi_0} L(\chi, s)
\end{equation*}

\begin{theorem}\label{thm:7_20}
    We have $h_K = \frac{\rho}{\kappa}$, with
    \begin{equation*}
        \rho = \prod_{p \mid m} \left(1 - \frac{1}{p}\right)\left(1 - \frac{1}{p^{f_p}}\right)^{-r_p} \prod_{\substack{\chi \in \widehat{G}\\\chi \neq \chi_0}} L(\chi, 1)
    \end{equation*}
\end{theorem}
\begin{proof}
    This follows from the above, and note that for $\chi \neq \chi_0$, the coefficients of $L(\chi, s)$ have bounded partial sums (see Example Sheet 1, Exercise 6), so by \autoref{thm:5_4}, the series converges to an analytic function $\Re(s) > 0$.
\end{proof}

Now we compute $L(\chi, 1)$.

\begin{definition}[Gauss Sum]\label{def:7_21}
    Let $\zeta = e^{\frac{2 \pi i}{m}}$ be a primitive $m$\textsuperscript{th} root of unity. Then for $k \ge 0$, we define the Gauss sum $\tau_k(\chi) = \sum_{a \in (\ZZ / m\ZZ)^\times} \chi(a) \zeta^{ak}$.
\end{definition}

\begin{theorem}\label{thm:7_22}
    Let $\chi$ be a non-trivial Dirichlet character mod $m$. Then
    \begin{equation*}
        L(\chi, 1) = -\frac{1}{m} \sum_{k=1}^{m-1} \tau_k(\chi) \log(1 - \zeta^{-k})
    \end{equation*}
\end{theorem}

\noindent Note $\log(1-z) = -\sum_{n=1}^\infty \frac{z^n}{n}$ for $\abs{z} < 1$, and for $z$ on the unit circle for which the series converges, e.g. $\zeta$.

\begin{proof}
    For $\Re(s) > 1$,
    \begin{align*}
        L(\chi, s)
        &= \sum_{n=1}^\infty \frac{\chi(n)}{n^s}\\
        &= \sum_{a \in (\ZZ / m\ZZ)^\times} \chi(a) \sum_{\substack{n \equiv a \pmod{m}\\n \ge 1}} \frac{1}{n^s}\\
        &= \sum_{a \in (\ZZ / m\ZZ)^\times} \chi(a) \sum_{n=1}^\infty \frac{\frac{1}{m} \sum_{k=0}^{m-1} \zeta^{(a-n)k}}{n^s}\\
        &= \frac{1}{m} \sum_{k=0}^{m-1} \tau_k(\chi) \sum_{n=1}^\infty \frac{\zeta^{-nk}}{n^s}
    \end{align*}
    Note $\tau_0(\chi) = \sum_{a \in (\ZZ/m\ZZ)^\times} \chi(a) = 0$. For $1 \le k \le m-1$, the Dirichlet series $\sum_{n=1}^\infty \frac{\zeta^{-nk}}{n^s}$ converges to an analytic function on the half-plane $\Re(s) > 0$ (by \autoref{thm:5_4}), and this is continuous at $s=1$. Its value at $s=1$ is $-\log(1-\zeta^{-k})$. The result follows by taking the limit $s \to 1$ from the right.
\end{proof}

\begin{lemma}\label{lem:7_23}
    Let $\chi$ be a primitive character mod $m$. Then $\abs{\tau_1(\chi)}^2 = m$ and
    \begin{equation*}
        \tau_k(\chi) = \begin{cases}
            \overline{\chi}(k) \tau_1(\chi) & \text{if } (k,m)=1\\
            0 & \text{if } (k,m) > 1
        \end{cases}
    \end{equation*}
\end{lemma}
\begin{proof}
    Omitted.
\end{proof}

\begin{definition}\label{def:7_24}
    We say a Dirichlet character $\chi$ is \emph{even} if $\chi(-1) = 1$ and \emph{odd} if $\chi(-1) = -1$.
\end{definition}

\begin{remark}\label{rem:7_25}
    We will use that for $0 < k < m$,
    \begin{equation*}
        \log(1-\zeta^k) = \log 2 + \log \sin \frac{k \pi}{m} + \left(\frac{k}{m} - \frac{1}{2}\right) \pi i
    \end{equation*}
    {\color{blue} This may be proven by writing $1 - \zeta^k = -\zeta^{\frac{k}{2}} (\zeta^{\frac{k}{2}} - \zeta^{-\frac{k}{2}}) = -2i \zeta^{\frac{k}{2}} \sin \frac{k \pi}{m}$.}
\end{remark}
\noindent Now
\begin{alignat*}{3}
    L(\chi, 1)
    &= -\frac{1}{m} \sum_{k=1}^{m-1} \tau_k(\chi) \log(1 - \zeta^{-k}) &&\qquad \text{by \ref{thm:7_22}}\\
    &= -\frac{\tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \log(1 - \zeta^{-k}) &&\qquad \text{by \ref{lem:7_23}}\\
    &= -\frac{\chi(-1) \tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \log(1 - \zeta^k) &&\qquad \text{Substitute } k \mapsto -k\\
    &= -\frac{\chi(-1) \tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \left(\log \sin \frac{k \pi}{m} + \frac{k \pi i}{m}\right) &&\qquad \text{by \ref{rem:7_25} and \ref{prop:7_14}}\\
    &= \begin{cases}
        \displaystyle-\frac{\tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \log \sin \frac{k \pi}{m} & \text{if } \chi \text{ is even}\\
        \displaystyle\frac{\pi i \tau_1(\chi)}{m^2} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) k & \text{if } \chi \text{ is odd}
    \end{cases}
\end{alignat*}
The last equality holds since $\chi(-1) = 1$ implies $\sum_{k=1}^{m-1} \overline{\chi}(k) k = 0$, and $\chi(-1) = -1$ implies $\sum_{k=1}^{m-1} \overline{\chi}(k) \log \sin \frac{k \pi}{m} = 0$.

\noindent Note also for odd $\chi$,
\begin{equation*}
    \sum_{k \in (\ZZ / m \ZZ)^\times} \chi(k) k = \frac{m}{\overline{\chi}(2) - 2} \sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k)
\end{equation*}
{\color{blue}
    Indeed, let $S = \sum_{k \in (\ZZ / m\ZZ)^\times} \chi(k) k$. Then
    \begin{align*}
        S
        &= \sum_{0 \le 2k < m} \chi(2k) 2k + \sum_{m \le 2k < 2m} \chi(2k) (2k-m)\\
        &= \sum_{k=0}^{m-1} \chi(2k) 2k - m \sum_{\frac{m}{2} \le k < m} \chi(2k)\\
        &= 2 \chi(2) S + \chi(2) m \sum_{k < \frac{m}{2}} \chi(k)
    \end{align*}
    Rearranging gives the result.
}

Putting this together,
\begin{theorem}\label{thm:7_26}
    Let $\chi$ be a primitive character mod $m \ge 3$. Then
    \begin{equation*}
        \abs{L(\chi, 1)} = \begin{cases}
            \displaystyle\frac{2}{\sqrt{m}} \Bigg\lvert\sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k) \log \sin \frac{k \pi}{m} \Bigg\rvert & \text{if } \chi \text{ is even} \\
            \displaystyle\frac{\pi}{\abs{2 - \chi(2)} \sqrt{m}} \Bigg\lvert\sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k)\Bigg\rvert & \text{if } \chi \text{ is odd}
        \end{cases}
    \end{equation*}
\end{theorem}

\subsubsection*{The Quadratic Case}
Let $K = \QQ(\sqrt{d})$, $d$ squarefree. Let $m = \abs{d_K}$. Then $K \subseteq \QQ(\zeta_m)$ (this can be shown using \autoref{thm:3_12}). By \autoref{thm:7_20}, we have\footnote{note that if $p \mid m$, then $p$ is ramified, so $f_p = r_p = 1$} $\rho = L(\chi, 1)$, where $\chi$ is the unique non-trivial character mod $m$ which corresponds to a character of $\Gal(K/\QQ)$. For $p \nmid m$,
\begin{equation*}
    \chi(p) = \begin{cases}
        1 & \text{if } p \text{ splits}\\
        -1 & \text{if } p \text{ is inert}
    \end{cases}
\end{equation*}
We define it for all $(m, n) = 1$ by extending multiplicatively. This $\chi$ is primitive mod $m$. It is even if $d > 0$ and odd if $d < 0$. % TODO: Why?

\begin{theorem}\label{thm:7_27}
    Let $K = \QQ(\sqrt{d})$, $d$ squarefree, $m = \abs{d_K}$. Then
    \begin{equation*}
        h_K = \frac{1}{\log \varepsilon} \Bigg\lvert \sum_{\substack{k \in (\ZZ / m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k) \log \sin \frac{k \pi}{m} \Bigg\rvert
    \end{equation*}
    if $d > 0$, where $\varepsilon$ is the fundamental unit, and
    \begin{equation*}
        h_K = \frac{1}{2 - \chi(2)} \Bigg\lvert \sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k) \Bigg\rvert
    \end{equation*}
    if $d < 0$ and $d \neq -1, -3$.
\end{theorem}
\begin{proof}
    See Example Sheet 2 Exercise 12.
\end{proof}

\begin{example}\label{eg:7_28}
    Let $d = -2$. Then $h_K = \frac{1}{2} \abs{\chi(1) + \chi(3)} = 1$.
\end{example}

\section{Density}
\marginpar{\fbox{Lecture 13}}

\subsection{Dirichlet Density}

Let $K$ be a number field.

\begin{definition}\label{def:8_1}
    Let $S$ be a set of prime ideals of $K$. Then the limit
    \begin{equation*}
        d(S) = \lim_{s \to 1^+} \frac{\sum_{\fp \in S} N(\fp)^{-s}}{\sum_{\fp} N(\fp)^{-s}}
    \end{equation*}
    provided it exists, is called the \emph{Dirichlet density} of $S$.
\end{definition}

This provides a way to measure the ratio of the set of primes in a set $S$ to the set of all (finite) primes.

For $\Re(s) \ge 1$,
\begin{equation*}
    \zeta_K(s) = \prod_{\fp} \frac{1}{1 - N(\fp)^{-s}}
\end{equation*}
so
\begin{equation*}
    \log \zeta_K(s) = \sum_{\fp} \sum_{n=1}^\infty \frac{1}{n N(\fp)^{ns}} = \sum_{\fp} \frac{1}{N(\fp)^s} + \sum_{\fp} \sum_{n=2}^\infty \frac{1}{n N(\fp)^{ns}}
\end{equation*}
where the latter sum is analytic at $s=1$.

\begin{notation}\label{not:8_2}
    Let $f(s), g(s)$ be functions defined for (at least) $\Re(s) > 1$. Then we write $f(s) \sim g(s)$ if $f(s) - g(s)$ has a finite limit as $s$ approaches $1$ (in the common domain).
\end{notation}

We have $\log \zeta_K(s) \sim \sum_{\fp} \frac{1}{N(\fp)^s}$. Since $\zeta_K(s)$ has a simple pole at $s=1$,
\begin{equation*}
    \frac{\zeta_K(s)}{h\kappa/(s-1)} \to 1 \text{ as } s \to 1
\end{equation*}
Taking logs, we get $\sum_{\fp} \frac{1}{N(\fp)^s} \sim \log \frac{1}{s-1}$, so we can also write $d(S) = \lim_{s \to 1^+} \frac{\sum_{\fp \in S} N(\fp)^{-s}}{\log \frac{1}{s-1}}$.

\begin{lemma}\label{lem:8_3}
    The Dirichlet density has the following properties:
    \begin{enumerate}[label=\roman*)]
        \item $d(P) = 1$ if $P$ is the set of all prime ideals of $K$;
        \item if $S \subseteq T$, and $d(S)$ and $d(T)$ exist, then $d(S) \le d(T)$;
        \item if $d(S)$ exists, then $0 \le d(S) \le 1$;
        \item if $S$ and $T$ are disjoint, and $d(S)$ and $d(T)$ both exist, then $d(S \cup T) = d(S) + d(T)$;
        \item if $S$ is finite, then $d(S) = 0$;
        \item if $d(S)$ exists and if $T$ differs from $S$ by finitely many elements, then $d(S) = d(T)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    See Example Sheet 3 Exercise 1.
\end{proof}

Recall a degree $1$ prime is a prime with residue field degree $1$ over $\QQ$, or equivalently a prime whose absolute norm $N(\fp)$ is prime.

\begin{lemma}\label{lem:8_4}
    The set $S$ of degree $1$ primes is infinite, and $d(S) = 1$.
\end{lemma}
\begin{proof}
    We have $\sum_{\fp} N(\fp)^{-s} = \sum_{\fp \in S} N(\fp)^{-s} + \sum_{\fp \notin S} N(\fp)^{-s}$. If $\fp \notin S$, then $N(\fp) = p^f \ge p^2$. There are at most $[K : \QQ]$ prime ideals in $\cO_K$ having a $p$-power norm. We have
    \begin{equation*}
        \abs{\sum_{\fp \notin S} N(\fp)^{-s}} \le [K : \QQ] \sum_{p} p^{-2 \sigma}
    \end{equation*}
    where $\sigma = \Re(s)$. The sum on the right is bounded at $s = 1$, so $\sum_{\fp} N(\fp)^{-s} \sim \sum_{\fp \in S} N(\fp)^{-s}$. Thus $d(S) = 1$.
\end{proof}

\subsection{Frobenius Density Theorem}

We will prove the Frobenius density theorem and use it to prove the surjectivity of the Artin map. Later we will see the Chebotarev density theorem.

Let $K$ be a number field and $L/K$ a Galois extension, and let $G = \Gal(L/K)$.

\begin{definition}\label{def:8_5}
    Let $\sigma \in G$ be an element of order $n$. Then the \emph{division} of $\sigma$ is the set of all elements of $G$ which is conjugate to some $\sigma^m$ for $m \in \ZZ$, $m$ relatively prime to $n$.
\end{definition}

\begin{lemma}\label{lem:8_6}
    Let $\sigma \in G$ be of order $n$, $H = \langle \sigma \rangle$, and $t$ the number of elements in the division of $\sigma$. Then $t = \phi(n) [G : N_G(H)]$, where $\phi$ is the Euler totient function, and $N_G(H)$ is the normaliser of $H$ in $G$.
\end{lemma}

\begin{theorem}[Frobenius Density Theorem]\label{thm:8_7}
    Let $\sigma \in \Gal(L/K)$. Let $S$ be the set of unramified primes $\fp$ of $K$ such that there is a prime $\cp$ in $L$ lying above it such that $\leg{L/K}{\cp}$ is in the division of $\sigma$. Then $d(S) = \frac{t}{\abs{G}}$.
\end{theorem}

\noindent We will prove \autoref{lem:8_6} and \autoref{thm:8_7} later.

\begin{theorem}\label{thm:8_8}
    Let $L/K$ be abelian, and let $\fm$ be a modulus of K divisible by all ramified primes. Then $\Phi_\fm : I_K(\fm) \to \Gal(L/K)$ is surjective.
\end{theorem}
\begin{proof}
    Let $\sigma \in \Gal(L/K)$. Since $\Gal(L/K)$ is abelian, the division of $\sigma$ is the set of generators of $\langle \sigma \rangle$. By the Frobenius density theorem, there exists infinitely many primes $\cp$ of $L$ such that $\leg{L/K}{\cp}$ generates $\langle \sigma \rangle$. Let $\cp$ be any such prime such that $\fp = \cp \cap \cO_K$ is not contained in $\fm$. Then $\Phi_\fm(\fp)$ is a generator of $\langle \sigma \rangle$, so $\sigma$ is in the image of $\Phi_\fm$.
\end{proof}

\begin{lemma}\label{lem:8_9}
\marginpar{\fbox{Lecture 14}}
    Let $S$ be a set of prime ideals of $K$ whose Dirichlet density exists, then $d(S) = d(S \cap \{\text{degree } 1 \text{ prime ideals}\})$.
\end{lemma}
\begin{proof}
    From the proof of \autoref{lem:8_4}, we have
    \begin{equation*}
        \sum_{\substack{\fp \in S \\ \text{degree} \neq 1}} N(\fp)^{-s} \sim 0
    \end{equation*}
    Then
    \begin{equation*}
        \sum_{\fp \in S} N(\fp)^{-s} \sim \sum_{\fp \in S \cap \{\text{degree } 1 \text{ primes}\}} N(\fp)^{-s} \qedhere
    \end{equation*}
\end{proof}

\begin{proof}[Proof of \autoref{lem:8_6}]
    We count $\#\{(\tau, m) \in G \times (\ZZ/n\ZZ)^\times \mid \tau \text{ is conjugate to } \sigma^m\}$ in two ways. On one hand, this is
    \begin{equation*}
        \sum_{\tau \in G} \#\{m \in (\ZZ/n\ZZ)^\times \mid \tau \text{ is conjugate to } \sigma^m\} = t [N_G(H) : C_G(\sigma)]
    \end{equation*}
    since $\tau$ being conjugate to some $\sigma^m$ means that $\tau$ is in the division of $\sigma$, and each $\sigma^m$ is conjugate to $[N_G(H) : C_G(\sigma^m)]$ other elements of $H$ (by orbit-stabiliser), where $C_G(\sigma)$ is the centraliser of $\sigma$. Note also that $C_G(\sigma^m) = C_G(\sigma)$. On the other hand, the number is also equal to
    \begin{equation*}
        \sum_{m \in (\ZZ/n\ZZ)^\times} \#\{\tau \in G \mid \tau \text{ is conjugate to } \sigma^m\} = \sum_{m \in (\ZZ/n\ZZ)^\times} [G : C_G(\sigma^m)] = \phi(n) [G : C_G(\sigma)]
    \end{equation*}
    Equating these give the result.
\end{proof}

\begin{proof}[Proof of \autoref{thm:8_7}]
    Let $S_1$ be the set $S$ in the statement.
    We proceed by induction on $n$, the order of $\sigma$.

    Suppose $n = 1$. Then $S_1$ is the set of primes of $K$ that split completely in $L$ (by \autoref{cor:1_7}). Let $S_L$ be the set of primes of $L$ that lie above some prime in $S_1$. Then each prime $\fp$ in $S_1$ has exactly $[L:K] = \abs{G}$ primes in $S_L$ lying above it, and any such prime has norm $\fp$, so we find
    \begin{equation*}
        \sum_{\cp \in S_L} N_{L/\QQ}(\cp)^{-s}
        = \sum_{\cp \in S_L} N_{K/\QQ}(N_{L/K}(\cp))^{-s}
        = \abs{G} \sum_{\fp \in S_1} N_{K/\QQ}(\fp)^{-s}
    \end{equation*}
    Let $S_L^1$ be the set of primes of $L$ having degree $1$ over $\QQ$, then $S_L^1 \subseteq S_L$. By \autoref{lem:8_4} and \autoref{lem:8_9}, $d(S_L) = d(S_L \cap S_L^1) = d(S_L^1) = 1$. Hence
    \begin{equation*}
        \abs{G} \sum_{\fp \in S_1} N_{K/\QQ}(\fp)^{-s} \sim \sum_{\cp \in S_L} N_{L/\QQ}(\cp)^{-s} \sim -\log(s-1)
    \end{equation*}
    and so $d(S_1) = \frac{1}{\abs{G}}$.

    Now assume $\sigma$ has order $n > 1$. For each divisor $d$ of $n$, let $t_d$ be the number of elements in the division of $\sigma^d$. Let $S_d$ be the set of primes of $K$ lying under some prime $\cp$ of $L$ whose Artin symbol belongs to the division of $\sigma^d$ ($S_1$ is the set we are interested in). By induction, for $1 \neq d \mid n$ we know that $d(S_d) = \frac{t_d}{\abs{G}}$.

    Let $E = L^H$, the subfield of $L$ fixed element-wise by $H = \langle \sigma \rangle$. The primes $\fp$ of $K$ which have at least one degree $1$ prime in $E$ lying above it are exactly those that lie under a prime $\cp \subseteq \cO_L$ such that $\leg{L/K}{\cp}$ is conjugate to some power of $\sigma$, so $\fp \in S_d$ for some $d \mid n$. %TODO: Why? There is a hole here, argument given in Janusz

    Next let $S_E$ denote the primes of $E$ having inertial degree $1$ over $K$. For each $\fp \subseteq S_d$, let $n(\fp)$ be the number of primes in $S_E$ lying above $\fp$, so $\fp \in S_d$ is the norm of exactly $n(\fp)$ distinct primes in $S_E$. Since $S_E$ contains all the degree $1$ primes of $L$ over $\QQ$, $d(S_L) = 1$, so
    \begin{equation}\label{eqn:8_7_star}
        -\log(s-1) \sim \sum_{\cp_E \in S_E} N_{K/\QQ}(N_{E/K}(\cp_E))^{-s} = \sum_{d \mid n} \sum_{\fp \in S_d} \frac{n(\fp)}{N(\fp)^s}
    \end{equation}
    Note by Galois theory, for any $\fp \in S_d$, this $n(\fp)$ is exactly the number of distinct cosets $H \tau_i$ such that $H \tau_i \sigma^d = H \tau_i$ (exercise). This happens iff $\tau_i \sigma^d \tau_i^{-1} \in H$, but since $H$ is cyclic, this can only happen if $\tau_i \in N_G(\langle \sigma^d \rangle)$, so $[N_G(\langle \sigma^d \rangle) : H]$. Using the induction hypothesis for the sum over $S_d$ for $d \neq 1$ and rewriting \eqref{eqn:8_7_star} gives
    \begin{equation*}
        [N_G(H) : H] \sum_{\fp \in S_1} N(\fp)^{-s} \sim \left(-1 + \sum_{1 \neq d \mid n} \frac{[N_G(\langle \sigma^d \rangle) : H] t_d}{\abs{G}}\right) \log(s-1)
    \end{equation*}
\marginpar{\fbox{Lecture 15}}
    By \autoref{lem:8_6}, we can rewrite the coefficient on the right as
    \begin{align*}
        -1 + \sum_{1 \neq d \mid n} \frac{\phi(\frac{n}{d}) [G : N_G(\langle \sigma^d \rangle)] [N_G(\langle \sigma^d \rangle) : H]}{\abs{G}}
        &= -1 + \sum_{1 \neq d \mid n} \frac{\phi(\frac{n}{d}) [G : H]}{\abs{G}}\\
        &= -1 + \sum_{1 \neq d \mid n} \frac{1}{n} \phi\left(\frac{n}{d}\right)\\
        &= -1 - \frac{\phi(n)}{n} + \frac{1}{n} \sum_{d \mid n} \phi\left(\frac{n}{d}\right)
    \end{align*}
    we have the identity $\sum_{d \mid n} \phi\left(\frac{n}{d}\right) = n$, so the coefficient is $-1 - \frac{\phi(n)}{n} + \frac{1}{n} n = - \frac{\phi(n)}{n}$. This implies
    \begin{equation*}
        \sum_{\fp \in S_1} N(\fp)^{-s} \sim \frac{-\phi(n)}{n [N_G(H) : H]} \log(s-1) = -\frac{t}{\abs{G}} \log(s-1)
    \end{equation*}
    where the equality follows from \autoref{lem:8_6}. Thus $d(S_1) = \frac{t}{\abs{G}}$.
\end{proof}

\begin{corollary}\label{cor:8_10}
    Assume $\Gal(L/K)$ is cyclic of order $n$, and let $d \mid n$. Let $S_d$ be the set of prime ideals in $\cO_K$ having exactly $d$ primes lying above it in $\cO_L$. Then $S_d$ has Dirichlet density $\frac{\phi(n/d)}{n}$. In particular, there exists infinitely many primes of $\cO_K$ which remain prime in $\cO_L$.
\end{corollary}
\begin{proof}
    We ignore the finite set of primes of $K$ that ramify in $L$. A prime $\fp$ of $\cO_K$ has $d$ factors in $\cO_L$ iff $\sigma = \leg{L/K}{\cp}$ has order $\frac{n}{d}$. In a cyclic group, the number of such elements is $\phi\left(\frac{n}{d}\right)$. By Frobenius density theorem, $d(S_d) = \frac{\phi(n/d)}{n}$.
\end{proof}

\begin{theorem}\label{thm:8_11}
    Let $K$ be a number field, $\fm$ a modulus of $K$. Let $H$ be a congruence subgroup for $\fm$. Let $S$ be the set of prime ideals contained in $H$. If $S$ has a Dirichlet density, then $d(S) \le \frac{1}{[I_K(\fm):H]}$.
\end{theorem}
\noindent The proof uses characters of the group $I_K(\fm) / H$.

\begin{theorem}[First Fundamental Inequality of Class Field Theory]\label{thm:8_12}
    Let $L/K$ be a Galois extension, $\fm$ a modulus of $K$. Let $I_L(\fm)$ be the subgroup of $I_L$ generated by all primes $\cp$ of $L$ for which $\cp \cap \cO_K$ is in $I_K(\fm)$. Then
    \begin{equation*}
        [I_K(\fm) : N_{L/K}(I_L(\fm)) P_K(\fm)] \le [L:K]
    \end{equation*}
\end{theorem}
\begin{proof}
    Let $H = N_{L/K}(I_L(\fm)) P_K(\fm)$. Then except for a finite set of primes (namely those that divide $\fm$), the primes of $K$ that split completely in $L$ are in $N_{L/K}(I_L(\fm))$. The density of this set is $\frac{1}{[L:K]}$ by the Frobenius density theorem with $\sigma = 1$. By \autoref{thm:8_11}, we have $\frac{1}{[L:K]} \le \frac{1}{[I_K(\fm) : H]}$.
\end{proof}

\noindent The second fundamental inequality is
\begin{equation*}
    [I_K(\fm) : N_{L/K}(I_L(\fm)) P_K(\fm)] \ge [L : K]
\end{equation*}

\subsection{Chebotarev Density Theorem}
This is a refinement of the Frobenius density theorem.

\begin{theorem}[Chebotarev Density Theorem]\label{thm:8_13}
    Let $L/K$ be Galois, $G = \Gal(L/K)$. Fix $\sigma \in G$, and suppose that $\sigma$ has $c$ conjugates in $G$. Then the set of primes $\fp$ of $K$ which has a prime $\cp$ in $L$ lying above it such that $\leg{L/K}{\cp} = \sigma$ has density $\frac{c}{\abs{G}}$.
\end{theorem}

Note that the Chebotarev density theorem can be stated in two ways, either with the set $S = \{\fp \subseteq \cO_K \mid \leg{L/K}{\fp} = \{\text{conjugacy class of } \sigma\}\}$ or $S = \{\fp \subseteq \cO_K \mid \leg{L/K}{\cp} = \sigma \text{ for some prime } \cp \text{ in } \cO_L \text{ such that } \cp \mid \fp\}$. We implicitly assume that any $\fp \in S$ is unramified for the Artin symbol to make sense. The theorem then says that $d(S) = \frac{c}{\abs{G}}$.

\begin{corollary}\label{cor:8_14}
    Let $L/K$ be abelian, $\fm$ a modulus of $K$ divisible by all primes of $K$ that ramify in $L$, and let $\sigma \in G$. Then the set $S$ of primes $\fp \nmid \fm$ such that $\leg{L/K}{\fp} = \sigma$ has density $d(S) = \frac{1}{[L : K]}$, and $S$ is infinite.
\end{corollary}

\noindent Note that this also implies the surjectivity of the Artin map.

\begin{proposition}\label{prop:8_15}
    For any Galois extension $L/K$, there are infinity many primes of $K$ that split completely in $L$.
\end{proposition}
\begin{proof}
    Applying \autoref{thm:8_13} to $1 \in \Gal(L/K)$, the primes $\fp \subseteq \cO_K$ such that $\leg{L/K}{\fp} = 1$ has density $\frac{1}{[L:K]}$. The result follows since $\leg{L/K}{\fp} = 1$ iff $\fp$ splits completely in $L$.
\end{proof}

We will see next that the primes that split completely in $L$ characterise the extension $L/K$ uniquely.

\begin{notation}\label{not:8_16}
    Given two sets $S$ and $T$, say $S \subsetdot T$ if $S \subseteq T \cup \Sigma$ for some finite set $\Sigma$, and say $S \eqdot T$ if $S \subsetdot T$ and $T \subsetdot S$. Given any finite $L/K$, we set $S_{L/K} = \{\fp \subseteq \cO_K \mid \fp \text{ splits completely in } L\}$.
\end{notation}

\begin{theorem}\label{thm:8_17}
    Let $L$ and $M$ be Galois extensions of $K$, then
    \begin{enumerate}
        \item $L \subseteq M \iff S_{M/K} \subsetdot S_{L/K}$;
        \item $L = M \iff S_{M/K} \eqdot S_{L/K}$.
    \end{enumerate}
\end{theorem}

\begin{proposition}\label{prop:8_18}
\marginpar{\fbox{Lecture 16}}
    Let $L$ and $M$ be finite extensions of $K$.
    \begin{enumerate}[label=\roman*)]
        \item If $M$ is Galois over $K$, then $L \subseteq M \iff S_{M/K} \subsetdot S_{L/K}$.
        \item If $L$ is Galois over $K$, then $L \subseteq M \iff \widetilde{S}_{M/K} \subsetdot S_{L/K}$, where $\widetilde{S}_{M/K} = \{\fp \subseteq \cO_K \mid \fp \text{ unramified in } M \text{ and } f_{\cp / \fp} = 1 \text{ for some } \cp \text{ in } M\}$.
    \end{enumerate}
\end{proposition}
\begin{proof}\phantom{}
    \begin{enumerate}[label=\roman*)]
        \setcounter{enumi}{1}
        \item ($\Rightarrow$) Straightforward.

            ($\Leftarrow$) Assume $\widetilde{S}_{M/K} \subsetdot S_{L/K}$. Let $N/K$ be a Galois extension containing $L$ and $M$. It suffices to show that for $\sigma \in \Gal(N/M)$, we have $\sigma \vert_L = 1$.

            By the Chebotarev density theorem, there are infinitely many primes $\fp$ in $\cO_K$ unramified in $N$ such that there is a prime $\cp$ in $\cO_N$ dividing $\fp$ with $\leg{N/K}{\cp} = \sigma$. We claim $\fp \in \widetilde{S}_{M/K}$. Let $\cp_M = \cp \cap \cO_M$. Then for $\alpha \in \cO_M$, we have
            \begin{equation*}
                \alpha = \sigma(\alpha) \equiv \alpha^{N(\fp)} \pmod{\cp_M}
            \end{equation*}
            This implies $\cO_M / \cp_M \cong \cO_K / \fp$, so that $f_{\cp_M / \fp} = 1$, so $\fp \in \widetilde{S}_{M/K}$. Since $\widetilde{S}_{M/K} \subsetdot S_{L/K}$ and there are infinitely many such $\fp$, we find one with $\fp \in S_{L/K}$, i.e. $\leg{L/K}{\fp} = 1$. Finally, $\sigma \vert_L = \leg{N/K}{\cp} \vert_L = \leg{L/K}{\fp} = 1$.

        \setcounter{enumi}{0}
    \item ($\Rightarrow$) Straightforward.

        ($\Leftarrow$) Suppose $S_{M/K} \subsetdot S_{L/K}$, and let $L'$ be the Galois closure of $L/K$.
            \begin{fact}
                A prime splits completely in $L$ iff it splits completely in $L'$.
            \end{fact}
            This means $S_{L/K} = S_{L'/K}$. Since $M$ is Galois over $K$, we have $\widetilde{S}_{M/K} = S_{M/K} \subsetdot S_{L'/K}$. By ii), we obtain $L' \subseteq M$, so $L \subseteq M$. \qedhere
    \end{enumerate}
\end{proof}

It is now easy to prove \autoref{thm:8_17}.
\begin{proof}[Proof of \autoref{thm:8_17}]
    ii) follows from i).

    i) follows from \autoref{prop:8_18} (either part, since if $M$ is Galois over $K$, then $\widetilde{S}_{M/K} = S_{M/K}$).
\end{proof}

\noindent Now we complete the proof of \autoref{prop:3_10}:
\begin{proof}[Proof of \autoref{prop:3_10}]
    Since $\ff(L/K) \mid \fm$, we know $P_K(\fm) \subseteq \ker \Phi_\fm \subseteq I_K(\fm)$. For $\fa \in I_K(\fm)$, $\leg{L/K}{\fa}$ depends only on the class of $\fa$ modulo $P_K(\fm)$. By the Chebotarev density theorem, for any $\sigma \in \Gal(K_\fm / K)$, there are infinitely many primes $\fp$ in $\cO_K$ such that $\leg{L/K}{\fp} = \sigma$. Choose such a prime $\fp$ with $\fp \nmid \fm$. Since we have an isomorphism $I_K(\fm) / P_K(\fm) \cong \Gal(K_\fm / K)$, this implies that every $\fa \in I_K(\fm)$ is equivalent to a prime $\fp$ modulo $P_K(\fm)$. Now suppose $\fp \subseteq \cO_K$ is such that $\fp \in \ker(\Phi_\fm)$. Then $\leg{L/K}{\fp} = 1$, so $\fp$ splits completely in $L$. Thus if we have $\cp \subseteq \cO_L$ such that $\cp \mid \fp$, then $N_{L/K}(\cp) = \fp^{f_{\cp/\fp}} = \fp$ since $f_{\cp/\fp} = 1$. Hence $\fp \in N_{L/K}(I_L(\fm)) \subseteq N_{L/K}(I_L(\fm)) P_K(\fm)$.
\end{proof}

\section{Ideles and Adeles}
\marginpar{\fbox{Lecture 17}}

\subsection{Introduction}

Idele is a modification of the notion of ideal. The original term was `ideal element', abbreviated to idel. Adele was derived from the term `additive idele'.

Let $K$ be a number field. Recall from the Local Fields course that any absolute value is equivalent to either $\abs{\cdot}_\fp$, $\fp$ a nonzero prime ideal, or $\abs{\cdot}_\sigma$, $\sigma : K \hookrightarrow \RR, \CC$. Now let $\fp$ be a prime, infinite or finite. Let $K_\fp$ be the completion at $\fp$. This is either a $p$-adic field, $\RR$, or $\CC$. For a non-archimedian valued field $F$, define the valuation ring of $F$ to be $\cO_K = \{x \in F \mid \abs{x} \le 1\}$. This is an open subring of $F$, and $\cO_F^\times = \{x \in F \mid \abs{x} = 1\}$.

To use local fields or valuation theory to study a number field $K$, it is useful to embed $K$ into all the completions $K_\fp$ simultaneously. However, $\prod_\fp K_\fp$ is not nice topologically (i.e. not locally compact). We make an adjustment to this.

\subsection{Restricted Product Topology}

\begin{definition}\label{def:9_1}
    Let $(X_i)$ be a family of topological spaces indexed by $i \in I$. Let $(U_i)$ be a family of open sets, $U_i \subseteq X_i$. Then the \emph{restricted product} $\rprod (X_i, U_i)$ is the topological space
    \begin{equation*}
        \rprod(X_i, U_i) = \{(x_i) \mid x_i \in U_i \text{ for almost all } i \in I\} \subseteq \prod X_i
    \end{equation*}
    with the basis of open sets
    \begin{equation*}
        \mathbb{B} = \left\{\prod V_i \mid V_i \subseteq X_i \text{ open for all } i \in I, \text{ and } V_i = U_i \text{ for almost all } i \in I\right\}
    \end{equation*}
\end{definition}
Note that this is in general not the same as the subspace topology it inherits from $\prod X_i$, it has more open sets. The restricted product is a generalisation of the direct product, they are the same iff $U_i = X_i$ for all $i \in I$.

\begin{proposition}\label{prop:9_2}
    Let $(X_i)_{i \in I}$ be a family of locally compact topological spaces and let $(U_i)_{i \in I}$ be a corresponding family of open subsets $U_i \subseteq X_i$, almost all of which are compact. Then the restricted product $X = \rprod(X_i, U_i)$ is locally compact.
\end{proposition}
\begin{proof}\color{blue}
    Let $x = (x_i) \in \rprod(X_i, U_i)$. There is a finite subset $S \subseteq I$ such that for $i \in I \setminus S$, $x_i \in U_i$ and $U_i$ is compact. For $i \in S$, since $X_i$ is locally compact, we can find a compact neighbourhood $V_i$ of $x_i$. Then $\prod_{i \in I \setminus S} U_i \prod_{i \in S} V_i$ is a compact neighbourhood of $x$.
\end{proof}

\subsection{The Ring of Adeles}

\begin{definition}[Adele]\label{def:9_3} An \emph{adele} of $K$ is a family $\alpha = (\alpha_\fp)$ of elements $\alpha_\fp \in K_\fp$ where $\fp$ runs through all primes of $K$, and $\alpha_\fp$ is integral in $K_\fp$ for almost all $\fp$.
\end{definition}
We write $\bA_K$ for the ring of adeles.
\begin{align*}
    \bA_K
    &= \left\{(\alpha_\fp) \in \prod_{\fp} K_\fp \mid \alpha_\fp \in \cO_{K_\fp} \text{ for almost all } \fp\right\}\\
    &= \rprod_{\fp} (K_\fp, \cO_{K_\fp})
\end{align*}

Note for finite $\fp$, $\cO_{K_\fp}$ is the valuation ring, while for infinite $\fp$, we set $\cO_{K_\fp} = K_\fp$.

This is a subset of $\prod_{\fp} K_\fp$. For each $\alpha \in \bA_K$ as above, we write $\alpha_\fp$ for its projection in $K_\fp$. We make $\bA_K$ a ring by defining addition and multiplication componentwise.

\begin{example}\label{eg:9_4}
    Let $K = \QQ$. Then $\bA_\QQ = \RR \times \{(\alpha_p) \in \prod_{p \nmid \infty} \QQ_p \mid \text{for almost all } p, \alpha_p \in \ZZ_p\} = \rprod_{p} (\QQ_p, \ZZ_p)$. Thus $\bA_\QQ$ is the union of the rings $\RR \times \prod_{p \in S} \QQ_p \times \prod_{p \notin S} \ZZ_p$ as $S$ varies over all finite set of primes. Alternately, $\bA_\QQ = \RR \times \{(\alpha_p) \in \prod_p \QQ_p \mid \abs{\alpha_p} \le 1 \text{ for almost all } p\}$.
\end{example}

\begin{proposition}\label{prop:9_5}
    The ring of adeles $\bA_K$ is locally compact and Hausdorff.
\end{proposition}
\begin{proof}
    Local compactness follows from \autoref{prop:9_2}, since all local fields $K_\fp$ are locally compact and all but finitely many $\cO_{K_\fp}$ are valuation rings of a non-archimedian local field, hence compact.

    Now $\prod_{\fp} K_\fp$ is Hausdorff, since each $K_\fp$ is Hausdorff. Since the topology on $\bA_K \subseteq \prod_{\fp} K_\fp$ is finer than the subspace topology, $\bA_K$ is also Hausdorff.
\end{proof}

Now for each finite set of primes $S$, we have the subring of \emph{$S$-adeles} $\bA_{K,S} = \prod_{\fp \in S} K_\fp \times \prod_{\fp \notin S} \cO_{K_\fp}$. The canonical embeddings $K \hookrightarrow K_\fp$ induce a canonical embedding $K \hookrightarrow \bA_K$, $x \mapsto (x, x, \ldots)$, since for each $x \in K$, we have $x \in \cO_{K_\fp}$ for all but finitely many $\fp$. The image of $K$ in $\bA_K$ is the subring of \emph{principal adeles}.

\subsection{The Idele Group}

This is the unit group of the ring of adeles $\bA_K$.

\begin{equation*}
    \bA_K^\times = \{(\alpha_\fp) \in \bA_K \mid \alpha_\fp \in K_\fp^\times \text{ for all } \fp, \alpha_\fp \in \cO_{K_\fp}^\times \text{ for almost all } \fp\}
\end{equation*}
As a subspace of $\bA_K$, $\bA_K^\times$ is not a topological group. We give it the restricted product topology.

\begin{definition}\label{def:9_6}
    The \emph{idele group} of $K$ is the topological group
    \begin{equation*}
        \II_K = \rprod_{\fp} (K_\fp^\times, \cO_{K_\fp}^\times)
    \end{equation*}
    with multiplication defined componentwise.
\end{definition}

\begin{proposition}\label{prop:9_7}
    The idele group $\II_K$ is locally compact and Hausdorff.
\end{proposition}
\begin{proof}
    Now $\II_K$ is Hausdorff since the topology is finer than the topology of $\bA_K^\times \subseteq \bA_K$, which is Hausdorff by \autoref{prop:9_5}. For each finite prime, the set $\cO_{K_\fp}^\times = \{x \in K_\fp \mid \abs{x}_\fp = 1\}$ is a closed subset of the compact set $\cO_{K_\fp}$, hence compact. This applies to almost all primes, and the $K_\fp^\times$ are all locally compact. By \autoref{prop:9_2}, $\rprod_\fp (K_\fp^\times, \cO_K^\times) = \II_K$ is locally compact.
\end{proof}

\marginpar{\fbox{Lecture 18}}
The canonical embedding $K \hookrightarrow \bA_K$, $x \mapsto (x, x, \ldots)$ restricts to an embedding $K^\times \hookrightarrow \II_K$. We view $K^\times$ as a subgroup of $\II_K$, and we will call the elements of $K^\times$ in $\II_K$ the \emph{principal ideles}.

\subsection{The Idele Class Group}

\begin{definition}\label{def:9_8}
    We define the \emph{idele class group} of $K$ to be the quotient group $C_K = \II_K / K^\times$.
\end{definition}

For any finite set of primes $S$, the \emph{$S$-ideles} is
\begin{align*}
    \II_{K,S}
    &= \prod_{\fp \in S} K_{\fp}^\times \prod_{\fp \notin S} \cO_{K_\fp}^\times\\
    &= \prod_{\fp \mid \infty} K_{\fp}^\times \prod_{\substack{\fp \nmid \infty \\ \fp \in S}} K_{\fp}^\times \prod_{\substack{\fp \nmid \infty \\ \fp \notin S}} \cO_{K_\fp}^\times
\end{align*}
so $\II_K = \bigcup_{S} \II_{K,S}$ for varying finite sets of primes $S$.

Next we study the relation with the ideal class group $\Cl(K) = I_K / P_K$. We have a surjective homomorphism
\begin{gather*}
    (\cdot) : \II_K \to I_K\\
    (\alpha) = \prod_{\fp \nmid \infty} \fp^{v_\fp(\alpha_\fp)}
\end{gather*}
This has kernel $\II_{K, S_\infty} = \prod_{\fp \mid \infty} K_\fp^\times \times \prod_{\fp \nmid \infty} \cO_{K_\fp}^\times$ and is continuous for the discrete topology on $I_K$. Let $C_K = \II_K / K^\times$. We have a commutative diagram
\begin{equation*}
\begin{tikzcd}
    1 \arrow[r] & K^\times \arrow[r] \arrow[d, twoheadrightarrow, "(\cdot)"] & \II_K \arrow[r] \arrow[d, twoheadrightarrow, "(\cdot)"] & C_K \arrow[r] \arrow[d] & 1 \\
    1 \arrow[r] & P_K \arrow[r] & I_K \arrow[r] & \Cl(K) \arrow[r] & 1
\end{tikzcd}
\end{equation*}
with exact rows. By the snake lemma, we see that the map $C_K \to \Cl(K)$ is surjective, with kernel $\II_{K, S_\infty} K^\times / K^\times$. We deduce that
\begin{proposition}\label{prop:9_9}
    $\Cl(K) \cong \II_K / \II_{K, S_\infty} K^\times$.
\end{proposition}

In contrast to the ideal class group, the idele class group is \underline{not finite}. Note since $I_K / P_K$ is finite, we can enlarge $S_\infty$ to a set $S$ which contains enough primes to obtain $\II_K = \II_{K,S} K^\times$:

\begin{proposition}\label{prop:9_10}
    There is a finite set $S$ of primes of $K$ such that $\II_K = \II_{K,S} K^\times$.
\end{proposition}
\begin{proof}
    Let $\fa_1, \ldots, \fa_h$ be ideals representing the $h$ classes of $\Cl(K)$. They are composed of a finite number of prime ideals $\fp_1, \ldots, \fp_n$. Let $S$ be a set of primes containing these primes and the primes at infinity. We claim that $\II_K = \II_{K,S} K^\times$. To see this, consider the isomorphism
    \begin{equation*}
        \II_K / \II_{K, S_\infty} \cong I_K
    \end{equation*}
    If $\alpha \in \II_K$, then the corresponding ideal $(\alpha) = \prod_{\fp \nmid \infty} \fp^{v_\fp(\alpha)}$ belongs to some class $\fa_i P_K$, i.e. $(\alpha) = \fa_i (a)$ for some principal fractional ideal $(a)$. Then the idele $\alpha' = \alpha a^{-1}$ is mapped to the ideal $\fa_i = \prod_{\fp \nmid \infty} \fp^{v_\fp(\alpha'_\fp)}$. Since the prime ideals occurring in $\fa_i$ lie in $S$, for all $\fp \notin S$ we have $v_\fp(\alpha'_\fp) = 0$, i.e. $\alpha'_{\fp} \in \cO_{K_\fp}^\times$. Hence $\alpha' \in \II_{K,S}$, so $\alpha = \alpha' a \in \II_{K, S} K^\times$.
\end{proof}

\begin{proposition}\label{prop:9_11}
    $K^\times$ is a discrete subgroup of $\II_K$.
\end{proposition}

Reacll from Local Fields the product formula $\prod_{\fp} \abs{x}_\fp = 1$ for $x \in K^\times$.

\begin{proof}
    To show $K^\times$ is discrete, it suffices to show $1 \in \II_K$ has a neighborhood not containing any other element of $K^\times$. Consider the neighborhood
    \begin{equation*}
        U = \left\{\alpha \in \II_K \mid \abs{\alpha_\fp}_\fp = 1 \text{ for } \fp \nmid \infty \text{ and } \abs{\alpha_\fp - 1}_\fp < 1 \text{ for } \fp \mid \infty\right\}
    \end{equation*}
    Suppose we have a principal idele $1 \neq x \in U$. Then
    \begin{align*}
        1
        &= \prod_\fp \abs{x - 1}_\fp
        = \prod_{\fp \nmid \infty} \abs{x - 1}_\fp \prod_{\fp \mid \infty} \abs{x - 1}_\fp\\
        &< \prod_{\fp \nmid \infty} \abs{x-1}_\fp
        \le \prod_{\fp \nmid \infty} \max\left\{\abs{x}_\fp, 1\right\} = 1
    \end{align*}
    contradiction.
\end{proof}

In particular, $K^\times \subseteq \II_K$ is a closed subgroup, and the quotient $C_K$ is therefore Hausdorff and locally compact\footnote{since $\II_K$ is locally compact, and the quotient map $\II_K \to C_K$ is open and surjective}. % Why?

For any idele $\alpha = (\alpha_\fp) \in \II_K$, write $[\alpha]$ for the corresponding class in $C_K$. Define the \emph{absolute norm / idele norm} of $\alpha \in \II_K$ to be the real number $N(\alpha) = \prod_{\fp} \abs{\alpha_\fp}_\fp$. Let $\II_K^0 = \{\alpha \in \II_K \mid N(\alpha) = 1\}$ be the kernel. If $x \in K^\times$ is a principal idele, then we have by the product formula $N(x) = \prod_\fp \abs{x}_\fp = 1$, so we have a well-defined norm map $N : C_K \to \RR^\times_+$. Let $C_K^0$ be the kernel of this map, i.e. $C_K^0 = \{[\alpha] \in C_K \mid N(\alpha) = 1\}$.

{\color{blue}
    We have the commutative diagram
    \begin{equation*}
        \begin{tikzcd}
            1 \arrow[r] & \II_K^0 \arrow[r] \arrow[d, twoheadrightarrow] & \II_K \arrow[r, "N"] \arrow[d, twoheadrightarrow] & \RR_+^\times \arrow[r] \arrow[d, equal] & 1\\
            1 \arrow[r] & C_K^0 \arrow[r] & C_K \arrow[r, "N"] & \RR_+^\times \arrow[r] & 1
        \end{tikzcd}
    \end{equation*}
    with exact rows.
}

\begin{proposition}\label{prop:9_12}
    The group $C_K^0$ is compact.
\end{proposition}

\marginpar{\fbox{Lecture 19}}
This has applications: it can be used to prove a more general version of Dirichlet's unit theorem.

Let $S$ be a finite set of primes containing all the infinite primes. Let $\cO_{K,S} = \{x \in K \mid \text{for all primes } \fp \notin S, \abs{x}_\fp \le 1\}$ be the set of \emph{$S$-integers}.

\begin{corollary}\label{cor:9_13}
    The group of $S$-units $\cO_{K,S}^\times$ is a finitely generated abelian group of rank $\#S - 1$.
\end{corollary}
\begin{proof}[Idea of the proof]
    Consider the map $\lambda_S : \II_K \to \prod_{\fp \in S} \RR$, $\alpha \mapsto (\log \abs{\alpha_\fp}_\fp)_{\fp \in S}$. Then use the product formula to show $\lambda_S(\cO_{K,S}^\times) \subseteq \{(x_\fp) \in \prod_{\fp \in S} \mid \sum_{\fp \in S} x_\fp = 0\}$, and use the compactness of $C_K^0$ to show
    \begin{enumerate}[label=\roman*)]
        \item $\ker \lambda_S \cap \cO_{K,S}^\times$ is finite;
        \item $\lambda_S(\cO_K^\times)$ is a lattice in $\{(x_\fp) \in \prod_{\fp \in S} \RR \mid \sum_{\fp \in S} x_\fp = 0\}$. \qedhere
    \end{enumerate}
\end{proof}

For each $\fp$ consider the homomorphism $n_\fp : K_\fp^\times \to \II_K$ which sends $x$ to the element of $\II_K$ with $x$ in the component of $\fp$ and $1$ elsewhere, i.e.
\begin{equation*}
    (n_\fp(x))_\fq =
    \begin{cases}
        1 & \text{if } \fq \neq \fp\\
        x & \text{if } \fq = \fp
    \end{cases}
\end{equation*}
Let $\overline{n}_\fp : K^\times \to C_K$ be the map $x \mapsto [n_\fp(x)] \in C_K$.

\begin{proposition}\label{prop:9_14}
    $C_K \cong C_K^0 \times \RR_+^\times$.
\end{proposition}
\begin{proof}
    It suffices to show that the extension
    \begin{equation*}
        1 \longrightarrow C_K^0 \longrightarrow C_K \longrightarrow \RR_+^\times \longrightarrow 1
    \end{equation*}
    has a splitting, i.e. we can find a map $\RR_+^\times \to C_K$ which when composed with $N : C_K \to \RR_+^\times$ gives the identity on $\RR_+^\times$.

    Choose any infinite prime $\fp$ and consider the embedding $\overline{n}_\fp : K_\fp^\times \to C_K$ defined above. $K_\fp^\times$ contains $\RR_+^\times$ as a subgroup. If $\fp$ is real, then $\overline{n}_\fp : \RR_+^\times \to C_K$ is the embedding we want, since $N(\overline{n}_\fp(x)) = \abs{x}_\fp = x \in \RR_+^\times$. If $\fp$ is complex, then for $x \in \RR_+^\times$, $N(n_\fp(x)) = \abs{x}_\fp = x^2$, so choose the map $x \mapsto \overline{n}_\fp(\sqrt{x})$.
\end{proof}

\begin{corollary}[of \autoref{prop:9_12}]\label{cor:9_15}
    The ideal class group $\Cl(K)$ is finite.
\end{corollary}
\begin{proof}
    We had a surjective map $\II_K \to I_K$. This restricts to a surjective\footnote{as we can scale the component of an infinite prime} map $\II_K^0 \to I_K$ and is continuous for the discrete topology on $I_K$. The image of $K^\times$ is $P_K$, as we have seen. Thus the class group $\Cl(K) = I_K / P_K$ is the continuous image of the compact group $C_K^0 = \II_K^0 / K^\times$, so\footnote{compact + discrete $\implies$ finite} is finite.
\end{proof}

For a finite prime $\fp$, the units of $\fp$ are understood to be the group $\cO_{K_\fp}^\times$. For infinite primes $\fp$, we set $\cO_{K_\fp} = K_\fp$, so that the units are just $K_\fp^\times$. Recall $\II_{K, S_\infty} = \prod_{\fp \mid \infty} K_\fp^\times \times \prod_{\fp \nmid \infty} \cO_{K_\fp}^\times = \prod_\fp \cO_{K_\fp}^\times$ by our conventions.

Let $\fm$ be a modulus of $K$, and define
\begin{equation*}
    U_\fp^{n_\fp} =
    \begin{cases}
        \cO_{K_\fp}^\times & \text{if } n_\fp = 0, \fp \nmid \infty\\
        1 + \fp^{n_\fp} & \text{if } n_\fp > 0, \fp \nmid \infty\\
        \RR^\times = K_\fp^\times & \text{if } n_\fp = 0, \fp \text{ real}\\
        \RR_+^\times \subseteq K_\fp^\times & \text{if } n_\fp = 1, \fp \text{ real}\\
        \CC^\times = K_\fp^\times & \text{if } \fp \text{ complex}
    \end{cases}
\end{equation*}

Now if $\alpha_\fp \in K_\fp^\times$, then say $\alpha_\fp \equiv 1 \pmod{\fp^{n_\fp}}$ iff $\alpha_\fp \in U_\fp^{n_\fp}$. For a finite prime $\fp$, this means ordinary congruence if $n_\fp > 0$, and $\alpha_\fp \in \cO_{K_\fp}^\times$ if $n_\fp = 0$. If $\fp$ is real and $n_\fp = 1$, then this is a positivity condition $\alpha_\fp > 0$. The remaining cases have no restrictions.

For any modulus $\fm = \prod_\fp \fp^{n_\fp}$ and idele $\alpha \in \II_K$, we say $\alpha \equiv 1 \pmod{\fm}$ if $\alpha_\fp \equiv 1 \pmod{\fp^{n_\fp}}$ for all primes $\fp$.

Define $\II_K(\fm) = \{\alpha \in \II_K \mid \alpha \equiv 1 \pmod{\fm}\}$, so $\II_K(\fm) = \prod_{\fp} U_\fp^{n_\fp} \subseteq \II_K$. If $\fm = 1$, then $\II_K(1) = \II_{K,S_\infty} = \prod_{\fp} U_\fp$, where $U_\fp = U_\fp^0$.

\begin{definition}\label{def:9_16}
    We call the idele class group
    \begin{equation*}
        C_K(\fm) = \II_K(\fm) K^\times / K^\times \subseteq C_K
    \end{equation*}
    the \emph{congruence subgroup mod $\fm$} of $C_K$. The factor group $C_K / C_K(\fm)$ is called the \emph{ray class group mod $\fm$}.
\end{definition}

Later we will prove that $C_K / C_K(\fm) \cong I_K(\fm) / P_K(\fm)$. Now if $\fm = 1$, then
\begin{equation*}
    C_K / C_K(1) = (\II_K / K^\times) / (\II_{K, S_\infty} K^\times / K^\times) \cong \II_K / \II_{K, S_\infty} K^\times \cong I_K / P_K = \Cl(K)
\end{equation*}

\begin{proposition}\label{prop:9_17}
    The closed subgroups of finite index of $C_K$ are precisely those subgroups that contain a congruence subgroup $C_K(\fm)$ for some modulus $\fm$.
\end{proposition}
\begin{proof}
\marginpar{\fbox{Lecture 20}}
    We first make some general remarks about topological groups. Let $G$ be a topological group, and $H$ is a subgroup of finite index in $G$. Then
    \begin{enumerate}
        \item $H$ is open iff $H$ is closed;
        \item If $H$ is closed and $H \le K \le G$, then $K$ is also closed.
    \end{enumerate}
    For 1), note that $H$ is open implies that its cosets are also open, and there are finitely many of them. For 2), $K$ is a finite union of cosets of $H$.

    ($\Leftarrow$) By the above, it suffices to show that $C_K(\fm)$ is an open subgroup of $C_K$ of finite index. It is open because $\II_K(\fm) = \prod_{\fp} U_\fp^{n_\fp}$ is open in $\II_K$. Note that $\II_K(\fm)$ is contained in $\II_{K,S_\infty}$. By \autoref{prop:9_9}, $[C_K : \II_{K, S_\infty} K^\times / K^\times] = \# \Cl(K) = h < \infty$, we have
    \begin{align*}
        [C_K : C_K(\fm)]
        &= [C_K : \II_{K, S_\infty} K^\times / K^\times] [\II_{K, S_\infty} K^\times / K^\times : C_K(\fm)]\\
        &= h [\II_{K, S_\infty} K^\times : \II_K(\fm) K^\times]\\
        &\le h [\II_{K, S_\infty} : \II_K(\fm)]
        = h \prod_{\fp} [U_\fp : U_\fp^{n_\fp}]
        < \infty
    \end{align*}

    ($\Rightarrow$) Let $N \subseteq C_K$ be a closed subgroup of finite index. Then $N$ is also open. The preimage $J$ of $N$ in $\II_K$ is an open neighbourhood of $1$, so it contains a subset of the form
    \begin{equation*}
        W = \prod_{\fp \in S} W_\fp \prod_{\fp \notin S} U_\fp
    \end{equation*}
    where $S$ is a finite set of primes of $K$ containing the infinite primes, and $W_\fp$ is a neighbourhood of $1 \in K_\fp^\times$. If $\fp \in S$ is finite, then we can choose $W_\fp = U_\fp^{n_\fp}$ for some $n_\fp$, since $U_\fp^{n_\fp}$ forms a neighbourhood basis of $1 \in K_\fp^\times$. If $\fp$ is infinite, then the open sets generate either the entire group $K_\fp^\times$, or the subgroup $\RR_+^\times$ for real primes $\fp$. This means that the subgroup of $J$ generated by $W$ is of the form $\II_K(\fm)$ for an appropriate modulus $\fm$, so $N$ is a subgroup containing $\II_K(\fm) K^\times / K^\times$.
\end{proof}

\subsection{Ideles in Field Extensions}

Next we need to study the behaviour of ideles and idele classes when we pass from $K$ to an extension $L$.

If $\fp$ is a prime of $K$ and $\cp$ is a prime of $L$ lying above $\fp$, we write $\cp \mid \fp$. We can embed $\II_K \hookrightarrow \II_L$ by $\alpha \mapsto (\alpha'_\cp)$, where $\alpha'_\cp = \alpha_\fp \in K_\fp \subseteq L_\cp$ for $\cp \mid \fp$. Thus we may regard $\II_K$ as a subgroup of $\II_L$. Explicitly, $\alpha = (\alpha_\cp) \in \II_L$ belongs to $\II_K$ iff
\begin{itemize}
    \item $\alpha_\cp \in K_\fp$ whenever $\cp \mid \fp$; and
    \item for any two primes $\cp, \cp'$ of $L$ lying above the same prime $\fp$ of $K$, $\alpha_\cp = \alpha_{\cp'}$.
\end{itemize}

\noindent Let $L/K$ be Galois, and $G = \Gal(L/K)$. We can make $\II_L$ into a (left) $G$-module as follows:

For each prime $\cp$ of $L$, $\sigma \in G$ induces an isomorphism from $L_{\sigma^{-1}\cp}$ onto $L_\cp$. {\color{blue} Indeed consider the diagram
    \begin{equation*}
        \begin{tikzcd}
            L \arrow[r, "\sigma"] \arrow[d] & L \arrow[d]\\
            L_{\sigma^{-1} \cp} \arrow[r, dashrightarrow] & L_\cp
        \end{tikzcd}
    \end{equation*}
    we have $\abs{\sigma(x)}_\cp = \abs{x}_{\sigma^{-1}\cp}$, so the universal property of $L_{\sigma^{-1} \cp}$ gives the dashed embedding above.}

We may associate an idele $\alpha = (\alpha_\cp)_\cp \in \II_L$ to the idele $\sigma \alpha = (\sigma \alpha_{\sigma^{-1} \cp})_\cp$. Note $\alpha_{\sigma^{-1} \cp} \in L_{\sigma^{-1} \cp}$ is the $\sigma^{-1}\cp$ component of $\alpha$, which is mapped by $\sigma$ into $L_\cp$.

Let $\II_L^G = \{\alpha \in \II_L \mid \sigma \alpha = \alpha \text{ for all } \sigma \in G\}$ be the fixed submodule.

\begin{proposition}\label{prop:9_18}
    If $L/K$ is a Galois extension with Galois group $G$, then $\II_L^G = \II_K$.
\end{proposition}
\begin{proof}
    ($\supseteq$) Let $\alpha \in I_K$ as an idele of $\II_L$. Fix $\cp \mid \fp$. For $\sigma \in G$, the induced map $\sigma : L_{\sigma^{-1}\cp} \to L_\cp$ is a $K_\fp$-isomorphism. Thus $(\sigma \alpha)_\cp = \sigma \alpha_{\sigma^{-1} \cp} = \sigma \alpha_\cp = \alpha_\cp$.

    ($\subseteq$) Let $\alpha \in \II_L^G$. Then for any $\sigma \in G$,
    \begin{equation}\label{eqn:9_18_star}
        \sigma \alpha_{\sigma^{-1} \cp} = (\sigma \alpha)_\cp = \alpha_\cp
    \end{equation}
    To show that $\alpha_\cp \in K_\fp$, recall from Local Fields that the restriction $\Gal(L_\cp / K_\fp) \to G$ has image the decomposition group $D_{\cp / \fp}$. Thus for any $\sigma \in \Gal(L_\cp / K_\fp)$, we have $\sigma^{-1}\cp = \cp$, so $\sigma \alpha_\cp = \alpha_\cp$ by \eqref{eqn:9_18_star}. Hence $\alpha_\cp \in K_\fp$. Again by \eqref{eqn:9_18_star}, we see that for any $\sigma \in G$, $\alpha_{\sigma^{-1}\cp} = \alpha_\cp$. We conclude by \autoref{thm:1_2}.
\end{proof}

\begin{proposition}\label{prop:9_19}
\marginpar{\fbox{Lecture 21}}
    Let $L/K$ be a finite extension. Then $L^\times \cap \II_K = K^\times$.
\end{proposition}
This means if $\alpha \in \II_K$ is an idele of $K$ that becomes principal in $L$ (i.e. $\alpha \in L^\times$), then $\alpha$ is already principal in $K$.
\begin{proof}
    Let $\Omega$ be the Galois closure of $L/K$. Then $\II_K$ and $\II_L$ are both subgroups of $\II_\Omega$. Then by \autoref{prop:9_18},
    \begin{equation*}
        K^\times \subseteq L^\times \cap \II_K \subseteq \Omega^\times \cap \II_K = \Omega^\times \cap \II_\Omega^{\Gal(\Omega / K)} = (\Omega^\times)^{\Gal(\Omega/K)} = K^\times \qedhere
    \end{equation*}
\end{proof}

\autoref{prop:9_19} immediately implies that the map $\iota : C_K \to C_L$ induced by the inclusion $\II_K \subseteq \II_L$ is injective.

Suppose $L/K$ is Galois with $G = \Gal(L/K)$, then since $\II_L$ is a $G$-module and $L^\times$ is a $G$-submodule, $C_L$ is also a $G$-module. Explicitly, for $\sigma \in \Gal(L/K)$, $\sigma [\alpha]_{C_L} = [\sigma \alpha]_{C_L}$.

\begin{proposition}
    Let $G = \Gal(L/K)$, then $C_L^G = C_K$.
\end{proposition}
\begin{proof}
    Omitted, requries cohomology.
\end{proof}

Next we define a norm homomorphism $N_{L/K} : \II_L \to \II_K$ by using local norm maps.

\subsubsection*{Local Norm}
For any $\cp \mid \fp$, $L_\cp$ is a $K_\fp$-vector space. For $\alpha \in L_\cp$, the norm map defined by $N_{L_\cp/K_\fp}(x) = \det(\mult(x))$, where $\mult(x) : L_\cp \to L_\cp$ is the $K_\fp$-linear map induced by multiplication by $x$.

Let $\alpha = (\alpha_\cp) \in \II_L$ then we define $N_{L/K}(\alpha) \in \II_K$ to be the idele with components $N_{L/K}(\alpha)_\fp = \prod_{\cp \mid \fp} N_{L_\cp / K_\fp}(\alpha_\cp)$.

\begin{proposition}\label{prop:9_21}\phantom{}
    \begin{enumerate}
        \item For a tower of fields $K \subseteq L \subseteq M$, $N_{M/K} = N_{L/K} N_{M/L}$;
        \item For $\alpha \in \II_K, N_{L/K}(\alpha) = \alpha^{[L:K]}$;
        \item The norm of a principal idele $(x) \in L^\times$ is the principal idele defined by the usual norm $N_{L/K}(x)$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    For 1) and 2), this is similar to norm of field extensions. 3) is an exercise.
\end{proof}

\subsection{Main Statements of Global Class Field Theory, Idele Theoretic Version}

\begin{theorem}[Artin Reciprocity Law]\label{thm:9_22}
    For every Galois extension $L/K$, we have a canonical isomorphism $r_{L/K} : \Gal(L/K)^\ab \xrightarrow{\sim} C_K / N_{L/K}C_L$ where $\Gal(L/K)^\ab$ is the abelianisation of $\Gal(L/K)$.
\end{theorem}
    The inverse map of $r_{L/K}$ yields a surjective homomorphism
    \begin{equation*}
        (\cdot, L/K) : C_K \to \Gal(L/K)^\ab
    \end{equation*}
    with kernel $N_{L/K}C_L$, which is called the \emph{global norm residue symbol} (we can also view this as a homomorphism $\II_K \to \Gal(L/K)^\ab$).

\begin{remark*}
    This is compatible with local class field theory (in a sense which will be made clear later).
\end{remark*}

\begin{theorem}[Existence Theorem]\label{thm:9_23}
    Let $K$ be a number field. The map $L \mapsto \cN_L = N_{L/K} C_L$ is a 1-1 correspondence between finite abelian extensions $L/K$ and the closed subgroups of finite index in $C_K$. Moreover, one has $L_1 \subseteq L_2$ iff $\cN_{L_1} \supseteq \cN_{L_2}$, and $\cN_{L_1 L_2} = \cN_{L_1} \cap \cN_{L_2}$, $\cN_{L_1 \cap L_2} = \cN_{L_1} \cN_{L_2}$.

    The field $L/K$ corresponding to the subgroup $N$ of $C_K$ satisfies $\Gal(L/K) \cong C_K / N$. The field $L$ is called the \emph{class field} of $N$.
\end{theorem}

The key to this is that the norm groups are precisely the closed subgroups of finite index in $C_K$. We know by \autoref{prop:9_17} these are precisely the subgroups that contain a congruence subgroup $C_K(\fm)$ for some modulus $\fm$.

Let $\fm$ be a modulus of $K$.

\begin{definition}\label{def:9_24}
    The class field $K(\fm)$ for the congruence subgroup $C_K(\fm)$ is called the \emph{ray class field mod $\fm$}.
\end{definition}

By \autoref{thm:9_23}, we have $\Gal(K(\fm)/K) \cong C_K / C_K(\fm)$. Note that $\fm \mid \fm'$ implies $C(\fm) \supseteq C(\fm')$, so $K(\fm) \subseteq K(\fm')$.

Since the closed subgroups of finite index in $C_K$ are precisely those containing a congruence subgroup $C_K(\fm)$, we obtain

\begin{corollary}\label{cor:9_25}
    Every finite abelian extension $L/K$ is contained in some ray class field $K(\fm)$.
\end{corollary}

\begin{definition}\label{def:9_26}
\marginpar{\fbox{Lecture 22}}
    We say a subgroup $N$ of $C_K$ is a \emph{norm group} if there is a Galois extension $L/K$ such that $N = N_{L/K} C_L$.
\end{definition}

Each norm group is the norm group of an abelian extension of $K$:
\begin{theorem}\label{thm:9_27}
    Let $L/K$ be Galois, and let $L^\ab$ be the maximal abelian extension of $K$ contained in $L$. Then $N_{L/K} C_L = N_{L^\ab / K} C_{L^\ab}$.
\end{theorem}
{\color{blue}
    Note that $\Gal(L/K)^\ab \cong \Gal(L^\ab/K)$. Indeed, let $G = \Gal(L/K)^\ab$. Then it suffices to show that $\Gal(L/L^\ab) = [G,G]$. This is equivalent to $L^\ab = L^{[G,G]}$, which is easy to check.
}
\begin{proof}
    Since $K \subseteq L^\ab \subseteq L$, the inclusion $N_{L/K} C_L \subseteq N_{L^\ab / K} C_{L^\ab}$ follows from the multiplicativity of the norm (\autoref{prop:9_21}). Now by the Artin reciprocity law, $C_K / N_{L/K} C_L \cong \Gal(L/K)^\ab \cong \Gal(L^\ab / K) \cong C_K / N_{L^\ab / K} C_{L^\ab}$. Now $[C_K : N_{L/K} C_L] = [C_K : N_{L^\ab/K} C_{L^\ab}] < \infty$ implies $N_{L/K} C_L = N_{L^\ab / K} C_{L^\ab}$.
\end{proof}

\begin{corollary}\label{cor:9_28}
    The index $[C_K : N_{L/K} C_L]$ divides the degree $[L:K]$ with equality iff it is abelian.
\end{corollary}
\begin{proof}
    Immediate by the Artin reciprocity law.
\end{proof}

\begin{proposition}\label{prop:9_29}
    The norm groups are precisely the closed subgroups of $C_K$ of finite index.
\end{proposition}
\begin{proof}[Proof (Sketch)]\phantom{}
    ($\Rightarrow$) By Artin reciprocity, $N_{L/K} C_L$ is of finite index in $C_K$. Recall from \autoref{prop:9_14} that $C_K \cong C_K^0 \times \RR_+^\times$ and $C_L \cong C_L^0 \times \RR_+^\times$. In fact, $C_K = C_K^0 \times \Gamma_K$ and $C_L = C_L^0 \times \Gamma_L$ for some $\Gamma_K, \Gamma_L \cong \RR_+^\times$. By the proof of \autoref{prop:9_14}, we can assume that $\Gamma_K = \Gamma_L \subseteq C_L$. Then $N_{L/K} C_L = N_{L/K} C_L^0 \times N_{L/K} \Gamma_K = N_{L/K} C_L^0 \times \Gamma_K^n = N_{L/K} C_L^0 \times \Gamma_K$. The norm map $N_{L/K} : C_L \to C_K$ is continuous and the image of the compact group $C_L^0$ in $C_K$ is compact, hence closed. Since $\Gamma_K \subseteq C_L$ is also closed, $N_{L/K} C_L$ is closed.

    ($\Leftarrow$) Omitted.
\end{proof}

The above proposition is also sometimes called the Existence theorem, because it says for each closed subgroup $N$ of finite index, there is an abelian extension $L$ such that $N_{L/K} = N$ (by \autoref{thm:9_27}).

We can use the idele class group to decompose prime ideals in abelian extensions.

\begin{theorem}[Decomposition Law]\label{thm:9_30}
    Let $L/K$ be an abelian extension of degree $n$, and let $\fp$ be an unramified prime ideal of $K$. If $\pi \in K_\fp$ is such that $\fp = \pi \cO_{K_\fp}$ (i.e. $\pi$ is a prime element / uniformiser), and if $f$ is the smallest number such that $\overline{n}_\fp(\pi)^f \in N_{L/K} C_L$, then $\fp$ factors in $L$ into a product of $r = \frac{n}{f}$ distinct prime ideals $\cp_1, \ldots, \cp_r$ of inertial degree $f$.
\end{theorem}

This is limited to unramified primes, but we can also use the norm group to decide whether a prime is ramified.

\begin{theorem}\label{thm:9_31}
    Let $L/K$ be abelian, $\cN_L = N_{L/K} C_L \subseteq C_K$ be the norm group, and $\fp$ a prime of $K$, then
    \begin{itemize}
        \item $\fp$ is unramified in $L$ iff $U_\fp \subseteq \cN_L$;
        \item $\fp$ splits completely in $L$ iff $K_\fp^\times \subseteq \cN_L$.
    \end{itemize}
\end{theorem}

\section{Comparison of Ideal and Idele Theoretic Versions of Global Class Field Theory}

First we show the two ray class groups $I_K(\fm) / P_K(\fm)$ (\autoref{def:2_19}) and $C_K / C_K(\fm)$ (\autoref{def:9_16}) are isomorphic. We need a variant of the Chinese remainder theorem called the approximation theorem.

\begin{theorem}[Approximation Theorem]\label{thm:10_1}
    Let $\abs{\cdot}_1, \ldots, \abs{\cdot}_n$ be pairwise inequivalent valuations on a number field. Let $\beta_1, \ldots, \beta_n$ be non-zero elements of $K$. For any $\varepsilon > 0$, there is an element $\alpha \in K$ such that $\abs{\alpha - \beta_j}_j < \varepsilon$ for each $j=1,\ldots,n$.
\end{theorem}

For a real infinite prime $\fp$, $\abs{\alpha - \beta}_\fp < \varepsilon$ for small $\varepsilon$ means $\sigma(\alpha / \beta) > 0$ (if $\sigma : K \to \RR$ corresponds to $\fp$). For a finite prime $\fp$, the condition $\abs{\alpha - \beta}_\fp < \varepsilon$ is equivalent to $\abs{\alpha / \beta}_\fp < \frac{\varepsilon}{\abs{\beta}_\fp} = \varepsilon'$. Recall that for any $\alpha \in K$, $\abs{\alpha}_\fp = c^{v_\fp(\alpha)}$, where $0 < c < 1$. If $\varepsilon'$ is small, say $\varepsilon' < c^n$ for some $n$, then $v_\fp(\alpha/\beta - 1) > n$ and this means $\alpha \equiv \beta \pmod{p^n}$. Thus $\abs{\alpha - \beta}_\fp < \varepsilon$ is equivalent to $\alpha \equiv \beta \pmod{p^n}$ for sufficiently large $n$.

\begin{proposition}\label{prop:10_2}
    We have an isomorphism $(\cdot)_\fm : C_K/C_K(\fm) \xrightarrow{\sim} I_K(\fm) / P_K(\fm)$.
\end{proposition}
\begin{proof}
\marginpar{\fbox{Lecture 23}}
    Recall we had a map $(\cdot) : \II_K \to I_K$, $\alpha \mapsto (\alpha) = \prod_{\fp \nmid \infty} \fp^{v_\fp(\alpha_\fp)}$ and an isomorphism $C_K/C_K(\fm) \cong \II_K / \II_K(\fm)K^\times$.

    Let $\II_K^{\langle \fm \rangle} = \{\alpha \in \II_K \mid \alpha_\fp \equiv 1 \text{ for } \fp \mid \fm\}$, which is a subgroup of $\II_K$. We claim that $\II_K = \II_K^{\langle \fm \rangle} \II_K(\fm) K^\times$. Let $\alpha \in \II_K$. Write $\fm = \prod_{\fp} \fp^{n_\fp}$. By the approximation theorem, there is an $x \in K^\times$ such that $\alpha_\fp x \equiv 1 \pmod{\fp^{n_\fp}}$ for $\fp \mid \fm$. Write $\alpha x = \alpha' \beta$, where
    \begin{equation*}
        \alpha'_\fp = \begin{cases}
            1 & \text{ if } \fp \mid \fm\\
            \alpha_\fp & \text{ if } \fp \nmid \fm
        \end{cases}
        \qquad
        \beta_\fp = \begin{cases}
            \alpha_\fp x & \text{ if } \fp \mid \fm\\
            x & \text{ if } \fp \nmid \fm
        \end{cases}
    \end{equation*}
    Then $\alpha' \in \II_K^{\langle \fm \rangle}$, $\beta \in \II_K(\fm)$, so that $\alpha \in \II_K^{\langle \fm \rangle} \II_K(\fm) K^\times$.

    We have
    \begin{align*}
        C_K / C_K(\fm)
        &\cong \II_K / \II_K(\fm) K^\times\\
        &= \II_K^{\langle \fm \rangle} \II_K(\fm) K^\times / \II_K(\fm) K^\times\\
        &\cong \II_K^{\langle \fm \rangle} / \II_K(\fm) K^\times \cap \II_K^{\langle \fm \rangle}
    \end{align*}
    The homomorphism $\II_K^{\langle \fm \rangle} \to I_K(\fm)/P_K(\fm)$ given by $\alpha \mapsto (\alpha) \pmod{P_K(\fm)}$  is surjective with kernel $\II_K(\fm) K^\times \cap \II_K^{\langle \fm \rangle}$. This induces an isomorphism $\cong \II_K^{\langle \fm \rangle} / \II_K(\fm) K^\times \cap \II_K^{\langle \fm \rangle} \cong I_K(\fm)/P_K(\fm)$ as required. %TODO: Check
\end{proof}

\begin{proposition}\label{prop:10.3}
    Let $L/K$ be an abelian extension with $\ff(L/K) \mid \fm$. Then the isomorphism $\overline{(\cdot)}_\fm : C_K / C_K(\fm) \to I_K(\fm) / P_K(\fm)$ of \autoref{prop:10_2} restricts to an isomorphism $N_{L/K} (C_L) / C_K(\fm) \to N_{L/K}(I_L(\fm)) P_K(\fm) / P_K(\fm)$
\end{proposition}
Recall that $T_{L/K}(\fm) = N_{L/K}(I_L(\fm)) P_K(\fm)$ is also called the norm group in the ideal theoretic version of class field theory.
\begin{proof}
    Define $\II_L^{\langle \fm \rangle} = \{\alpha \in \II_L \mid \alpha_\cp = 1 \text{ for } \cp \mid \fm\}$. Then by the proof of \autoref{prop:10_2}, we have $\II_L = \II_L^{\langle \fm \rangle} \II_L(\fm) L^\times$ and therefore
    \begin{align*}
        N_{L/K}(C_L) / C_K(\fm)
        &= N_{L/K}(\II_L) K^\times / \II_K(\fm) K^\times\\
        &= N_{L/K} (\II_L^{\langle \fm \rangle}) \II_K(\fm) K^\times / \II_K(\fm) K^\times
    \end{align*}
    The isomorphism from \autoref{prop:10_2} associates to the class of $\alpha \in \II_K^{\langle \fm \rangle}$ the class of the ideal $(\alpha) = \prod_{\fp \nmid \infty} \fp^{v_\fp(\alpha_\fp)} \in I_K(\fm)$. The elements of $N_{L/K} C_L / C_K(\fm)$ are the classes represented by the norm ideals $N_{L/K}(\II_L^{\langle \fm \rangle})$ in $\II_K^{\langle \fm \rangle}$. In particular, they are mapped precisely onto the classes of the norm ideals $N_{L/K}(I_L(\fm))$ in $I_K(\fm)$, so that means $\overline{(\cdot)}_\fm (N_{L/K}(C_L) / C_K(\fm)) = N_{L/K}(I_L(\fm)) P_K(\fm) / P_K(\fm)$.
\end{proof}

The isomorphism $\overline{(\cdot)}_\fm : C_K / C_K(\fm) \to I_K(\fm) / P_K(\fm)$ gives a surjective homomorphism $(\cdot)_\fm : C_K \to I_K(\fm) / P_K(\fm)$ with kernel $C_K(\fm)$. Let $\fp$ be a prime ideal, $\pi \in K_\fp$ a uniformiser. Let $n_\fp(\pi) = (1, \ldots, 1, \pi, 1, \ldots)$. Then $(\cdot)_\fm$ maps $[n_\fp(\pi)]_{C_K}$ to the class $\fp \pmod{P_K(\fm)}$, since $(n_\fp(\pi)) = \fp$.

\begin{theorem}\label{thm:10_4}
    Let $L/K$ be an abelain extension, $\fm$ a modulus of $K$ such that $\ff(L/K) \mid \fm$. Let $T_{L/K}(\fm) = N_{L/K}(I_L(\fm)) P_K(\fm)$. We have a commutative diagram
    \begin{equation*}
    \begin{tikzcd}
        1 \arrow[r] & N_{L/K}(C_L) \arrow[r] \arrow[d, twoheadrightarrow, "(\cdot)_\fm"] & C_K \arrow[r, "(\cdot{,} L/K)"] \arrow[d, twoheadrightarrow, "(\cdot)_\fm"] & \Gal(L/K) \arrow[r] \arrow[d, equal] & 1\\
        1 \arrow[r] & T_{L/K}(\fm) / P_K(\fm) \arrow[r] & I_K(\fm)/P_K(\fm) \arrow[r, "\left(\frac{L/K}{\cdot}\right)"] & \Gal(L/K) \arrow[r] & 1
    \end{tikzcd}
    \end{equation*}
    with exact rows.
\end{theorem}
\begin{proof}
    We show commutativity of the right square. Let $\fp$ be a prime ideal of $K$, $\fp \nmid \fm$. Let $\pi \in K_\fp$ be a uniformiser. Then $\overline{([n_\fp(\pi)])}_\fm = \fp$ as above. We need $([n_\fp(\pi)], L/K) = \left(\frac{L/K}{\fp}\right)$. This follows from the product formula for the global norm residue symbol (see next section).

    The commutativity of the left square follows from \autoref{prop:10.3} and Artin reciprocity.
\end{proof}

\section{Compatibility of Local and Global Class Field Theory}
\marginpar{\fbox{Lecture 24}}

The goal of local class field theory is to classify finite abelian extensions of a given local field $K$.

\subsection{Local Artin Reciprocity}

Let $K$ be a local field. Let $K^\sep$ be a fixed separable closure. Then write $K^\ab$ for the maximal abelian extension of $K$ inside $K^\sep$, i.e. $K^\ab = \bigcup_{\substack{L/K \text{ finite} \\ L \subseteq K^\sep}} L$.

\begin{theorem}[Local Artin Reciprocity]\label{thm:11_1}
    Let $K$ be a local field. There is a unique continuous homomorphism
    \begin{equation*}
        \theta_K : K^\times \to \Gal(K^\ab / K)
    \end{equation*}
    with the property that for each finite extension $L/K$ in $K^\ab$ the homomorphism $\theta_{L/K} : K \to \Gal(L/K)$ given by composing $\theta_K$ with the restriction $\Gal(K^\ab / K) \to \Gal(L/K)$ satisfies
    \begin{itemize}
        \item If $K$ is non-archimedian and $L/K$ unramified, then $\theta_{L/K}(\pi) = \Frob_{L/K}$, where $\pi$ is a uniformiser in $\cO_K$;
        \item $\theta_{L/K}$ is surjective with kernel $N_{L/K}(L^\times)$ inducing $K^\times / N_{L/K}(L^\times) \cong \Gal(L/K)$.
    \end{itemize}
\end{theorem}

Here $\Frob_{L/K}$ is the preimage of the Frobenius $x \mapsto x^{\# \FF_\fp}$ in $\Gal(\FF_\cp / \FF_\fp)$, where $\fp$ and $\cp$ are the maximal ideals of $K$ and $L$ respectively. Note for $L/K$ unramified, we have $\Gal(L/K) \cong \Gal(\FF_\cp / \FF_\fp)$. The map $\theta_{L/K}$ is also called the local Artin map, or local norm residue symbol, written $(\cdot, L/K)$.

\begin{remark*}\phantom{}
    \begin{itemize}
        \item The are no moduli involved, it deals with all abelian extensions at once.
        \item We see quotients of $K^\times$ instead of idele class groups.
    \end{itemize}
\end{remark*}

\subsection{Local Existence Theorem}

A \emph{norm group} of a local field $K$ is a subgroup of $N_{L/K}(L^\times)$ for $L/K$ finite abelian.

\begin{corollary}\label{cor:11_2}
    The map $L \mapsto N_{L/K}(L^\times)$ defines an inclusion reversing bijection between finite abelian extensions in $K^\ab$ and the norm groups in $K^\times$. Every norm group of $K$ has finite index in $K^\times$.
\end{corollary}

In fact, norm groups are precisely the finite index open subgroups of $K^\times$.
\begin{theorem}[Existence Theorem]
    Let $K$ be a local field, $H$ a finite index open subgroup of $K^\times$. There is a unique extension $L/K$ in $K^\ab$ with $N_{L/K}(L^\times) = H$.
\end{theorem}

\subsection{Compatibility}

Let $L/K$ be a Galois extension of number fields. Let $\fp$ be a prime of $K$, $\cp \mid \fp$. Then we have an embedding $\Gal(L_\cp / K_\fp) \hookrightarrow \Gal(L/K)$. Recall we have an injection $\overline{n}_\fp : K_\fp^\times \to C_K$, $\alpha_\fp \mapsto (1, \ldots, 1, \alpha_\fp, 1, \ldots)$.

\begin{proposition}\label{prop:11_4}
    If $L/K$ is abelian, and $\fp$ a prime above $\cp$, then the diagram
    \begin{equation*}
    \begin{tikzcd}
        K_\fp^\times \arrow[r, "(\cdot{,} L_\cp / K_\fp)"] \arrow[d, "\overline{n}_\fp"] & \Gal(L_\cp / K_\fp) \arrow[d, hookrightarrow]\\
        C_K \arrow[r, "(\cdot{,} L/K)"] & \Gal(L/K)
    \end{tikzcd}
    \end{equation*}
    commutes.
\end{proposition}

\begin{corollary}\label{cor:11_5}
    Let $L/K$ be an abelian extension, $\alpha = (\alpha_\cp) \in \II_K$, then
    \begin{equation*}
        (\alpha, L/K) = \prod_{\fp} (\alpha_\fp, L_\cp / K_\fp) \qquad\text{for } \cp \mid \fp
    \end{equation*}
\end{corollary}
For a principal idele $a \in K^\times$, we have the product formula $\prod_\fp (a, L_\cp / K_\fp) = 1$. Note this implies if $\pi$ is a uniformiser of $K$, then $(\overline{n}_\fp(\pi), L/K) = (\pi, L_\cp / K_\fp) = \Frob_{L_\cp / K_\fp} = \leg{L/K}{\fp}$ (recalling that $D_{\cp/\fp} = \Gal(L_\cp / K_\fp)$). This then finishes the proof of \autoref{thm:10_4}.

\begin{remark*}
    There is a notion of a \emph{local conductor}.
\end{remark*}

\begin{proposition}\label{prop:11_6}
    Let $L/K$ be a finite abelian extension of number field, then $\ff(L/K) = \prod_{\fp} \ff_\fp$, where $\ff_\fp$ is the local conductor.
\end{proposition}

\end{document}
