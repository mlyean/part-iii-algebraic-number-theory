\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper]{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{array}
\usepackage{bbold}
\usepackage{chngcntr}
\usepackage{commath}
\usepackage{comment}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{stmaryrd}
\usepackage{thmtools}
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{titlesec}
\usepackage[cal=boondox]{mathalfa}

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{example}[definition]{Example}
\newtheorem*{example*}{Example}
\newtheorem{notation}[definition]{Notation}
\newtheorem*{fact}{Fact}

\theoremstyle{plain}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{proposition}[definition]{Proposition}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{corollary}[definition]{Corollary}

\theoremstyle{remark}
\newtheorem{remark}[definition]{Remark}
\newtheorem*{remark*}{Remark}

\renewcommand{\qedsymbol}{$\blacksquare$}

\let\Re\undefined
\let\Im\undefined
\DeclareMathOperator{\Re}{Re}
\DeclareMathOperator{\Im}{Im}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Cl}{Cl}
\DeclareMathOperator{\res}{res}
\DeclareMathOperator{\Res}{Res}

\newcommand{\bA}{\mathbb{A}}
\newcommand{\II}{\mathbb{I}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\cC}{\mathcal{C}}
\newcommand{\cD}{\mathcal{D}}
\newcommand{\cO}{\mathcal{O}}
\newcommand{\cp}{\mathcal{p}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\fa}{\mathfrak{a}}
\newcommand{\fd}{\mathfrak{d}}
\newcommand{\ff}{\mathfrak{f}}
\newcommand{\fp}{\mathfrak{p}}
\newcommand{\fq}{\mathfrak{q}}
\newcommand{\fm}{\mathfrak{m}}
\newcommand{\fn}{\mathfrak{n}}
\newcommand{\rprod}{\Box} %TODO: Find a better symbol
\newcommand{\leg}[2]{\left(\frac{#1}{#2}\right)}
\newcommand{\subsetdot}{\stackrel{\centerdot}{\subset}}
\newcommand{\eqdot}{\stackrel{\centerdot}{=}}

\setlist[enumerate,1]{label=\arabic*), nosep}
\setlist[enumerate,2]{label=\roman*), nosep}
\setlist[itemize,1]{nosep}

% Uncomment to exclude proofs
% \excludecomment{proof}

\title{Part III Algebraic Number Theory Lecture Notes}
\author{Ming Yean Lim}

\begin{document}

\maketitle

\noindent These lecture notes were based on the Part III course Algebraic Number Theory taught during Lent 2023 by Dr. Hanneke Wiersema.

\tableofcontents

\newcommand{\sectionbreak}{\clearpage}

\section{Introduction} % No section title was given

\subsection{Recap of Algebraic Number Theory}

Let $K$ be a number field, $\cO_K$ the ring of integers of $K$. Let $L/K$ be a finite extension of number fields. Let $\fp$ be a prime ideal of $\cO_K$, then $\fp \cO_L$ is an ideal in $\cO_L$, and factors as $\fp \cO_L = \cp_1^{e_1} \ldots, \cp_g^{e_g}$, where $\cp_i$ are distinct primes ideals of $\cO_L$.

Suppose $\cp \subseteq \cO_L$. If $\cp \mid \fp \cO_L$, then we say that $\cp$ \emph{lies above} $\fp$, or $\fp$ \emph{lies under} $\cp$. Note that
\begin{equation*}
    \cp \mid \fp \cO_L \iff \fp = \cp \cap \cO_K \iff \fp \subseteq \cp
\end{equation*}

The $e_i = e_{\cp_i / \fp}$ is called the \emph{ramification index} of $\cp_i$ over $\fp$. We say that $\fp$ \emph{ramifies} in $L$ if $e_i > 1$ for some $i$.

For $\cp \subseteq \cO_L$, write $k_\cp = \cO_L / \cp$ for the corresponding residue field. Similarly, set $k_\fp = \cO_K / \fp$.

If $\cp \mid \fp$, we have an extension of residue fields $k_\cp / k_\fp$. The degree of this extension is called the \emph{inertial degree} of $\cp$ over $\fp$, denoted $f = f_{\cp / \fp}$.

\begin{theorem}\label{thm:1_1}
    Let $\fp \subseteq \cO_K$ and $\fp \cO_K = \cp_1^{e_1} \ldots \cp_g^{e_g}$ as above. Then
    \begin{equation*}
        [L : K] = \sum_{i=1}^g e_i f_i
    \end{equation*}
\end{theorem}

\subsubsection*{Galois Extensions}

Let $L/K$ be Galois.

\begin{theorem}\label{thm:1_2}
    Let $\fp \subseteq \cO_K$ be a prime ideal.
    \begin{enumerate}
        \item The Galois group $\Gal(L/K)$ acts transitively on primes of $\cO_L$ lying above $\fp$, i.e. if $\cp, \cp' \mid \fp$, then there is a $\sigma \in \Gal(L/K)$ such that $\sigma(\cp) = \cp'$.

        \item Primes $\cp_1, \ldots, \cp_g$ of $\cO_L$ lying above $\fp$ have the same ramification index $e$ and inertial degree $f$, so that $[L : K] = e f g$.
    \end{enumerate}
\end{theorem}

\noindent Let $\cp \subseteq \cO_L$ be such that $\cp \mid \fp$.

\begin{definition}
    The \emph{decomposition group} of $\cp$ is
    \begin{equation*}
        D_{\cp / \fp} = \{\sigma \in \Gal(L/K) \mid \sigma(\cp) = \cp\}
    \end{equation*}
    and the \emph{inertial group} is
    \begin{equation*}
        I_{\cp / \fp} = \{\sigma \in \Gal(L/K) \mid \forall \alpha \in \cO_L, \sigma(\alpha) \equiv \alpha \pmod{\cp}\}
    \end{equation*}
    Note that $I_{\cp/\fp} \subseteq D_{\cp/\fp}$.
\end{definition}

The extension of residue fields $k_\cp / k_\fp$ is Galois. Each $\sigma \in D_{\cp / \fp}$ induces an automorphism $\widetilde{\sigma}$ on $k_\cp$, which is the identity on $k_\fp$. We have a map $D_{\cp / \fp} \to \Gal(k_\cp / k_\fp)$, $\sigma \mapsto \widetilde{\sigma}$.

\begin{proposition}\label{prop:1_4}\phantom{}
    \begin{enumerate}
        \item $\Gal(k_\cp / k_\fp)$ is a cyclic group with canonical generator the Frobenius automorphism $x \mapsto x^q$, where $q = \abs{\cO_K / \fp}$.

        \item We have a surjective homomorphism $D_{\cp / \fp} \to \Gal(k_\cp / k_\fp)$, $\sigma \mapsto \widetilde{\sigma}$ with kernel $I_{\cp / \fp}$.

        \item $\abs{I_{\cp / \fp}} = e_{\cp / \fp}$, $\abs{D_{\cp / \fp}} = e_{\cp / \fp} f_{\cp / \fp}$.
    \end{enumerate}
\end{proposition}

\subsection{The Artin Symbol}

\begin{lemma}\label{lem:1_5}
    Let $L/K$ be Galois, and $\fp \subseteq \cO_K$ unramified in $L$. Suppose $\cp \subseteq \cO_L$ is such that $\cp \mid \fp$. Then there exists a unique $\sigma \in \Gal(L/K)$ such that for all $\alpha \in \cO_L, \sigma(\alpha) \equiv \alpha^{N(\fp)} \pmod{\cp}$, where $N(\fp) = \abs{\cO_K / \fp}$.
\end{lemma}
\begin{proof}
    By \autoref{prop:1_4}, since $\fp$ is unramified, $\abs{I_{\cp / \fp}} = 0$, and so $D_{\cp / \fp} \cong \Gal(k_\cp / k_\fp)$. Let $\sigma \in D_{\cp / \fp}$ be the unique element mapping to the Frobenius automorphism $x \mapsto x^q$. Note that $q = N(\fp)$, so we find that
    \begin{equation}\label{eqn:1_5_star}
        \sigma(\alpha) \equiv \alpha^{N(\fp)} \pmod{\cp} \qquad \forall \alpha \in \cO_L
    \end{equation}
    Note that any $\sigma \in \Gal(L/K)$ satisfying \eqref{eqn:1_5_star} is an element of $D_{\cp / \fp}$, so uniqueness follows.
\end{proof}

\begin{definition}\label{def:1_6}
    The unique element from \autoref{lem:1_5} is called the \emph{Artin symbol}, denoted $\leg{L/K}{\cp}$.
\end{definition}

\begin{corollary}\label{cor:1_7}
    Let $L/K$ be Galois, $\fp \subseteq \cO_K$ unramified, $\cp \subseteq \cO_L$ lying above $\fp$. Then
    \begin{enumerate}
        \item $\leg{L/K}{\sigma(\cp)} = \sigma \leg{L/K}{\cp} \sigma^{-1}$ for all $\sigma \in \Gal(L/K)$;

        \item The order of $\leg{L/K}{\cp}$ is $f = f_{\cp / \fp}$;

        \item $\fp$ splits completely in $L$ if and only if $\leg{L/K}{\cp} = 1$.
    \end{enumerate}
\end{corollary}
\begin{proof}\phantom{}
    \begin{enumerate}
        \item Follows from uniqueness of the Artin symbol, details will be an exercise.

        \item Since $\abs{I_{\cp / \fp}} = 1$, we have $D_{\cp / \fp} \cong \Gal(k_\cp / k_\fp)$. The Artin symbol maps to a generator of $\Gal(k_\cp / k_\fp)$, which has order $f_{\cp / \fp}$.

        \item Note that $\fp$ splits completely in $L$ means that $e = f = 1$. Since $\fp$ is unramified, $e = 1$. Thus by $2)$, $\leg{L/K}{\cp} = 1$ if and only if $f = 1$. \qedhere
    \end{enumerate}
\end{proof}

\begin{definition}\label{def:1_8}
    We say $L/K$ is an \emph{abelian extension} if $L/K$ is Galois with abelian Galois group.
\end{definition}

If $L/K$ is abelian, then $\leg{L/K}{\cp}$ depends only on $\fp$: Let $\cp' \subseteq \cO_L$ be a prime lying over $\fp$. Then $\cp' = \sigma(\cp)$ for some $\sigma \in \Gal(L/K)$ by \autoref{thm:1_2}. Then
\begin{equation*}
    \leg{L/K}{\cp'} = \leg{L/K}{\sigma(\cp)} = \sigma \leg{L/K}{\cp} \sigma^{-1} = \leg{L/K}{\cp}
\end{equation*}
by \autoref{cor:1_7}.

\begin{notation}\label{not:1_9}
    If $L/K$ is abelian, write $\leg{L/K}{\fp}$ for the Artin symbol for any $\cp / \fp$.
\end{notation}

\begin{example}\label{eg:1_10}
    Let $K = \QQ$, $L = \QQ(\sqrt{d})$, where $d \in \ZZ$ is squarefree. Recall that the discriminant is
    \begin{equation*}
        D = D_{L/K} =
        \begin{cases}
            d &\text{if } d \equiv 1 \pmod{4}\\
            4d &\text{otherwise}
        \end{cases}
    \end{equation*}
    and that $\fp = (p)$ ramifies in $L$ if and only if $p \mid D$. Identify $\Gal(L/K)$ with the multiplicative group $\{\pm 1\}$. Let $(p)$ be unramified. Then
    \begin{equation*}
        \leg{\QQ(\sqrt{d}) / \QQ}{(p)} = \leg{D}{p}
    \end{equation*}
    where $\leg{D}{p}$ is the Kronecker symbol.
\end{example}

\section{The Artin Map} % No section title was given

\subsection{Some Background and Recap}

\begin{definition}\label{def:2_1}
    A \emph{fractional ideal} of $K$ is a non-zero $\cO_K$-submodule $\fa$ of $K$ such that there is a non-zero $x \in \cO_K$ such that $x \fa \subseteq \cO_K$.
\end{definition}

\begin{notation}\label{not:2_2}
    The set of fractional $\cO_K$-ideals is a group, which we denote by $I_K$. We write $P_K$ for the subgroup of principal fractional ideals.
\end{notation}

\begin{remark}\label{rem:2_3}
    Recall that for any $\fa \in I_K$, we have a unique prime factorisation
    \begin{equation}\label{eqn:2_3_fact}
        \fa = \prod_{i=1}^\infty \fp_i^{r_i}
    \end{equation}
    where $r_i \in \ZZ$, and the $\fp_i$'s are distinct prime ideals of $\cO_K$.
\end{remark}

\subsection{The Artin Map for Unramified Extensions}
We will extend the Artin symbol to non-prime ideals, in particular, we can use the above factorisation to extend it to any $\fa \in I_K$.

\begin{definition}\label{def:2_4}
    Suppose $L/K$ is abelian and unramified, then we define the \emph{Artin map} to be the homomorphism $\leg{L/K}{\cdot} : I_K \to \Gal(L/K)$ by setting
    \begin{equation}\label{eqn:2_4_star}
        \leg{L/K}{\fa} = \prod_{i=1}^r \leg{L/K}{\fp_i}^{r_i}
    \end{equation}
    for $\fa$ with factorisation \eqref{eqn:2_3_fact}.
\end{definition}

\subsection{The Artin Map for Abelian Extensions}

If $L/K$ is unramified, we can define the Artin symbol for unramified primes, but not all primes. To define the Artin map, we work with a subgroup of $I_K$.

\begin{definition}[Modulus]\label{def:2_5}
    Let $K$ be a number field, then a \emph{modulus} in $K$ is a formal product
    \begin{equation*}
        \fm = \prod_\fp \fp^{n_\fp}
    \end{equation*}
    over all primes $\fp$, finite and infinite\footnote{see the section on finite and infinite primes later}, such that
    \begin{enumerate}
        \item $n_\fp \ge 0$ and at most finitely many are non-zero;
        \item $n_\fp = 0$ if $\fp$ is a complex infinite prime;
        \item $n_\fp \le 1$ is $\fp$ is a real infinite prime.
    \end{enumerate}
    When all exponents $n_\fp = 0$, then we set $\fm = 1$.
\end{definition}

\begin{example}\label{eg:2_6}
    If $K$ is a purely imaginary field\footnote{a number field that cannot be embedded into $\RR$}, then a modulus is just an ideal of $\cO_K$.
\end{example}

\begin{definition}\label{def:2_7}
    Let $\fm$ be a modulus, we define $I_K(\fm)$ to be the group of all fractional $\cO_K$-ideals of $\cO_K$ are relatively prime to $\fm$.
\end{definition}

For any $\fm$, we can write $\fm = \fm_0 \fm_\infty$, where $\fm_0$ is the finite part, and $\fm_\infty$ is the infinite part. Paing relatively prime to $\fm$ means being relatively prime to $\fm_0$.

\begin{example}\label{eg:2_8}
    If $\fm = 1$, then $I_K(\fm) = I_K$.
\end{example}

\begin{example}\label{eg:2_9}
    If $K = \QQ$, $\fm = (m)$ where $m$ is any integer, then
    \begin{equation*}
        I_\QQ(\fm) = \bigg\{ \frac{a}{b}\ZZ \,\bigg\vert\, (a, m) = (b, m) = 1 \bigg\}
    \end{equation*}
\end{example}

Let $L/K$ be abelian. Let $\fm$ be a modulus of $K$ that is divisible by all ramified primes of $K$, then for each $\fp$ in $I_K(\fm)$, we can define the Artin symbol $\leg{L/K}{\fp} \in \Gal(L/K)$.

\begin{definition}\label{def:2_10}
    Let $\fm$ be as above, then the \emph{Artin map} for $L/K$ and $\fm$ is a homomorphism $\Phi_{\fm} : I_K(\fm) \to \Gal(L/K)$ defined by extending the Artin symbol multiplicatively as in \eqref{eqn:2_4_star}.
\end{definition}

\begin{example}\label{eg:2_11}
    Let $\fm$ be a positive integer, $\zeta_m$ a primitive $m$\textsuperscript{th} root of unity. Let $K = \QQ$, $L = \QQ(\zeta_m)$. Recall that
    \begin{enumerate}
        \item $\Gal(\QQ(\zeta_m) / \QQ) \cong (\ZZ / m \ZZ)^\times$, where the isomorphism sends $\sigma : \zeta_m \mapsto \zeta_m^h$ to $[h]$;
        \item If a prime $p$ ramifies in $\QQ(\zeta_m)$, then $p \mid m$.
    \end{enumerate}
    Write $\infty$ for the real infinite prime of $\QQ$. Let $\fm = (m) \infty$. Then $\fm$ contains all ramified primes, so we have a well-defined map $\Phi_\fm : I_\QQ(\fm) \to \Gal(\QQ(\zeta_m) / \QQ)$.

    For a prime $p \nmid m$, let $\cp$ be a prime lying over $(p)$. Let $\sigma = \leg{L/K}{\cp}$. Then by definition, $\sigma(\zeta_m) \equiv \zeta_m^p \pmod{\cp}$. Write $\sigma(\zeta_m) = \zeta_m^h$ for some $h \in \ZZ$. Then $\zeta_m^{h-p} \equiv 1 \pmod{\cp}$. If $\zeta_m^{h-p} \neq 1$, then
    \begin{equation*}
        0 = (\zeta_m^{h-p})^{m-1} + \ldots + \zeta_m^{h-p} + 1 \equiv m \pmod{\cp}
    \end{equation*}
    contradicting $p \nmid m$. Thus $\sigma(\zeta_m) = \zeta_m^p$, so $\Phi((p)) = [p] \in (\ZZ / m \ZZ)^\times$.

    Let $\frac{a}{b}\ZZ \in I_\QQ(\fm)$, then $\Phi_\fm(\frac{a}{b} \ZZ) = [a][b]^{-1} \in (\ZZ / m \ZZ)^\times$.
    The map is clearly surjective.
\end{example}

\subsection{Generalised Ideal Class Group}

\begin{definition}\label{def:2_12}
    Let $P_K(\fm)$ be the subgroup of $I_K(\fm)$ consisting of all principal fractional ideals $(\alpha)$, where $\alpha \in K$ is such that
    \begin{itemize}
        \item $v_\fp(\alpha - 1) \ge v_\fp(\fm_0) = n_\fp$ for any $\fp \mid \fm_0$;
        \item $\sigma(\alpha) > 0$ for every real infinite prime $\sigma \mid \fm_\infty$.
    \end{itemize}
\end{definition}

\begin{example}\label{eg:2_13}
    Let $\fm = 1$, then $P_K(\fm) = P_K$.
\end{example}

\begin{example}\label{eg:2_14}
    Let $K = \QQ$, $\fm = (m)$. Note a fractional ideal $(\alpha)$ is generated by both $+\alpha$ and $-\alpha$. If $(\alpha) \in P_\QQ(\fm)$, then we must have $v_p(\alpha - 1) \ge v_p(m)$ for $p \mid m$, so
    \begin{equation*}
        P_\QQ(\fm) = \bigg\{\frac{a}{b}\ZZ \in I_\QQ(\fm) \,\big\vert\, a \equiv b \pmod{m}\bigg\}
    \end{equation*}

    \noindent Next let $\fm' = (m) \infty$, then $I_\QQ(\fm') = I_\QQ(\fm')$, but $P_\QQ(\fm) \neq P_\QQ(\fm')$, as
    \begin{equation*}
        P_\QQ(\fm') = \bigg\{\frac{a}{b}\ZZ \in I_\QQ(\fm) \,\big\vert\, a \equiv b \pmod{m},\, \frac{a}{b} > 0\bigg\}
    \end{equation*}
\end{example}

\begin{remark}\label{remark:2_15}
    In the setting of \autoref{eg:2_11}, we have $\ker \Phi_\fm = P_\QQ(\fm)$ for $\fm = (m) \infty$.
\end{remark}

The group $P_K(\fm)$ for any $K$ or $\fm$ is sometimes called a \emph{ray}, or the \emph{ray group}.

\begin{proposition}\label{prop:2_16}
    The subgroup $P_K(\fm)$ has finite index in $I_K(\fm)$.
\end{proposition}
\begin{proof}
    Omitted, a special case will be an exercise.
\end{proof}

\subsubsection*{Interlude -- Finite an Infinite Primes}
A \emph{finite prime} is a prime ideal of $\cO_K$. An \emph{infinite prime} is determined by embeddings of $K \hookrightarrow \CC$.
\begin{itemize}
    \item A \emph{real infinite prime} is an embedding $K \hookrightarrow \RR$;
    \item A \emph{complex infinite prime} is a pair of complex conjugate embeddings $\sigma, \overline{\sigma} \hookrightarrow \CC$, $\sigma \neq \overline{\sigma}$.
\end{itemize}

\begin{remark*}
    Compare this with places or absolute values, archimedian and non-archimedian, from the Local Fields course.
\end{remark*}

\begin{example*}\phantom{}
    \begin{itemize}
        \item $\QQ$ has one real infinite prime, which is the identity.
        \item $\QQ(\sqrt{2})$ has two real infinite primes, determined by $\sigma(\sqrt{2}) = \sqrt{2}$ and $\sigma(\sqrt{2}) = -\sqrt{2}$.
        \item $\QQ(\sqrt{-2})$ has one pair of complex infinite primes, $\sigma(\sqrt{-2}) = \sqrt{-2}$ and $\overline{\sigma}(\sqrt{-2}) = -\sqrt{-2}$.
    \end{itemize}
\end{example*}

\begin{remark*}
    Let $L/K$ be an extension of number fields, an infinite prime $\sigma$ of $K$ ramifies in $L$ if $\sigma$ is real and extends to a complex prime of $L$.
\end{remark*}

\begin{example*}
    The real infinite prime of $\QQ$ is unramified in $\QQ(\sqrt{2})$, but ramified in $\QQ(\sqrt{-2})$.
\end{example*}

\noindent Now we return to the topic of generalised ideal class groups.

\begin{definition}\label{def:2_17}
    A subgroup $H \subseteq I_K(\fm)$ is a \emph{congruence subgroup} for $\fm$ if $P_K(\fm) \subseteq H \subseteq I_K(\fm)$.
\end{definition}

\begin{definition}\label{def:2_18}
    Let $H$ be a congruence subgroup for $\fm$. Then the quotient $I_K(\fm)/H$ is a \emph{generalised ideal class group}.
\end{definition}

\begin{definition}\label{def:2_19}
    The quotient $I_K(\fm)/P_K(\fm)$ is called the \emph{ray class group}.
\end{definition}

\begin{example}\label{eg:2_20}
    Let $\fm = 1$, $I_K(\fm)/P_K(\fm) = I_K/P_K = \Cl(K)$, where $\Cl(K)$ is the ideal class group of $K$.
\end{example}

\begin{proposition}\label{prop:2_21}
    Write $P_\fm \subseteq I_K(\fm)$ for the subgroup of principal fractional ideals that are relatively prime to $\fm$. Thern we have an exact sequence
    \begin{equation*}
        1 \longrightarrow P_\fm/P_K(\fm) \longrightarrow I_K(\fm)/P_K(\fm) \longrightarrow \Cl(K) \longrightarrow 1
    \end{equation*}
\end{proposition}

\begin{remark}\label{rem:2_22}
    In fact, writing $h_K(\fm) = \abs{I_K(\fm)/P_K(\fm)}$, we can use this to show $h_K \mid h_K(\fm)$, where $h_K$ is the class number of $K$.
\end{remark}

\begin{remark}\label{rem:2_23}
    If we have any $\cO_K$-ideal $I$, then every ideal class in $\Cl(K)$ can be represented by an ideal coprime to $I$.
\end{remark}

\begin{proof}[Proof of \autoref{prop:2_21} (Sketch)]
    Let $\fa \in I_K(\fm)$. Define $h : I_K(\fm) \to \Cl(K)$ by $h(\fa) = [\fa] \in \Cl(K)$. This is a surjective\footnote{use \autoref{rem:2_23}} group homomorphism with kernel $P_\fm$. Thus we have an exact sequence
    \begin{equation*}
        1 \longrightarrow P_\fm \longrightarrow I_K(\fm) \longrightarrow \Cl(K) \longrightarrow 1
    \end{equation*}
    Since $h$ is trivial on $P_K(\fm)$, we can rewrite this as
    \begin{equation*}
        1 \longrightarrow P_\fm/P_K(\fm) \longrightarrow I_K(\fm)/P_K(\fm) \longrightarrow \Cl(K) \longrightarrow 1 \qedhere
    \end{equation*}
\end{proof}

\begin{example}\label{eg:2_24}
    Let $K = \QQ$, and $m$ a positive integer. Then $I_\QQ((m))/P_\QQ((m)) \cong (\ZZ/m\ZZ)^\times / \{\pm 1\}$, and $I_\QQ((m)\infty)/P_\QQ((m)\infty) \cong (\ZZ/m\ZZ)^\times$ (c.f. \autoref{eg:2_9} and \autoref{eg:2_14}).

    Recall the Artin map $\Phi_\fm : I_\QQ(\fm) \to \Gal(\QQ(\zeta_\fm) / \QQ)$ for $\QQ(\zeta_m)/\QQ$ from \autoref{eg:2_11}, where $\fm = (m) \infty$. It is surjective with $\ker \Phi_\fm = P_\QQ(\fm)$, so we see that $I_\QQ(\fm)/P_\QQ(\fm) \cong \Gal(\QQ(\zeta_m)/\QQ) \cong (\ZZ/m\ZZ)^\times$.
\end{example}

\begin{remark}\label{rem:2_25}
    The idea of class field theory is that generalised ideal class groups are Galois group of abelian extensions of $K$, and that the link is given by the Artin map.
\end{remark}

\noindent We need to know how the Artin map behaves in field towers:

\begin{proposition}\label{prop:2_26}
    Let $K \subseteq L \subseteq M$ be a tower of abelian extensions. Suppose $\fm$ contains all primes of $\cO_K$ that ramify in $M$. Then we have a commutative diagram
    \begin{equation*}
    \begin{tikzcd}
        I_K(\fm) \arrow[r, "\Phi_{M/K,\fm}"] \arrow[rd, "\Phi_{L/K,\fm}"'] & \Gal(M/K) \arrow[d, "\res"] & \sigma \arrow[d, mapsto]\\
                                                                           & \Gal(L/K) & \sigma \vert_L
    \end{tikzcd}
    \end{equation*}
\end{proposition}
\begin{proof}
    Exercise.
\end{proof}

\section{Statements of Global Class Field Theory}

\subsection{The Conductor}

\begin{lemma}\label{lem:3_1}
    Let $L/K$ be abelian, and let $\fm$ be a modulus containing all ramified primes\footnote{finite and infinite} of $K$. Let $\fn$ be another modulus with $\fm \mid \fn$. If $P_K(\fm) \subseteq \ker \Phi_\fm$, then $P_K(\fn) \subseteq \ker \Phi_\fn$.
\end{lemma}
\begin{proof}
    Since $\fm \mid \fn$, $P_K(\fn) \subseteq P_K(\fm)$, and $\Phi_\fn = \Phi_\fm \vert_{I_K(\fn)}$. Then
    \begin{equation*}
        P_K(\fn) \subseteq P_K(\fm) \cap I_K(\fn) \subseteq \ker \Phi_\fm \cap I_K(\fn) = \ker \Phi_\fn \qedhere
    \end{equation*}
\end{proof}

\noindent In the setting of the lemma, this means that if $\ker \Phi_\fm$ is a congruence subgroup for $\fm$, then so is $\ker \Phi_\fn$ for $\fn$.

The is one special modulus:

\begin{theorem}[The Conductor Theorem]\label{thm:3_2}
    Let $L/K$ be abelian, then there is a modulus $\ff(L/K)$ such that
    \begin{enumerate}
        \item a prime of $K$, finite or infinite, ramifies in $L$ if and only if it divides $\ff(L/K)$;
        \item if $\fm$ is a modulus divisible by all primes of $K$ that ramify in $L$, then $\ker \Phi_\fm$ is a congruence subgroup for $\fm$ if and only if $\ff(L/K) \mid \fm$.
    \end{enumerate}
    The modulus is uniquely determined by $L/K$, and is called the \emph{conductor} of $L/K$.
\end{theorem}

\begin{example}\label{eg:3_3}
    Let $K = \QQ$, and $L = K(\sqrt{d})$, with $d \in \ZZ$ squarefree. Then
    \begin{equation*}
        \ff(L/K) =
        \begin{cases}
            \abs{D} & \text{if } d>0\\
            \abs{D}\infty & \text{if } d<0
        \end{cases}
    \end{equation*}
    where $D$ is the discriminant of $L$, and $\infty$ is the real infinite prime of $\QQ$.
\end{example}

\begin{example}\label{eg:3_4}
    The conductor of the cyclotomic extensions $\QQ(\zeta_m)/\QQ$ is
    \begin{equation*}
        \ff(L/K) =
        \begin{cases}
            1 & \text{if } m \le 2\\
            (\frac{m}{2}) \infty &\text{if } m = 2n, n>1 \text{ odd}\\
            (m) \infty &\text{otherwise}
        \end{cases}
    \end{equation*}
\end{example}

\begin{remark}\label{rem:3_5}
    The conductor is not always the product of ramified primes. In the example sheet, we will see an example of a cubic extensions $L/\QQ$ ramified only at $3$, but for $\fm = (3), (3)\infty$, $\ker(\Phi_{L/\QQ, \fm})$ is not a congruence subgroup, so $\ff(L/Q) \nmid (3)$ or $(3) \infty$.
\end{remark}

\subsection{Artin Reciprocity}

For each abelian extension $L/K$, $\Gal(L/K)$ is a generalised ideal class group:

\begin{theorem}\label{thm:3_6}
    Let $L/K$ be an abelian extension. Let $\fm$ be a modulus divisible by $\ff(L/K)$. Then the Artin map $\Phi_\fm : I_K(\fm) \to \Gal(L/K)$ is surjective, $\ker{\Phi_\fm}$ is a congruence subgroup, and we have an isomorphism $I_K(\fm)/\ker \Phi_\fm \cong \Gal(L/K)$ induced by $\Phi_\fm$.
\end{theorem}

We will next describe the kernel.

\begin{notation}\label{not:3_7}
    Write $N_{L/K} : I_L \to I_K$ for the norm map defined by
    \begin{equation*}
        \prod_i \cp_i^{n_i} \mapsto \prod_i \fp_i^{f_{\cp_i / \fp_i} n_i}
    \end{equation*}
    so in particular, if $\cp \mid \fp$, then $N_{L/K}(\cp) = \fp^{f_{\cp/\fp}}$.
\end{notation}

\begin{definition}\label{def:3_8}
    Let $L/K$ be abelian, $\fm$ a modulus divisible by $\ff_{L/K}$. Then the \emph{norm group} (also known as \emph{Takagi group}) associated to $\fm$ is the congruence subgroup
    \begin{equation*}
        T_{L/K}(\fm) = N_{L/K}(I_L(\fm))P_K(\fm)
    \end{equation*}
    where $I_L(\fm) \subseteq I_L$ consists of fractional ideals that are coprime to $\fm \cO_L$.
\end{definition}

\begin{theorem}[Artin Reciprocity Continued]\label{thm:3_9}
    We have $\ker \Phi_\fm = T_{L/K}(\fm)$.
\end{theorem}

We will prove surjectivity of $\Phi_\fm$ using density theorems later in the course.

\begin{proposition}\label{prop:3_10}
    Let $L/K$ be abelian, $\fm$ divisible by $\ff(L/K)$. Then $\ker \Phi_\fm \subseteq T_{L/K}(\fm)$.
\end{proposition}
\begin{proof}
    We will prove if for primes, then the result follows\footnote{we will see why later} from multiplicativity of $\Phi_\fm$. Suppose that $\fp \subseteq \cO_K$ is such that $\fp \in \ker \Phi_\fm$. Then $\leg{L/K}{\fp} = 1$, so we know by \autoref{cor:1_7} that $\fp$ splits completely in $L$, and $f_{\cp / \fp} = 1$ for any $\cp \mid \fp$. Suppose $\cp \subseteq \cO_L$ is such that $\cp \mid \fp$, then $N_{L/K}(\cp) = \fp^{f_{\cp/\fp}} = \fp$, so $\fp \in N_{L/K}(I_L(\fm)) \subseteq T_{L/K}(\fm)$.
\end{proof}

\noindent Artin reciprocity gives us information about the decomposition of primes:

\begin{theorem}[Decomposition Theorem]\label{thm:3_11}
    Let $L/K$ be an abelian extension of degree $n$. Let $\fp \subseteq \cO_K$ be unramified in $L$. Let $\fm$ be divisible by $\ff(L/K)$, but not divisible by $\fp$. Write $H = \ker \Phi_\fm$ for the congruence subgroup for $\fm$. Suppose $f$ is the smallest positive integer such that $\fp^f \in H$, i.e. the order of $\fp \pmod{H}$ in $I_K(\fm) / H$. Then $\fp$ decomposes in $L$ into a product $\fp = \cp_1 \ldots \cp_g$, of $g = \frac{n}{f}$ distinct prime ideals of degree $f$ over $\fp$.
\end{theorem}
\begin{proof}
    Let $\fp = \cp_1 \ldots \cp_g$ be the prime decomposition of $\fp$ in $L$. The $\cp_i$ are distinct a $\fp$ is unramified. They have the same inertia degree $f$ (by \autoref{thm:1_2}). We know $f$ is the order of $\leg{L/K}{\fp}$, so under the isomorphism $I_K(\fm) / H \cong \Gal(L/K)$, this means that it is also the order of $\fp \pmod{H}$ in $I_K(\fm) / H$. The result follows from $n = fg$ by \autoref{thm:1_2}.
\end{proof}

\subsection{The Existence Theorem}

Every generalised ideal class group is the Galois group of some abelian extension.

\begin{theorem}[Existence Theorem]\label{thm:3_12}
    Let $\fm$ be a modulus of $K$, and $H$ any congruence subgroup for $\fm$, i.e. $P_K(\fm) \subseteq H \subseteq I_K(\fm)$. Then there is a unique abelian extension $L/K$ with the property that all its ramified (finite and infinite) primes divide $\fm$, such that $H = N_{L/K}(I_L(\fm)) P_K(\fm)$ and $I_K(\fm) / H \xrightarrow{\sim} \Gal(L/K)$ under $\Phi_\fm$.
\end{theorem}

\begin{definition}[Ray Class Field]\label{def:3_13}
    Let $\fm$ be any modulus. Let $H$ be the congruence subgroup $P_K(\fm)$. Then the \emph{ray class field} is the unique abelian extension $K_\fm$ of $K$ such that $P_K(\fm) = \ker(\Phi_{K_\fm / K, \fm})$, given by the Existence \autoref{thm:3_12}.

    In particular, $\Gal(K_\fm / K) \cong I_K(\fm)/P_K(\fm)$ is the ray class group.
\end{definition}

\begin{example}\label{eg:3_14}
    Let $m$ be a positive integer, $m \not\equiv 2 \pmod{4}$. Let $K = \QQ$. If $\fm = (m) \infty$, then $K_\fm = \QQ(\zeta_m)$. If $\fm = (m)$, then $K_\fm = \QQ(\zeta_m + \zeta_m^{-1})$, the maximal real subfield of $\QQ(\zeta_m)$.
\end{example}

\begin{corollary}\label{cor:3_15}
    Let $L/K$, $M/K$ be abelian extensions. Then $L \subseteq M$ iff there is a modulus $\fm$ divisible by all primes of $K$ ramified in either $L$ or $M$, such that $P_K(\fm) \subseteq \ker \Phi_{M/K, \fm} \subseteq \ker \Phi_{L/K, \fm}$.
\end{corollary}

\begin{remark}\label{rem:3_16}
    This implies every abelian extension is contained in a ray class field: If $L/K$ is abelian and $\ff(L/K) \mid \fm$, then $H = \ker \Phi_{L/K, \fm}$ is a congruence subgroup by \autoref{thm:3_6}, $P_K(\fm) \subseteq H$, so by \autoref{cor:3_15}, $L \subseteq K_\fm$.
\end{remark}

\begin{proof}[Proof of \autoref{cor:3_15} (Sketch)]
    ($\Rightarrow$) Suppose that $L \subseteq M$, so by Artin Reciprocity \autoref{thm:3_6}, there exist moduli $\fm_1$ and $\fm_2$ such that $P_K(\fm_1) \subseteq \ker \Phi_{L/K, \fm_1}$ and $P_K(\fm_2) \subseteq \ker \Phi_{M/K, \fm_2}$. Let $\fm$ be a modulus divisible by both $\fm_1$ and $\fm_2$. By \autoref{lem:3_1}, $P_K(\fm) \subseteq \ker \Phi_{L/K,\fm}$, and $P_K(\fm) \subseteq \ker \Phi_{M/K,\fm}$. By \autoref{prop:2_26}, $\Phi_{L/K, \fm} = \res \circ \Phi_{M/K, \fm}$, where $\res : \Gal(M/K) \to \Gal(L/K)$. The result follows.

    ($\Leftarrow$) Suppose $P_K(\fm) \subseteq \ker \Phi_{M/K, \fm} \subseteq \ker \Phi_{L/K, \fm}$ for some $\fm$. Then under $\Phi_{M/K, \fm} : I_K(\fm) \to \Gal(M/K)$, the subgroup $\ker \Phi_{L/K, \fm}$ maps to a subgroup $H \subseteq \Gal(M/K)$. By Galois theory, $H$ corresponds to an intermediate field $K \subseteq \widetilde{L} \subseteq M$. Now the first part of the proof applied to $\widetilde{L} \subseteq M$ shows that we have $\ker \Phi_{\widetilde{L}/K, \fm} = \ker \Phi_{L/K, \fm}$. Then by the uniqueness part in the Existence \autoref{thm:3_12}, we have $L = \widetilde{L} \subseteq M$.
\end{proof}

\begin{theorem}\label{thm:3_17}
    Let $K$ be a number field. There is a 1-to-1 inclusion reversing correspondence
    \begin{equation*}
        \{\text{abelian extensions of } K\} \longleftrightarrow \{\text{generalised ideal class groups of } K\}
    \end{equation*}
\end{theorem}

\section{Applications of Global Class Field Theory}

\subsection{Kronecker-Weber}

\begin{theorem}\label{thm:4_1}
    Let $L/\QQ$ be an abelian extension. Then there is a positive integer $\fm$ such that $L \subseteq \QQ(\zeta_m)$.
\end{theorem}
\begin{proof}
    By Artin reciprocity, there is a modulus $\fm$ such that $P_\QQ(\fm) \subseteq \ker \Phi_{L/\QQ, \fm}$. By \autoref{lem:3_1}, we may assume that $\fm = (m) \infty$. We have seen (see \autoref{remark:2_15}) that $P_\QQ(\fm) = \ker \Phi_{\QQ(\zeta_m)/\QQ, \fm}$, so $P_\QQ(\fm) = \ker \Phi_{\QQ(\zeta_m)/\QQ, \fm} \subseteq \ker \Phi_{L/\QQ, \fm}$. Then $L \subseteq \QQ(\zeta_m)$ by \autoref{cor:3_15}.
\end{proof}

\subsection{Hilbert Class Field}

The Existence \autoref{thm:3_12} gives us an abelian extension that is unramified and has Galois group equal to the ideal class group of $K$. Let $\fm = 1$ and let $K_\fm$ be the corresponding ray class field. Then $K_\fm / K$ is unramified\footnote{at finite and infinite primes, also for \autoref{thm:4_5}} and $\Gal(K_\fm/K) \cong I_K(1) / P_K(1) \cong \Cl(K)$.

\stepcounter{definition} % Numbering issue

\begin{definition}\label{def:4_3}
    This is called the \emph{Hilbert class field}.
\end{definition}

\begin{example}\label{eg:4_4}
    If $K = \QQ$, then the Hilbert class field is $\QQ$.
\end{example}

\begin{theorem}\label{thm:4_5}
    The Hilbert class field is the maximal unramified abelian extension of $K$.
\end{theorem}
\begin{proof}
    Write $F$ for the Hilbert class field of $K$. Suppose $M/K$ is an unramified abelian extension. By the Conductor \autoref{thm:3_2}, $\ff(M/K) = 1$ and $P_K(\ff(M/K)) = P_K(1) \subseteq \ker \Phi_{M/K, 1}$ also by the Conductor Theorem. Thus $P_K(1) = P_K = \ker \Phi_{F/K, 1}$, so $M \subseteq F$ by \autoref{cor:3_15}.
\end{proof}

\begin{corollary}[Class Field Theory for Unramified Extensions]\label{cor:4_6}
    Let $K$ be a number field. Then there is a 1-to-1 inclusion reversing correspondence
    \begin{equation*}
        \{\text{unramified abelian extensions of } K\} \longrightarrow \{\text{subgroups of } \Cl(K)\}
    \end{equation*}
    If $M/K$ corresponds to $H \subseteq \Cl(K)$, then the Artin map induces an isomorphism $\Cl(K)/H \xrightarrow{\sim} \Gal(M/K)$.
\end{corollary}

\begin{example}\label{eg:4_7}
    Let $K = \QQ(\sqrt{-5})$. We show that the Hilbert class field $F$ is equal to $L = \QQ(\sqrt{-5}, i)$.

    We use (without proof) that $h_K = 2$, so
    \begin{equation*}
        \abs{\Gal(F/K)} = \abs{I_K/P_K} = \abs{\Cl(K)} = 2
    \end{equation*}
    so $F$ is an unramified quadratic extension.
    \begin{equation*}
    \begin{tikzcd}
        & \QQ(\sqrt{-5}, i) \arrow[dl, dash] \arrow[d, dash] \arrow[dr, dash] &\\
        \QQ(i) \arrow[dr, dash, "\text{only } 2 \text{ ramifies}"'] & \QQ(\sqrt{-5}) \arrow[d, dash] & \QQ(\sqrt{5}) \arrow[dl, dash, "\text{only } 5 \text{ ramifies}"]\\
        & \QQ
    \end{tikzcd}
    \end{equation*}
    If $p \neq 2, 5$, then $p$ is unramified in both $\QQ(\sqrt{5})$ and $\QQ(i)$. Therefore in $\QQ(\sqrt{-5}, i)$. Thus primes of $\QQ(\sqrt{-5})$ not above $2$ or $5$ are unramified. Note that $2, 5$ are already ramified in $\QQ(\sqrt{-5})$, so primes above them are unramified in $\QQ(\sqrt{-5}, i)/\QQ(\sqrt{-5})$. Thus $F = \QQ(\sqrt{-5}, i)$.
\end{example}

\begin{corollary}\label{cor:4_8}
    Let $F$ be the Hilbert class field of $K$. Let $\fp \subseteq \cO_K$ be a prime ideal. Then $\fp$ splits completely in $F$ iff $\fp$ is a principal ideal.
\end{corollary}
\begin{proof}
    We know by \autoref{cor:1_7} that $\fp$ splits completely in $F$ iff $\leg{F/K}{\fp} = 1$. The Artin map induces an isomorphism $\Cl(K) \cong \Gal(F/K)$, so $\leg{F/K}{\fp} = 1$ iff $[p] = [1]$ in $\Cl(K)$.
\end{proof}

\begin{theorem}[Principal Ideal Theorem]\label{thm:4_9}
    In the Hilbert class field, every ideal of $K$ becomes principal.
\end{theorem}

\begin{example}\label{eg:4_10}
    Let $K = \QQ(\sqrt{-5})$. Then $\Cl(K) = \{[\cO_K], [(2, 1+\sqrt{-5})]\}$. We have seen the Hilbert class field of $K$ is $F = \QQ(i, \sqrt{-5})$, and $(2, 1+\sqrt{-5}) \cO_F$ is generated by $1+i$ in $\cO_F$.
\end{example}

\subsection{Reciprocity Theorems}

Let $K$ be a number field containing a primitive $n$\textsuperscript{th} root of unity $\zeta$. Let $\fp$ be a prime ideal of $\cO_K$. Then for $\alpha \in \cO_K$ prime to $\fp$, we have $\alpha^{N(\fp) - 1} \equiv 1 \pmod{\fp}$ by Fermat's Little Theorem. Suppose in addition $\fp$ is prime to $n$. Then $\zeta$ has order $n$ in $\cO_K / \fp$ (see \autoref{eg:2_11}). Thus $x = \alpha^{\frac{N(\fp)-1}{n}}$ is a solution to the congruence $x^n \equiv 1 \pmod{\fp}$, so
\begin{equation*}
    \alpha^{\frac{N(\fp)-1}{n}} \equiv 1, \zeta, \ldots, \zeta^{n-1} \pmod{\fp}
\end{equation*}
Since the $n$\textsuperscript{th} roots of unity are distinct modulo $\fp$, $\alpha^{\frac{N(\fp)-1}{n}}$ is congruent to a unique $n$\textsuperscript{th} root of unity. We define the \emph{$n$\textsuperscript{th} power Legendre symbol} $\leg{\alpha}{\fp}_n$ as that unique root of unity, so $\alpha^{\frac{N(\fp)-1}{n}} \equiv \leg{\alpha}{\fp}_n \pmod{\fp}$. More generally, let $\fa = \fp_1 \ldots \fp_r$ be an ideal of $\cO_K$, prime to $n$ and $\alpha$. Then set
\begin{equation*}
    \leg{\alpha}{\fa}_n = \prod_{i=1}^r \leg{\alpha}{\fp_i}_n
\end{equation*}
Thus if $\fm$ is a modulus of $K$ such that every prime containing $n\alpha$ divides $\fm$, then we obtain a homomorphism
\begin{equation*}
    \leg{\alpha}{\cdot}_n : I_K(\fm) \to \mu_n
\end{equation*}
where $\mu_n \subseteq \CC^\times$ is the group of $n$\textsuperscript{th} roots of unity.

\subsubsection*{Galois Theory}
If $K$ has a primitive $n$\textsuperscript{th} root of unity, then for $\alpha \in K$, letting $L = K(\sqrt[n]{\alpha})$, $L/K$ is Galois and for $\sigma \in \Gal(L/K)$, $\sigma(\sqrt[n]{\alpha}) = \zeta \sqrt[n]{\alpha}$ for some $n$\textsuperscript{th} root of unity $\zeta$. Thus we have a map $\sigma \mapsto \zeta$. This gives an injective homomorphism $\Gal(L/K) \hookrightarrow \mu_n$.

\begin{theorem}[Weak Reciprocity]\label{thm:4_11}
    Let $K$ be a number field containing a primitive $n$\textsuperscript{th} root of unity. Let $L = K(\sqrt[n]{\alpha})$ for some non-zero $\alpha \in \cO_K$. Assume $\fm$ is divisible by all primes containing $n\alpha$ and assume $\ker(\Phi_{L/K, \fm})$ is a congruence subgroup for $\fm$. Then there is a commutative diagram
    \begin{equation*}
    \begin{tikzcd}
        I_K(\fm) \arrow[r, "\Phi_{L/K, \fm}"] \arrow[rd, "\leg{\alpha}{\cdot}_n"'] & \Gal(L/\QQ) \arrow[d, hookrightarrow]\\
                           & \mu_n
    \end{tikzcd}
    \end{equation*}
    If $G$ is the image of $\Gal(L/\QQ)$ in $\mu_n$, then $\leg{\alpha}{\cdot}_n$ induces a surjective homomorphism $\leg{\alpha}{\cdot} : I_K(\fm)/P_K(\fm) \to G \subseteq \mu_n$.
\end{theorem}
\begin{proof}
    Using the definition of the Artin symbol, we see that
    \begin{equation*}
        \zeta^k \sqrt[n]{\alpha} = \leg{L/K}{\fp}(\sqrt[n]{\alpha}) \equiv \sqrt[n]{\alpha}^{N(\fp)} \pmod{\fp}
    \end{equation*}
    for some $k$. Thus
    \begin{equation*}
        \zeta^k \equiv \alpha^\frac{N(\fp)-1}{n} \equiv \leg{\alpha}{\fp}_n \pmod{\fp}
    \end{equation*}
    so
    \begin{equation*}
        \leg{L/K}{\fp}(\sqrt[n]{\alpha}) = \leg{\alpha}{\fp}_n \sqrt[n]{\alpha}
    \end{equation*}
    This gives commutativity. We have $P_K(\fm) \subseteq \ker \Phi_{L/K, \fm} \subseteq I_K(\fm)$, so we have a surjective homomorphism
    \begin{equation*}
        I_K(\fm) / P_K(\fm) \to I_K(\fm) / \ker \Phi_{L/K, \fm} \xrightarrow{\sim} \Gal(L/K)
    \end{equation*}
    The result follows from commutativity.
\end{proof}

\noindent Strong reciprocity gives a formula for $\leg{\alpha}{\fa}_n$ in terms of $n$\textsuperscript{th} power Hilbert symbols.

\noindent Recall that for $p$ odd,
\begin{gather*}
    \leg{a}{p} =
    \begin{cases}
        0 & \text{if } p \mid a\\
        1 & \text{if } p \nmid a \text{ and } a \text{ is a quadratic residue modulo } p\\
        -1 & \text{if } p \nmid a \text{ and } a \text{ is not a quadratic residue modulo } p
    \end{cases}\\
    \leg{-1}{p} = (-1)^{\frac{p-1}{2}}\\
    \leg{ab}{p} = \leg{a}{p} \leg{b}{p}
\end{gather*}

\begin{theorem}[Quadratic Reciprocity]\label{thm:4_12}
    Let $p, q$ be two distinct odd primes. Then
    \begin{equation*}
        \leg{p}{q} \leg{q}{p} = (-1)^{\frac{(p-1)(q-1)}{4}}
    \end{equation*}
\end{theorem}
\begin{proof}
    This is equivalent to $\leg{p^*}{q} = \leg{q}{p}$, where $p^* = (-1)^{\frac{p-1}{2}} p$. Recall $\Gal(\QQ(\zeta_p)/\QQ)$ is a generalised class group for $\fm = p \infty$ (see \autoref{eg:2_24}), so the same holds for any subfield of $\QQ(\zeta_p)$ (see example sheet). Since $\Gal(\QQ(\zeta_p)/\QQ)$ is cyclic of order $p-1$, there is a unique subfield $\QQ \subseteq K \subseteq \QQ(\zeta_p)$ which is quadratic over $\QQ$, so $\Gal(K/\QQ)$ is a generalised ideal class group for $p \infty$. $p$ is the only finite prime of $\QQ$ ramified in $K$. Thus $K = \QQ(\sqrt{p^*})$ (see example sheet). Thus $\ker \Phi_{\QQ(p^*)/\QQ, p \infty}$ is a congruence subgroup for $p$. By Weak Reciprocity \autoref{thm:4_11}, % TODO: Don't we need 2 dividing the modulus?
    we have a surjective homomorphism
    \begin{equation}\label{eqn:4_12_star}
        \leg{p^*}{\cdot} : I_\QQ(p \infty) / P_\QQ(p \infty) \to \{\pm 1\}
    \end{equation}
    Consider the map $(\ZZ / p \ZZ)^\times \to I_\QQ(p\infty)/P_\QQ(p\infty)$ given by $[a] \mapsto [a \ZZ]$. This is an isomorphism. Composing this with \eqref{eqn:4_12_star}, we get a surjective homomorphism $(\ZZ/p\ZZ)^\times \to \{\pm 1\}$. But the Legendre symbol $\leg{\cdot}{p}$ also gives a surjective homomorphism $(\ZZ/p\ZZ)^\times \to \{\pm 1\}$. Since $(\ZZ/p\ZZ)^\times$ is cyclic, there is only one such homomorphism. Thus $\leg{p^*}{q} = \leg{q}{p}$.
\end{proof}

\section{Zeta Functions and \texorpdfstring{$L$}{L}-series}

In number theory, many arithmetic properties of objects (i.e. number fields, elliptic curves, \textellipsis) are captured in analytic objects like zeta functions and $L$-functions.

\subsection{Dirichlet Series}

\begin{definition}\label{def:5_1}
    A \emph{Dirichlet series} is a series $f(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}$, with $a_n \in \CC$, $s \in \CC$.
\end{definition}

We write $s = \sigma + i t$, where $\sigma, t$ are real. Suppose $\{a_n\}$ is a sequence of complex numbers, let $A(N) = \sum_{n=1}^N a_n$, and let $A(M, N) = \sum_{n=M}^N a_n$.

\begin{theorem}\label{thm:5_2}
    If the Dirichlet series $\sum_{n=1}^\infty \frac{a_n}{n^s}$ converges for some $s = s_0$, then it converges for any $s$ with $\Re s > \sigma_0 = \Re s_0$, uniformly on any compact subset.
\end{theorem}
\begin{proof}
    We will prove that the series converges uniformly in every region $\abs{\arg(s-s_0)} \le \frac{\pi}{2} - \delta < \frac{\pi}{2}$. Every compact set $K$ contained in $\{s \in \CC \mid \sigma > \sigma_0 \}$ lies in such a region. Since $f(s) = \sum_{n=1}^\infty \frac{1}{n^{s_0}} \frac{a_n}{n^{s-s_0}} = \sum_{n=1}^{\infty} \frac{\widetilde{a}_n}{n^{s-s_0}}$, where $\widetilde{a}_n = \frac{a_n}{n^{s_0}}$. Thus we may assume $s_0 = 0$. Then $\sum_{n=1}^\infty a_n$ converges, and for each $\varepsilon > 0$, we have $N_0$ such that $\abs{A(M, N)} < \varepsilon$ for all $N > M \ge N_0$. For each $N > M \ge N_0$, we find
    \begin{align*}
        \sum_{n=M}^{N} \frac{a_n}{n^s}
        &= \sum_{n=M}^{N} (A(M,n) - A(M,n-1)) n^{-s}\\
        &= \sum_{n=M}^{N-1} A(M,n) (n^{-s} - (n+1)^{-s}) + A(M, N) N^{-s}
    \end{align*}
    This is called Abel summation or summation by parts. We have
    \begin{equation*}
        \abs{n^{-s} - (n+1)^{-s}} = \abs{s \int_{n}^{n+1} \frac{dx}{x^{s+1}}} \le \abs{s} \int_{n}^{n+1} \frac{dx}{x^{\sigma+1}} = \frac{\abs{s}}{\sigma} (n^{-\sigma} - (n+1)^{-\sigma})
    \end{equation*}
    and $\frac{\abs{s}}{\sigma}$ is bounded in the region $\arg s \in (-\frac{\pi}{2} + \delta, \frac{\pi}{2} - \delta)$ by some constant $C$. Thus
    \begin{align*}
        \abs{\sum_{n=M}^{N} \frac{a_n}{n^s}}
        &\le \sum_{n=M}^{N-1} \abs{A(M,n)} \abs{n^{-s} - (n+1)^{-s}} + \abs{A(M, N)} \abs{N^{-s}}\\
        &\le C \varepsilon \sum_{n=M}^{N-1} (n^{-\sigma} - (n+1)^{-\sigma}) + \varepsilon N^{-\sigma}\\
        &\le C \varepsilon M^{-\sigma} + \varepsilon N^{-\sigma}\\
        &< (C + 1) N_0^{-\sigma} \varepsilon
    \end{align*}
\end{proof}

\begin{definition}\label{def:5_3}
    The smallest real number $\sigma_0$ such that the Dirichlet series converges for $\Re s > \sigma_0$ is called the \emph{abscissa of convergence}.
\end{definition}

We see the series converges in the half plane to the right of the line $\sigma = \sigma_0$, but does not converge for $s$ with $\sigma < \sigma_0$. If the Dirichlet series converges for some $s_1 = \sigma_1 + i t_1$, then we must have $a_n = O(n^{\sigma_1})$, and the Dirichlet series converges absolutely and uniformly on compact subsets if $\Re s \ge \sigma_1 + 1 + \delta$ if $\delta > 0$. (This follows by comparison with $\sum_{n=1}^{\infty} \frac{1}{n^{1+\delta}}$.)

\begin{theorem}\label{thm:5_4}
    Assume there exists a number $C$ and some $\sigma_1 \ge 0$ such that $\abs{A(N)} = \abs{a_1 + \ldots + a_N} \le C N^{\sigma_1}$ for all $N$. Then the abscissa of convergence of $\sum \frac{a_n}{n^s}$ is at most $\sigma_1$.
\end{theorem}
\begin{proof}
    Exercise
\end{proof}

\subsection{Riemann Zeta Function}

\begin{definition}\label{def:5_5}
    For $s \in \CC$ with $\Re s \ge 1$, we define the \emph{Riemann zeta function} as $\zeta(s) = \sum_{n=1}^\infty \frac{1}{n^s}$.
\end{definition}

\noindent By \autoref{thm:5_4}, we have $\sigma_1 = 1$, so $\zeta(s)$ converges for $\Re s > 1$.

\begin{example}\label{eg:5_6}
    We well show that $\zeta(s)$ has a meromorphic continuation to $\Re s > 0$, with a pole of first order and $\res_{s=1} \zeta(s) = 1$. Let $s > 1$, then we claim $\lim_{s \to 1^+} (s-1) \zeta(s) = 1$. By bounding $\int_1^\infty \frac{dx}{x^s} = \frac{1}{s-1}$ by rectangles, we see that
    \begin{gather*}
        \zeta(s) - 1 \le \int_1^\infty \frac{dx}{x^s} \le \zeta(s)\\
        \frac{1}{s-1} \le \zeta(s) \le 1 + \frac{1}{s-1}\\
        1 \le (s-1) \zeta(s) \le s
    \end{gather*}
    Taking $s \to 1^+$ gives the result.

    To extend the Riemann zeta function to $\Re s > 0$, we use a trick: Set
    \begin{align*}
        \zeta_2(s)
        &= \sum_{n=1}^\infty \frac{(-1)^{n+1}}{n^s}\\
        &= 1 - \frac{1}{2^s} + \frac{1}{3^s} - \ldots\\
        &= \zeta(s) - 2\left(\frac{1}{2^s} + \frac{1}{4^s} + \ldots\right)\\
        &= (1-2^{1-s}) \zeta(s)
    \end{align*}
    The partial sums of $\zeta_2(s)$ are either $1$ or $0$, hence bounded. By \autoref{thm:5_4}, this converges for $\sigma > 0$. We write $\zeta(s) = \frac{\zeta_2(s)}{1-2^{1-s}}$. We see that this has a pole only if
    \begin{align*}
        1 - 2^{1-s} = 0
        &\iff \exp((1-s) \log 2) = 1\\
        &\iff (1-s) \log 2 \in 2 \pi i \ZZ\\
        &\iff s = 1 + \frac{2 \pi i k}{\log 2} \text{ for some } k \in \ZZ
    \end{align*}
\end{example}
Now consider
\begin{equation*}
    \zeta_3(s) = \sum_{n \ge 0} \frac{1}{(3n+1)^s} + \frac{1}{(3n+2)^s} - \frac{2}{(3n+3)^s}
\end{equation*}
Then $\zeta(s) = \frac{\zeta_3(s)}{1-3^{1-s}}$, so similarly poles occur only when $1-3^{1-s} = 0$, so $s = 1 + \frac{2 \pi i k'}{\log 3}$ for some $k' \in \ZZ$. Thus $k = k' = 0$, so the only poles occur at $s = 1$.

\begin{proposition}\label{prop:5_7}
    For $\Re s > 1$, $\zeta(s) = \prod_p \frac{1}{1-p^{-s}}$.
\end{proposition}
\begin{proof}
    Recall that an infinite product $\prod_{n=1}^\infty a_n$ of complex numbers $a_n$ is said to \emph{converge} if the sequence of partial products $P_n = a_1 \ldots a_n$ has a non-zero limit. This is the case if and only if the series $\sum_{n=1}^\infty \log a_n$ converges. The product is called \emph{absolutely convergent} if this series converges absolutely.

    Let $E(s) = \prod_p \frac{1}{1-p^s}$, then $\log E(s) = \sum_p \sum_{n=1}^\infty \frac{1}{n p^{ns}}$. This converges absolutely for $\Re s = \sigma \ge 1 + \delta$: Since $\abs{p^{ns}} = p^{n \sigma} \ge p^{(1+\delta) n}$, we have
    \begin{equation*}
        \sum_p \sum_{n=1}^\infty \left(\frac{1}{p^{1+\delta}}\right)^n = \sum_p \frac{1}{p^{1+\delta}-1} \le 2 \sum_p \frac{1}{p^{1+\delta}}
    \end{equation*}
    and this last sum converges. This implies absolute converge of the product $E(s) = \prod_p \frac{1}{1-p^{-s}} = \exp\left(\sum_p \sum_{n=1}^\infty \frac{1}{n p^{ns}}\right)$. Note that if we expand $\frac{1}{1-p^s} = 1+\frac{1}{p^s}+\frac{1}{p^{2s}}+\ldots$ for all prime numbers $p_1, \ldots, p_r \le N$, we find
    \begin{equation*}
        \prod_{p \le N} \frac{1}{1-p^{-s}} = \sum_{v_1, \ldots, v_r = 0}^{\infty} \frac{1}{(p_1^{v_1} \ldots p_r^{v_r})^s} = \sideset{}{'}\sum_n \frac{1}{n^s}
    \end{equation*}
    where $\sum'$ denotes the sum of all natural numbers divisible only by prime numbers $p \le N$. In particular, $\sum'$ contains the terms corresponding to all $n \le N$, so
    \begin{equation*}
        \prod_{p \le N} \frac{1}{1-p^{-s}} = \sum_{n \le N} \frac{1}{n^s} + \sideset{}{'}\sum_{n > N} \frac{1}{n^s}
    \end{equation*}
    Now compare with $\zeta(s)$ to get
    \begin{equation*}
        \abs{\prod_{p \le N} \frac{1}{1-p^{-s}} - \zeta(s)} \le \abs{\sum_{\substack{n > N \\ p_i \nmid N}} \frac{1}{n^s}} \le \sum_{n > N} \frac{1}{n^{1+\delta}}
    \end{equation*}
    which goes to zero as $N \to \infty$.
\end{proof}

\begin{definition}\label{def:5_8}
    The \emph{gamma function} is the absolutely convergent integral
    \begin{equation*}
        \Gamma(s) = \int_0^\infty e^{-y} y^s \frac{dy}{y}
    \end{equation*}
    defined for $\Re s > 0$.
\end{definition}

\begin{proposition}\label{prop:5_9}\phantom{}
    \begin{enumerate}
        \item $\Gamma(s)$ is analytic and admits a meromorphic continuation to all of $\CC$.

        \item It is nowhere zero, and has only simple poles at $s = -n$, where $n=0, 1, 2, \ldots$, with residues $\frac{(-1)^n}{n!}$.

        \item We have functional equations
            \begin{enumerate}
                \item $\Gamma(s+1) = s \Gamma(s)$
                \item $\Gamma(s) \Gamma(1-s) = \frac{\pi}{\sin \pi s}$
                \item $\Gamma(s) \Gamma(s+\frac{1}{2}) = \frac{2 \sqrt{\pi}}{2^{2s}} \Gamma(2 s)$
            \end{enumerate}
        \item We have $\Gamma(\frac{1}{2}) = \sqrt{\pi}$, $\Gamma(1) = 1$, $\Gamma(n+1) = n!$ for $n=0,1,2,\ldots$.
    \end{enumerate}
\end{proposition}

\noindent In $\Gamma(s)$, substitute $y \mapsto \pi n^2 y$ to get
\begin{equation*}
    \pi^{-s} \Gamma(s) \frac{1}{n^{2s}} = \int_0^\infty e^{-\pi n^2 y} y^s \frac{dy}{y}
\end{equation*}
summing over all $n$, we get
\begin{equation*}
    \pi^{-s} \Gamma(s) \zeta(2s) = \int_0^\infty \sum_{n=1}^\infty e^{-\pi n^2 y} y^s \frac{dy}{y}
\end{equation*}
(check that we can actually swap the sum and integral).

\begin{definition}\label{def:5_10}
    The function $Z(s) = \pi^{-\frac{s}{2}} \Gamma(\frac{s}{2}) \zeta(s)$ is called the \emph{completed zeta function}.
\end{definition}

\begin{proposition}\label{prop:5_11}
    We have
    \begin{equation*}
        Z(s) = \frac{1}{2} \int_0^\infty (\theta(iy)-1) y^{\frac{s}{2}} \frac{dy}{y}
    \end{equation*}
    where $\theta(z) = \sum_{n \in \ZZ} e^{\pi i n^2 z} = 1 + 2\sum_{n=1}^\infty e^{\pi i n^2 z}$ is the Jacobi theta series.
\end{proposition}
\begin{proof}
    This follows from the discussion above.
\end{proof}

\begin{proposition}\label{prop:5_12}
    The series $\theta(z)$ is analytic on $\cH = \{z \in \CC \mid \Im z > 0\}$ and satisfies $\theta(-\frac{1}{z}) = \sqrt{\frac{z}{i}} \theta(z)$, where $\sqrt{\frac{z}{i}} = e^{\frac{1}{2} \log \frac{z}{i}}$.
\end{proposition}

\begin{definition}\label{def:5_13}
    Let $f : \RR_+ \to \CC$ be continuous, where $\RR_+$ is the group of positive real numbers. We define the \emph{Mellin transform} to be the improper integral
    \begin{equation*}
        M(f, s) = \int_0^\infty (f(y) - f(\infty)) y^s \frac{dy}{y}
    \end{equation*}
    provided the limit $f(\infty) = \lim_{y \to \infty} f(y)$ and the integral exists.
\end{definition}

\begin{theorem}[Mellin Principle]\label{thm:5_14}
    Let $f, g : \RR_+ \to \CC$ be continuous, $f(y) = a_0 + O(e^{-c_0 y^\alpha})$ and $g(y) = b_0 + O(e^{-c_0 y^\alpha})$ as $y \to \infty$, with positive constants $c_0, \alpha$. If
    \begin{equation*}
        f\left(\frac{1}{y}\right) = C y^k g(y)
    \end{equation*}
    for some real $k > 0$ and $C \neq 0$ complex, then
    \begin{enumerate}
        \item The integrals $M(f,s)$, $M(g,s)$ converge absolutely and uniformly for $s$ in a compact subset of $\{s \in \CC \mid \Re s > k\}$. Therefore they are holomorphic on $\{s \in \CC \mid \Re s > k\}$ and admit a holomorphic continuation to $\CC \setminus \{0, k\}$.

        \item They have simple poles at $s=0$ and $s=k$, where
            \begin{align*}
                \Res_{s=0} M(f,s) &= -a_0 & \Res_{s=k} M(f,s) &= C b_0\\
                \Res_{s=0} M(g,s) &= -b_0 & \Res_{s=k} M(g,s) &= C^{-1} a_0
            \end{align*}

        \item We have $M(f,s) = C M(f,k-s)$.
    \end{enumerate}
\end{theorem}

\begin{theorem}\label{thm:5_15}
    The completed zeta function $Z(s)$ admits an analytic continuation to $\CC \setminus \{0, 1\}$, has simple poles at $s=0,1$ with residues $-1,1$ respectively, and satisfies the functional equation $Z(s) = Z(1-s)$.
\end{theorem}
\begin{proof}
    By \autoref{prop:5_11} and \autoref{def:5_13}, we have $Z(s) = M(f,s)$, where $f(y) = \frac{1}{2} \theta(iy)$. Since $\theta(i y) = 1 + 2e^{-\pi y} (1 + \sum_{n=2}^\infty e^{\pi (n^2-1) y})$, we have $f(y) = \frac{1}{2} + O(e^{-\pi y})$. By \autoref{prop:5_12}, we have
    \begin{equation*}
        f\left(\frac{1}{y}\right) = \frac{1}{2} \theta\left(\frac{-1}{iy}\right) = \frac{1}{2} y^{\frac{1}{2}} \theta(iy) = y^{\frac{1}{2}} f(y)
    \end{equation*}

    By \autoref{thm:5_14}, $M(f,s)$ has a holomorphic continuation to $\CC \setminus \{0, \frac{1}{2}\}$, with simple poles at $s = 0, \frac{1}{2}$, with residues $-\frac{1}{2}$ and $\frac{1}{2}$ respectively, and $M(f, s) = M(f, s - \frac{1}{2})$. Thus $Z(s) = M(f, \frac{s}{2})$ has holomorphic continuation to $\CC \setminus \{0,1\}$, with simple poles at $s=0,1$ with residues $-1$ and $1$, and satisfies
    \begin{equation*}
        Z(s) = M\left(f, \frac{s}{2}\right) = M\left(f, \frac{1}{2} - \frac{s}{2}\right) = Z(1-s)
    \end{equation*}
\end{proof}

\begin{corollary}\label{cor:5_16}
    The function $\zeta(s)$ admits an analytic continuation to $\CC \setminus \{1\}$. It has a simple pole at $s=1$ with residue $1$ and satisfies the functional equation
    \begin{equation*}
        \zeta(1-s) = 2 (2 \pi)^{-s} \Gamma(s) \cos\left(\frac{\pi s}{2}\right) \zeta(s)
    \end{equation*}
\end{corollary}
\begin{proof}
    $Z(s) = \pi^{-\frac{s}{2}} \Gamma\left(\frac{s}{2}\right) \zeta(s)$ has a simple pole at $s=0$, but so does $\Gamma\left(\frac{s}{2}\right)$, so $\zeta(s)$ has no pole at $s=0$. At $s=1$, $Z(s)$ has a simple pole, and hence so does $\zeta(s)$, since $\Gamma\left(\frac{1}{2}\right) = \sqrt{\pi}$. Then the residue is $\Res_{s=1} \zeta(s) = \pi^{\frac{1}{2}} \Gamma\left(\frac{1}{2}\right)^{-1} \Res_{s=1} Z(s) = 1$. By \autoref{thm:5_15}, $Z(s) = Z(1-s)$. This implies
    \begin{equation}\label{eqn:5_16_star}
        \zeta(1-s) = \pi^{\frac{1}{2} - s} \frac{\Gamma\left(\frac{s}{2}\right)}{\Gamma\left(\frac{1-s}{2}\right)} \zeta(s)
    \end{equation}
    Now by \autoref{prop:5_9} (3), we have
    \begin{align*}
        \Gamma\left(\frac{s}{2}\right) \Gamma\left(\frac{1+s}{2}\right) &= \frac{2 \sqrt{\pi}}{2^s} \Gamma(s)\\
        \Gamma\left(\frac{1-s}{2}\right) \Gamma\left(\frac{1+s}{2}\right) &= \frac{\pi}{\cos \frac{\pi s}{2}}
    \end{align*}
    so
    \begin{equation*}
        \frac{\Gamma(\frac{s}{2})}{\Gamma(\frac{1-s}{2})} = \frac{2}{2^s \sqrt{\pi}} \cos{\frac{\pi s}{2}} \Gamma(s)
    \end{equation*}
    Plugging this into \eqref{eqn:5_16_star} gives the result.
\end{proof}

\noindent What are the zeros of $\zeta(s)$?
\begin{itemize}
    \item $\zeta(s) \neq 0$ for $\Re s > 1$ (this follows from the Euler product).
    \item For $\Re(s) < 0$, then $s = -2, -4, -6, \ldots$ are the trivial zeros of $\zeta(s)$ (this follows from the functional equation and \autoref{prop:5_9}).
    \item Other zeros have to lie in the \emph{critical strip} $0 \le \Re s \le 1$. The Riemann hypothesis conjectures that the non-trivial zeros of $\zeta(s)$ lie on the line $\Re s = \frac{1}{2}$.
\end{itemize}

\section{Dedekind Zeta Function}

\begin{definition}\label{def:6_1}
    Let $K$ be a number field. The \emph{Dedekind zeta function} is defined by the series
    \begin{equation*}
        \zeta_K(s) = \sum_{\fa} \frac{1}{N(\fa)^s}
    \end{equation*}
    as $\fa$ varies over the integral ideals of $K$, and $N(\fa)$ is the absolute norm of $\fa$.
\end{definition}

For $K=\QQ$, $\zeta_K(s) = \zeta(s)$ is the Riemann zeta function.

\begin{proposition}\label{prop:6_2}
    The series $\zeta_K(s)$ converges absolutely and uniformly in the domain $\Re(s) \ge 1+\delta$ for every $\delta > 0$, and has an Euler product
    \begin{equation*}
        \zeta_K(s) = \prod_{\fp} \frac{1}{1 - N(\fp)^{-s}}
    \end{equation*}
    where $\fp$ runs through the prime ideals of $K$.
\end{proposition}
\noindent The proof is similar to that of $\zeta(s)$, using that $N(\fa)$ is multiplicative.

We will see that $\zeta_K(s)$ also has an analytic continuation to $\CC \setminus \{1\}$, and satisfies a functional equation $s \longleftrightarrow 1-s$.

By splitting up $\zeta_K(s)$ using a class $\cC \in \Cl(K) = I_K/P_K$, we define a partial zeta function $\zeta(\cC, s) = \sum_{\fa \in \cC} \frac{1}{N(\fa)^s}$ so that $\zeta_K(s) = \sum_{\cC \in \Cl(K)} \zeta(\cC, s)$.

Let $Z_\infty(s) = \abs{d_K}^{\frac{s}{2}} \pi^{ns} \Gamma_K\left(\frac{s}{2}\right)$, where $n = [K:\QQ]$ and $\Gamma_K(s)$ is a version of the gamma function. $Z_\infty(s)$ can be viewed as the Euler factor at infinity. Then set $Z(\cC, s) = Z_\infty(s) \zeta(\cC, s)$.

\begin{theorem}\label{thm:6_3}
    The function $Z(\cC, s)$ admits an analytic continuation to $\CC \setminus \{0, 1\}$ and it satisfies the functional equation
    \begin{equation*}
        Z(\cC, s) = Z(\cC', 1-s)
    \end{equation*}
    where $\cC$ and $\cC'$ are related to each other via $\cC \cC' = [\fd]$, where $\fd$ is the different.

    It has simple poles at $s=0,1$ with residues $-\frac{2^r R}{w}, \frac{2^r R}{w}$ respectively, where $r$ is the number of infinite primes, $w$ is the number of roots of unity in $K$, and $R$ is the regulator.
\end{theorem}

The proof again needs the Mellin principal and some theta series.

\begin{definition}\label{def:6_4}
    Let $Z_K(s) = Z_\infty(s) \zeta_K(s) = \sum_{\cC} Z(\cC, s)$ be the \emph{completed zeta function} of the number field $K$.
\end{definition}

\begin{corollary}\label{cor:6_5}
    The completed zeta function $Z_K(s)$ admits an analytic continuation to $\CC \setminus \{0, 1\}$ and satisfies the functional equation $Z_K(s) = Z_K(1-s)$. It has simple poles at $s=0,1$ with residues $-\frac{2^r h R}{w}, \frac{2^r h R}{w}$ respectively, where $h$ is the class number of $K$.
\end{corollary}

For a number field $K$, let $r_1$ be the number of real places, $r_2$ the number of complex places. After analysing $Z_\infty(s)$, one finds
\begin{corollary}\label{cor:6_6}\phantom{}
    \begin{enumerate}
        \item The Dedekind zeta function $\zeta_K(s)$ has an analytic continuation to $\CC \setminus \{1\}$.
        \item At $s=1$, it has a simple pole with residue $h \kappa$, where $\kappa = \frac{2^{r_1} (2\pi)^{r_2}}{w \, \abs{d_K}^{\frac{r}{2}}} R$.
        \item It satisfies the functional equation $\zeta_K(1-s) = A(s) \zeta_K(s)$ for some factor $A(s)$.
    \end{enumerate}
\end{corollary}

\begin{remark}\label{rem:6_7}
    The formula for the residue
    \begin{equation*}
        \Res_{s=1} \zeta_K(s) = \frac{2^{r_1} (2 \pi)^{r_2}}{w \abs{d_K}^{\frac{r}{2}}} h R
    \end{equation*}
    is called the analytic class number formula.
\end{remark}

\noindent Our next task is to make these explicit for quadratic fields.

\noindent Let $K = \QQ(\sqrt{d})$, where $d$ is squarefree. We know that a prime $p$ is
\begin{enumerate}
    \item split if $(p) = \fp_1 \fp_2$, so $N_{K/\QQ}(\fp_1) = N_{K/\QQ}(\fp_2) = p$;
    \item inert if $\cO_K$ is prime, so $N_{K/\QQ} (p \cO_K) = p^2$;
    \item ramified if $(p) = \fp^2$, so $N_{K/\QQ}(\fp) = p$.
\end{enumerate}
so
\begin{align*}
    \zeta_K(s)
    &= \prod_{\fp} \left(1 - \frac{1}{N_{K/\QQ}(\fp)}\right)^{-1}\\
    &= \prod_{p \text{ splits}} \left(1 - \frac{1}{p^s}\right)^{-2} \prod_{p \text{ inert}} \left(1 - \frac{1}{p^{2s}}\right)^{-1} \prod_{p \text{ ramified}} \left(1 - \frac{1}{p^s}\right)^{-1}
\end{align*}
Note that in each case there is a factor $\left(1-\frac{1}{p^s}\right)^{-1}$, which is the Euler factor of the Riemann zeta function, so $\zeta(s) \mid \zeta_K(s)$. In fact,
\begin{equation*}
    \zeta_K(s) = \zeta(s) \prod_p \left(1 - \frac{\chi(p)}{p}\right)^{-1}
\end{equation*}
where
\begin{equation*}
    \chi(p) = \begin{cases}
        1 & \text{if } p \text{ splits}\\
        -1 & \text{if } p \text{ is inert}\\
        0 & \text{if } p \text{ ramifies}
    \end{cases}
\end{equation*}
This is an example of a Dirichlet character, and $\prod_p \left(1 - \frac{\chi(p)}{p}\right)^{-1}$ is the Euler product corresponding to the Dirichlet $L$-series $L(\chi, s)$.

\section{Dirichlet \texorpdfstring{$L$}{L}-series}

\subsection{Dirichlet Characters}

\begin{definition}\label{def:7_1}
    Let $m$ be a natural number. A \emph{Dirichlet character} mod $m$ is a homomorphism $\chi : (\ZZ/m\ZZ)^\times \to \CC^\times$.
\end{definition}

\begin{example}\label{eg:7_2}
    Let $K = \QQ(\sqrt{d})$, $d$ squarefree. Then set
    \begin{equation*}
        \chi(p) = \begin{cases}
            1 & \text{if } p \text{ splits}\\
            -1 & \text{if } p \text{ is inert}
        \end{cases}
    \end{equation*}
    This depends only on $p \pmod{d_K}$.
\end{example}

\begin{definition}\label{def:7_3}
    A Dirichlet character $\chi$ mod $m$ is called \emph{primitive} if it does not arise as the composite $(\ZZ/m\ZZ)^\times \to (\ZZ/m'\ZZ)^\times \xrightarrow{\chi'} \CC^\times$ of a Dirichlet character $\chi'$ mod $m$ for a proper divisor $m' \mid m$.
\end{definition}

\begin{definition}\label{def:7_4}
    If $\chi$ is a Dirichlet character mod $m$ and $\chi$ is primitive, then $m$ is called the \emph{conductor} of $\chi$.
\end{definition}

The conductor of a Dirichlet character $\chi$ mod $m_0$ is the gcd of all $m' \mid m_0$ such that $\chi$ is induced from a character mod $m'$.

We can extend Dirichlet characters $\chi$ to multiplicative functions $\chi : \ZZ \to \CC$ by setting
\begin{equation*}
    \chi(n) =
    \begin{cases}
        \chi(n \mod{m}) & \text{for } (n, m) = 1\\
        0 & \text{otherwise}
    \end{cases}
\end{equation*}

\stepcounter{definition} % Numbering issue

\begin{example}\label{eg:7_6}
    This is what we did for \autoref{eg:7_2} by setting $\chi(p) = 0$ if $(p, d_K) \neq 1$.
\end{example}

\begin{definition}\label{def:7_7}
    Write $\chi_0$ for the \emph{trivial character} mod $m$. Explicitly,
    \begin{equation*}
        \chi_0(n) =
        \begin{cases}
            1 & \text{if } (n, m) = 1\\
            0 & \text{if } (n, m) \neq 1
        \end{cases}
    \end{equation*}
    This is also called the \emph{principal character}.
    For $m = 1$, we write $\chi_0 = \mathbb{1}$.
\end{definition}

\begin{example}\label{eg:7_9}
    Let $m=4$, then there are two Dirichlet characters mod $4$, the trivial character $\chi_0$ and
    \begin{equation*}
        \chi_1(n) =
        \begin{cases}
            1 & \text{if } n \equiv 1 \pmod{4}\\
            -1 & \text{if } n \equiv 3 \pmod{4}\\
            0 & \text{if } 2 \mid n
        \end{cases}
    \end{equation*}
\end{example}

\begin{remark}\label{rem:7_9}
    Suppose we have two Dirichlet characters mod $m$, $\chi_1, \chi_2$. Then the product $\chi_1 \chi_2$ is the function $\chi_1 \chi_2(n) = \chi_1(n) \chi_2(n)$. This operation turns the collection of all Dirichlet characters of $(\ZZ/m\ZZ)^\times$ into an abelian group, which we denote by $\widehat{(\ZZ/m\ZZ)^\times}$. The identity is the principal character $\chi_0$ and the inverse of a character $\chi$ is the function $n \mapsto \chi(n)^{-1}$.
\end{remark}

\begin{remark}\label{rem:7_10}
    We can also consider characters more generally. Let $A$ be a finite abelian group, and let $\widehat{A}$ be the group of homomorphisms $\chi : A \to \CC^\times$. $\widehat{A}$ is called the \emph{character group} (or \emph{dual group}) of $A$.
\end{remark}

\begin{proposition}\label{prop:7_11}
    If $A$ is a finite abelian group, then $A \cong \widehat{A}$.
\end{proposition}
\begin{proof}
    We induct on $\abs{A}$, the order of $A$.

    Suppose $A$ is cyclic of order $m$, with generator $y$. Then $y^m = 1$, so $\chi(y)$ is an $m$\textsuperscript{th} root of unity for every character $\chi$ of $A$. Note that by multiplicativity, any character $\chi$ is completely determined by $\chi(y)$. Let $\zeta$ be a primitive $m$\textsuperscript{th} root of unity. Then for each $r=0,\ldots,m-1$, the function $\chi_r(y^j) = (\zeta^r)^j$ is a character, and these are distinct. We have $\chi_r = \chi_1^r$, so $\widehat{A}$ is the cyclic group generated by $\chi_1$. Since $\chi_1^r = 1$ iff $\zeta^r = 1$, $\chi_1$ has order $m$, so that $\widehat{A}$ is cyclic of order $m$, so $\widehat{A} \cong A$.

    Now suppose that $A = A_1 \times A_2$, with $A_i \neq 1$ for $i \neq 1, 2$. We define a map $\widehat{A} \to \widehat{A_1} \times \widehat{A_2}$ by $\chi \mapsto (\chi \vert_{A_1}, \chi \vert_{A_2})$, which is a homomorphism. Define $\widehat{A_1} \times \widehat{A_2} \to \widehat{A}$ by $(\chi_1, \chi_2) \mapsto \chi(a_1, a_2) = \chi_1(a_1) \chi_2(a_2)$. These are mutual inverses, hence isomorphisms. The result follows by induction since $\widehat{A_i} \cong A_i$.
\end{proof}

Recall that $(\ZZ/m\ZZ)^\times$ has order $\phi(m)$, where $\phi$ is the Euler totient function. Thus by the above, $\widehat{(\ZZ/m\ZZ)^\times}$ has order $\phi(m)$.

\begin{example}\label{eg:7_12}
    $\phi(4) = 2$, so we have seen all the characters mod $4$.
\end{example}

\begin{corollary}\label{cor:7_13}
    If $A$ is a finite abelian group, then $A \cong \hat{\hat{A}}$ by the map sending $a \in A$ to the character $\chi \mapsto \chi(a)$.
\end{corollary}
\begin{proof}
    Exercise.
\end{proof}

\begin{proposition}[Orthogonality Relations]\label{prop:7_14}
    Let $\chi_1, \chi_2$ be characters of a finite abelian group $A$, $a, b \in A$. Then
    \begin{enumerate}
        \item $\displaystyle\sum_{a \in A} \chi_1(a) \chi_2(a) =
                \begin{cases}
                    0 & \text{if } \chi_1 \neq \chi_2^{-1}\\
                    \abs{A} & \text{if } \chi_1 = \chi_2^{-1}
                \end{cases}$
        \item $\displaystyle\sum_{\chi \in \widehat{A}} \chi(a) \chi(b) =
                \begin{cases}
                    0 & \text{if } a \neq b^{-1}\\
                    \abs{A} & \text{if } a = b^{-1}
                \end{cases}$
    \end{enumerate}
\end{proposition}
\begin{proof}
    Let $\chi \in \widehat{A}$, $\chi \neq \chi_0$. Let $b \in A$ be such that $\chi(b) \neq 1$. Then
    \begin{equation*}
        \sum_{a \in A} \chi(a) = \sum_{a \in A} \chi(ab) = \chi(b) \sum_{a \in A} \chi(a)
    \end{equation*}
    Since $\chi(b) \neq 1$, we get $\sum_{a \in A} \chi(a) = 0$. Thus the first part of 1) follows with $\chi = \chi_1 \chi_2$. The second part of 1) is immediate.

    To prove 2), use \autoref{cor:7_13}, and 1) with $\widehat{A}$ in place of $A$.
\end{proof}

\subsection{Dirichlet \texorpdfstring{$L$}{L}-series}

\begin{definition}\label{def:7_15}
    Let $\chi$ be a Dirichlet character mod $m$, then define
    \begin{equation*}
        L(\chi, s) = \sum_{n=1}^\infty \frac{\chi(n)}{n^s}
    \end{equation*}
\end{definition}

\begin{proposition}\label{prop:7_16}
    For $\Re(s) > 1$, the series is absolutely convergent, and we have an Euler product
    \begin{equation*}
        L(\chi, s) = \prod_p \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}
    \end{equation*}
\end{proposition}
\begin{proof}
    Exercise.
\end{proof}

Note that we can write $L(\chi,s) = \prod_{p \nmid m} \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}$. Now taking $\chi$ to be the trivial character $\chi_0$, $L(\chi_0,s) = \zeta(s) \prod_{p \mid m} \left(1 - \frac{1}{p^s}\right)^{-1}$. We can relate the Dirichlet $L$-series to the Dedekind zeta function $\zeta_K(s)$.

\begin{proposition}\label{prop:7_17}
    Let $K = \QQ(\zeta_m)$, then
    \begin{equation*}
        \zeta_K(s) = \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \prod_{\chi \in \widehat{(\ZZ / m \ZZ)^\times}} L(\chi, s)
    \end{equation*}
\end{proposition}
\begin{proof}
    Let $p \cO_K = (\fp_1 \ldots \fp_r)^e$ be the decomposition of the prime number $p$ in $K$, and let $f = f_{\fp_1/p}$ be the inertial degree, so that $N(\fp_1) = p^f$. Then $\zeta_K(s)$ contains the factor $\prod_{\fp \mid p} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} = \left(1 - \frac{1}{p^{fs}}\right)^{-r}$. The $L$-series gives the factor $\prod_{\chi} \left(1 - \frac{\chi(p)}{p^s}\right)^{-1}$. For $p \mid m$, this is $1$. Now assume $p \nmid m$. Then $f$ is the order of $p \pmod{m}$ in $(\ZZ/m\ZZ)^\times$, and $e = 1$. % TODO: By Example 2.11 and Corollary 1.7?
    Since $efr = \abs{(\ZZ / m \ZZ)^\times} = \phi(m)$, the quotient $r = \frac{\phi(m)}{f}$ is the index of the subgroup $G_p$ generated by $p$ in $(\ZZ / m \ZZ)^\times$. Then we have an isomorphism $\widehat{G_p} \to \mu_f$, $\chi \mapsto \chi(p)$, and an exact sequence\footnote{$A \mapsto \widehat{A}$ is an exact functor, i.e. preserves short exact sequences, right-exactness can be proved by counting}
    \begin{equation*}
        1 \longrightarrow \widehat{G/G_p} \longrightarrow \widehat{G} \longrightarrow \mu_f \longrightarrow 1
    \end{equation*}
    and there are $\# \widehat{G / G_f} = [G : G_p] = r$ elements in the preimage of $\chi(p)$, so
    \begin{equation*}
        \prod_{\chi} \left(1-\frac{\chi(p)}{p^s}\right)^{-1} = \prod_{\zeta \in \mu_f} \left(1 - \frac{\zeta}{p^s}\right)^{-r} = \left(1-\frac{1}{p^{fs}}\right)^{-r} = \prod_{\fp \mid p} \left(1-\frac{1}{N(\fp)^s}\right)^{-1}
    \end{equation*}
    Taking the product over all primes,
    \begin{equation*}
        \zeta_K(s) = \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \prod_{\chi} L(\chi, s) \qedhere
    \end{equation*}
\end{proof}

\noindent Since $L(\chi_0, s) = \prod_{p \mid m} (1 - \frac{1}{p^s}) \zeta(s)$, we have
\begin{equation*}
    \zeta_K(s) = \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \underbrace{\prod_{p \mid m} \left(1 - \frac{1}{p^s}\right) \zeta(s)}_{L(\chi_0, s)} \prod_{\chi \neq \chi_0} L(\chi, s)
\end{equation*}
Since $\zeta(s)$ and $\zeta_K(s)$ both have simple poles at $s = 1$, so

\begin{proposition}\label{prop:7_18}
    For every non-trivial Dirichlet character $\chi$, one has $L(\chi, 1) \neq 0$.
\end{proposition}

\begin{theorem}[Dirichlet's Prime Number Theorem]\label{thm:7_19}
    Every arithmetic progression $a, a \pm m, a \pm 2m, \ldots$ with $(a, m) = 1$ (i.e. every class $a \pmod{m}$) contains infinitely many prime numbers.
\end{theorem}
\begin{proof}
    Let $\chi$ be a Dirichlet character mod $m$. Then for $\Re(s) > 1$,
    \begin{align*}
        \log L(\chi, s)
        &= -\sum_{p}\log\left(1 - \frac{\chi(p)}{p^s}\right)\\
        &= \sum_p \sum_{n=1}^\infty \frac{\chi(p^n)}{n p^{ns}}\\
        &= \sum_p \frac{\chi(p)}{p^s} + g_\chi(s)
    \end{align*}
    where $g_\chi(s)$ is holomorphic for $\Re(s) > \frac{1}{2}$. Then multiplying by $\chi(a^{-1})$ an summing over all characters mod $m$, we get
    \begin{align*}
        \sum_{\chi} \chi(a^{-1}) L(\chi, s)
        &= \sum_\chi \sum_p \frac{\chi(a^{-1} p)}{p^s} + g(s)\\
        &= \sum_{b=1}^n \sum_\chi \chi(a^{-1}b)\sum_{p \equiv b \pmod{m}} \frac{1}{p^s} + g(s)\\
        &= \sum_{p \equiv a \pmod{m}} \frac{\phi(m)}{p^s} + g(s)
    \end{align*}
    by using the orthogonality relations \autoref{prop:7_14}. Now let $s > 1$ be real. Then for $s \to 1$, we know that $\log L(\chi, s)$ stays bounded for $\chi \neq \chi_0$ as we know that $L(\chi, 1) \neq 0$. But $\log L(\chi_0, s)  = \sum_{p \mid m} \left(1 - \frac{1}{p^s}\right) + \log \zeta(s)$ goes to infinity as $s \to 1$ because $\zeta(s)$ has a pole at $s = 1$. Thus the first sum of the above equation tends to $\infty$. Since $g(s)$ is holomorphic at $s = 1$, we find $\lim_{s \to 1} \sum_{p \equiv a \pmod{m}} \frac{\phi(m)}{p^s} = \infty$.
\end{proof}

\subsection{Explicit Class Number Formulae}

Let $K$ be any number field. Then for $\Re(s) > 1$, we can write $\zeta_K(s) = \sum_{n=1}^\infty \frac{j_s}{n^s}$ with $j_n$ the number of integral ideals $\fa$ of $K$ with $N(\fa) = n$. Then
\begin{equation*}
    \zeta_K(s) = \sum_{n=1}^\infty \frac{j_n - h_K \kappa}{n^s} + h_K \kappa \zeta(s)
\end{equation*}%TODO: I think there is a mistake here, should just be kappa, not h_K kappa
for $\Re(s) > 1$, where $\kappa$ is the term we defined in the analytic class number formula \autoref{cor:6_6}, and $h_K$ is the class number. The series $\sum_{n=1}^\infty \frac{j_n - h_K \kappa}{n^s}$ converges for $\Re(s) = 1$ (in fact it converges for $\Re(s) > 1 - \frac{1}{[K : \QQ]}$). Now $h_K = \frac{\rho}{\kappa}$, where $\rho = \lim_{s \to 1} \frac{\zeta_K(s)}{\zeta(s)}$.

Let $K$ be an abelian extension of $\QQ$. Then $K \subseteq \QQ(\zeta_m)$ for some $m$. Identify $\Gal(\QQ(\zeta_m) / \QQ)$ with $(\ZZ / m\ZZ)^\times$, and let $G = \Gal(K / \QQ)$. Consider its image in $(\ZZ / m\ZZ)^\times$, then consider characters of $G$ as Dirichlet characters mod $m$, so we consider $\widehat{G}$ as a subgroup of $(\ZZ / m\ZZ)^\times$. Then we adapt the proof of \autoref{prop:7_17} to find for $p \nmid m$,
\begin{equation*}
    \prod_{\chi \in \widehat{G}} \left(1 - \frac{\chi(p)}{p^s}\right) = \left(1 - \frac{1}{p^{fs}}\right)^r = \prod_{\fp \mid p} \left(1 - \frac{1}{N(\fp)^s}\right)
\end{equation*}
where now $f$ is the inertia degree of $p$ in $K$, and $r$ is the number of primes $\fp \subseteq \cO_K$ lying above $p$> Thus for $\Re(s) > 1$,
\begin{equation*}
    \prod_{\chi \in \widehat{G}} L(\chi, s) = \prod_{p \nmid m} \left(1 - \frac{1}{p^{fs}}\right)^{-r} = \prod_{p \nmid m} \prod_{\fp \mid p} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1}
\end{equation*}
so as before,
\begin{align*}
    \zeta_K(s)
    &= \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \prod_{\chi \in \widehat{G}} L(\chi, s)\\
    &= \prod_{\fp \mid m} \left(1 - \frac{1}{N(\fp)^s}\right)^{-1} \underbrace{\prod_{p \mid m} (1-p^{-s}) \zeta(s)}_{L(\chi_0, s)} \prod_{\chi \neq \chi_0} L(\chi, s)
\end{align*}
so
\begin{equation*}
    \frac{\zeta_K(s)}{\zeta(s)} = \prod_{p \mid m} \left(1-\frac{1}{p^s}\right) \left(1-\frac{1}{p^{f_p s}}\right)^{-r_p} \prod_{\chi \neq \chi_0} L(\chi, s)
\end{equation*}

\begin{theorem}\label{thm:7_20}
    We have $h_K = \frac{\rho}{\kappa}$, with
    \begin{equation*}
        \rho = \prod_{p \mid m} \left(1 - \frac{1}{p}\right)\left(1 - \frac{1}{p^{f_p}}\right)^{-r_p} \prod_{\substack{\chi \in \widehat{G}\\\chi \neq \chi_0}} L(\chi, 1)
    \end{equation*}
\end{theorem}
\begin{proof}
    This follows from the above, and note that for $\chi \neq \chi_0$, the coefficients of $L(\chi, s)$ have bounded partial sums (see Example Sheet 1, Exercise 6), so by \autoref{thm:5_4}, the series converges to an analytic function $\Re(s) > 0$.
\end{proof}

Now we compute $L(\chi, 1)$.

\begin{definition}[Gauss Sum]\label{def:7_21}
    Let $\zeta = e^{\frac{2 \pi i}{m}}$ be a primitive $m$\textsuperscript{th} root of unity. Then for $k \ge 0$, we define the Gauss sum $\tau_k(\chi) = \sum_{a \in (\ZZ / m\ZZ)^\times} \chi(a) \zeta^{ak}$.
\end{definition}

\begin{theorem}\label{thm:7_22}
    Let $\chi$ be a non-trivial Dirichlet character mod $m$. Then
    \begin{equation*}
        L(\chi, 1) = -\frac{1}{m} \sum_{k=1}^{m-1} \tau_k(\chi) \log(1 - \zeta^{-k})
    \end{equation*}
\end{theorem}

\noindent Note $\log(1-z) = -\sum_{n=1}^\infty \frac{z^n}{n}$ for $\abs{z} < 1$, and for $z$ on the unit circle for which the series converges, e.g. $\zeta$.

\begin{proof}
    For $\Re(s) > 1$,
    \begin{align*}
        L(\chi, s)
        &= \sum_{n=1}^\infty \frac{\chi(n)}{n^s}\\
        &= \sum_{a \in (\ZZ / m\ZZ)^\times} \chi(a) \sum_{\substack{n \equiv a \pmod{m}\\n \ge 1}}\\
        &= \sum_{a \in (\ZZ / m\ZZ)^\times} \chi(a) \sum_{n=1}^\infty \frac{\frac{1}{m} \sum_{k=0}^{m-1} \zeta^{(a-n)k}}{n^s}\\
        &= \frac{1}{m} \sum_{k=0}^{m-1} \tau_k(\chi) \sum_{n=1}^\infty \frac{\zeta^{-nk}}{n^s}
    \end{align*}
    Note $\tau_0(\chi) = \sum_{a \in (\ZZ/m\ZZ)^\times} \chi(a) = 0$. For $1 \le k \le m-1$, the Dirichlet series $\sum_{n=1}^\infty \frac{\zeta^{-nk}}{n^s}$ converges to an analytic function on the half-plane $\Re(s) > 0$ (by \autoref{thm:5_4}), and this is continuous at $s=1$. Its value at $s=1$ is $-\log(1-\zeta^{-k})$. The result follows by taking the limit $s \to 1$ from the right.
\end{proof}

\begin{lemma}\label{lem:7_23}
    Let $\chi$ be a primitive character mod $m$. Then $\abs{\tau_1(\chi)}^2 = m$ and
    \begin{equation*}
        \tau_k(\chi) = \begin{cases}
            \overline{\chi}(k) \tau_1(\chi) & \text{if } (k,m)=1\\
            0 & \text{if } (k,m) > 1
        \end{cases}
    \end{equation*}
\end{lemma}
\begin{proof}
    Omitted.
\end{proof}

\begin{definition}\label{def:7_24}
    We say a Dirichlet character $\chi$ is \emph{even} if $\chi(-1) = 1$ and \emph{odd} if $\chi(-1) = -1$.
\end{definition}

\begin{remark}\label{rem:7_25}
    We will use that for $0 < k < m$,
    \begin{equation*}
        \log(1-\zeta^k) = \log 2 + \log \sin \frac{k \pi}{m} + \left(\frac{k}{m} - \frac{1}{2}\right) \pi i
    \end{equation*}
    This may be proven by writing $1 - \zeta^k = -\zeta^{\frac{k}{2}} (\zeta^{\frac{k}{2}} - \zeta^{-\frac{k}{2}}) = -2i \zeta^{\frac{k}{2}} \sin \frac{k \pi i}{m}$.
\end{remark}
\noindent Now
\begin{alignat*}{3}
    L(\chi, 1)
    &= -\frac{1}{m} \sum_{k=1}^{m-1} \tau_k(\chi) \log(1 - \zeta^{-k}) &&\qquad \text{by \ref{thm:7_22}}\\
    &= -\frac{\tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \log(1 - \zeta^{-k}) &&\qquad \text{by \ref{lem:7_23}}\\
    &= -\frac{\chi(-1) \tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \log(1 - \zeta^k) &&\qquad \text{Substitute } k \mapsto -k\\
    &= -\frac{\chi(-1) \tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \left(\log \sin \frac{k \pi}{m} + \frac{k \pi i}{m}\right) &&\qquad \text{by \ref{rem:7_25} and \ref{prop:7_14}}\\
    &= \begin{cases}
        \displaystyle-\frac{\tau_1(\chi)}{m} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) \log \sin \frac{k \pi}{m} & \text{if } \chi \text{ is even}\\
        \displaystyle\frac{\pi i \tau_1(\chi)}{m^2} \sum_{k \in (\ZZ / m\ZZ)^\times} \overline{\chi}(k) k & \text{if } \chi \text{ is odd}
    \end{cases}
\end{alignat*}
The last equality holds since $\chi(-1) = 1$ implies $\sum_k \overline{\chi}(k) k = 0$, and $\chi(-1) = -1$ implies $\sum_k \overline{\chi}(k) \log \sin \frac{k \pi}{m} = 0$.

\noindent Note also for odd $\chi$,
\begin{equation*}
    \sum_{k \in (\ZZ / m \ZZ)^\times} \chi(k) k = \frac{m}{\overline{\chi}(2) - 2} \sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k)
\end{equation*}
(Indeed, let $S = \sum_{k \in (\ZZ / m\ZZ)^\times} \chi(k) k$. Then
\begin{align*}
    S
    &= \sum_{k=1}^{\frac{m-1}{2}} \chi(2k) 2k + \sum_{k=\frac{m+1}{2}}^{m-1} \chi(2k) (2k-m)\\
    &= \sum_{k=1}^{m-1} \chi(2k) 2k - m \sum_{k=\frac{m+1}{2}}^{m-1} \chi(2k)\\
    &= 2 \chi(2) S + \chi(2) m \sum_{k=1}^{\frac{m-1}{2}} \chi(k)
\end{align*}
Rearranging gives the result.)

Putting this together,
\begin{theorem}\label{thm:7_26}
    Let $\chi$ be a primitive character mod $m \ge 3$. Then
    \begin{equation*}
        \abs{L(\chi, 1)} = \begin{cases}
            \displaystyle\frac{2}{\sqrt{m}} \Bigg\lvert\sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k) \log \sin \frac{k \pi}{m} \Bigg\rvert & \text{if } \chi \text{ is even} \\
            \displaystyle\frac{\pi}{\abs{2 - \chi(2)} \sqrt{m}} \Bigg\lvert\sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k)\Bigg\rvert & \text{if } \chi \text{ is odd}
        \end{cases}
    \end{equation*}
\end{theorem}

\subsubsection*{The Quadratic Case}
Let $K = \QQ(\sqrt{d})$, $d$ squarefree. Let $m = \abs{d_K}$. Then $K \subseteq \QQ(\zeta_m)$. By \autoref{thm:7_20}, we have\footnote{note that if $p \mid m$, then $p$ is ramified, so $f_p = r_p = 1$} $\rho = L(\chi, 1)$, where $\chi$ is the unique non-trivial character mod $m$ which corresponds to a character of $\Gal(K/\QQ)$. For $p \nmid m$,
\begin{equation*}
    \chi(p) = \begin{cases}
        1 & \text{if } p \text{ splits}\\
        -1 & \text{if } p \text{ is inert}
    \end{cases}
\end{equation*}
We define it for all $(m, n) = 1$ by extending multiplicatively. This $\chi$ is primitive mod $m$. It is even if $d > 0$ and odd if $d < 0$.

\begin{theorem}\label{thm:7_27}
    Let $K = \QQ(\sqrt{d})$, $d$ squarefree, $m = \abs{d_K}$. Then
    \begin{equation*}
        h_K = \frac{1}{\log \varepsilon} \Bigg\lvert \sum_{\substack{k \in (\ZZ / m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k) \log \sin \frac{k \pi}{m} \Bigg\rvert
    \end{equation*}
    if $d > 0$, where $\varepsilon$ is the fundamental unit, and
    \begin{equation*}
        h_K = \frac{1}{2 - \chi(2)} \Bigg\lvert \sum_{\substack{k \in (\ZZ/m\ZZ)^\times \\ k < \frac{m}{2}}} \chi(k) \Bigg\rvert
    \end{equation*}
    if $d < 0$ and $d \neq -1, -3$.
\end{theorem}
\begin{proof}
    Exercise.
\end{proof}

\begin{example}\label{eg:7_28}
    Let $d = -2$. Then $h_K = \frac{1}{2} \abs{\chi(1) + \chi(3)} = 1$.
\end{example}

\section{Density}

\subsection{Dirichlet Density}

Let $K$ be a number field.

\begin{definition}\label{def:8_1}
    Let $S$ be a set of prime ideals of $K$. Then the limit
    \begin{equation*}
        d(S) = \lim_{s \to 1^+} \frac{\sum_{\fp \in S} N(\fp)^{-s}}{\sum_{\fp} N(\fp)^{-s}}
    \end{equation*}
    provided it exists, is called the \emph{Dirichlet density} of $S$.
\end{definition}

This provides a way to measure the ratio of the set of primes in a set $S$ to the set of all (finite) primes.

For $\Re(s) \ge 1$,
\begin{equation*}
    \zeta_K(s) = \prod_{\fp} \frac{1}{1 - N(\fp)^{-s}}
\end{equation*}
so
\begin{equation*}
    \log \zeta_K(s) = \sum_{\fp} \sum_{n=1}^\infty \frac{1}{n N(\fp)^{ns}} = \sum_{\fp} \frac{1}{N(\fp)^s} + \sum_{\fp} \sum_{n=2}^\infty \frac{1}{n N(\fp)^s}
\end{equation*}
where the latter sum is analytic at $s=1$.

\begin{notation}\label{not:8_2}
    Let $f(s), g(s)$ be functions defined for (at least) $\Re(s) \ge 1$. Then we write $f(s) \sim g(s)$ if $f(s) - g(s)$ has a finite limit as $s$ approaches $1$ (in the common domain).
\end{notation}

We have $\log \zeta_K(s) \sim \sum_{\fp} \frac{1}{N(\fp)^s}$, now since $\zeta_K(s)$ has a simple pole at $s=1$, $\zeta_K(s) \sim \frac{\kappa}{s-1}$, so $\sum_{\fp} \frac{1}{N(\fp)^s} \sim \log \frac{1}{s-1}$, so we can also write $d(S) = \lim_{s \to 1^+} \frac{\sum_{\fp \in S} N(\fp)^{-s}}{\log \frac{1}{s-1}}$.

\begin{lemma}\label{lem:8_3}
    Dirichlet density has the following properties:
    \begin{enumerate}[label=\roman*)]
        \item $d(P) = 1$ if $P$ is the set of all prime ideals of $K$;
        \item if $S \subseteq T$, and $d(S)$ and $d(T)$ exist, then $d(S) \le d(T)$;
        \item if $d(S)$ exists, then $0 \le d(S) \le 1$;
        \item if $S$ and $T$ are disjoint, and $d(S)$ and $d(T)$ both exist, then $d(S \cup T) = d(S) + d(T)$;
        \item if $S$ is finite, then $d(S) = 0$;
        \item if $d(S)$ exists and if $T$ is different from $S$ by finitely many elements, then $d(S) = d(T)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Exercise.
\end{proof}

Recall a degree $1$ prime is a prime with residue field degree $1$ over $\QQ$, or equivalently a prime whose absolute norm $N(\fp)$ is prime.

\begin{lemma}\label{lem:8_4}
    The set $S$ of degree $1$ primes is infinite, and $d(S) = 1$.
\end{lemma}
\begin{proof}
    We have $\log \zeta_K(s) \sim \sum_{\fp} \frac{1}{N(\fp)^s} = \sum_{\fp \in S} \frac{1}{N(\fp)^s} + \sum_{\fp \notin S} \frac{1}{N(\fp)^s}$. If $\fp \notin S$, then $N(\fp) = p^f \ge p^2$. There are at most $[K : \QQ]$ prime ideals in $\cO_K$ having a power of a prime $p$ as norm. We have
    \begin{equation*}
        \abs{\sum_{\fp \notin S} \frac{1}{N(\fp)^s}} \le [K : \QQ] \sum_{\fp} \frac{1}{p^{2 \sigma}}
    \end{equation*}
    where $\sigma = \Re(s)$. The sum on the right is bounded at $s = 1$, so $\log \zeta_K(s) \sim \sum_{\fp \in S} \frac{1}{N(\fp)^s}$. We already saw $\log \zeta_K(s) \sim \sum_{\fp} \frac{1}{N(\fp)^s} \sim \log \frac{1}{s-1}$, so $\sum_{\fp \in S} \frac{1}{N(\fp)^s} \sim \log \frac{1}{s-1}$. Since $\log \frac{1}{1-s}$ is not bounded at $s=1$, the sum on the left must have infinitely many terms, and $d(S) = 1$.
\end{proof}

\subsection{Frobenius Density Theorem}

We will prove and use the Frobenius density theorem to prove the surjectivity of the Artin map, later we will see the Cebotarev density theorem.

Let $K$ be a number field and $L/K$ a Galois extension, and let $G = \Gal(L/K)$.

\begin{definition}\label{def:8_5}
    Let $\sigma \in G$ be an element of order $n$. Then the \emph{division} of $\sigma$ is the set of all elements of $G$ which is conjugate to some $\sigma^m$ for $m \in \ZZ$, $m$ relatively prime to $n$.
\end{definition}

\begin{lemma}\label{lem:8_6}
    Let $\sigma \in G$, $H = \langle \sigma \rangle$, and $t$ the number of elements in the division of $\sigma$. Then $t = \phi(n) [G : N_G(H)]$, where $\phi$ is the Euler totient function, and $N_G(H)$ is the normaliser of $H$ in $G$.
\end{lemma}

\begin{theorem}[Frobenius Density Theorem]\label{thm:8_7}
    Let $\sigma \in \Gal(L/K)$. Let $S$ be the set of primes $\fp$ of $K$ such that there is a prime $\cp$ in $L$ lying above it such that $\leg{L/K}{\cp}$ is in the division of $\sigma$, i.e. $\leg{L/K}{\cp}$ is conjugate to $\sigma^m$ for some $m$ relatively prime to the order of $\sigma$. Then $d(S) = \frac{t}{\abs{G}}$.
\end{theorem}

\noindent We will prove \autoref{lem:8_6} and \autoref{thm:8_7} later.

\begin{theorem}\label{thm:8_8}
    Let $L/K$ be abelian, and let $\fm$ be a modulus divisible by all ramified primes. Then $\Phi_\fm : I_K(\fm) \to \Gal(L/K)$ is surjective.
\end{theorem}
\begin{proof}
    Let $\sigma \in \Gal(L/K)$. Since $\Gal(L/K)$ is abelian, the division of $\sigma$ consists of the elements that generate the cyclic group $\langle \sigma \rangle$. By the Frobenius density theorem, there exists infinitely many primes $\cp$ of $L$ such that $\leg{L/K}{\cp}$ generates $\langle \sigma \rangle$. Let $\cp$ be any such prime such that $\fp = \cp \cap \cO_K$ is not contained in $\fm$ (which is possible by the definition of a modulus). Then $\Phi_\fm(\fp)$ is a generator of $\langle \sigma \rangle$. Thus $\sigma$ is in the image of $\Phi_\fm$.
\end{proof}

\begin{lemma}\label{lem:8_9}
    Let $S$ be a set of prime ideals of $K$ whose Dirichlet density exists, then $d(S) = d(S \cap \{\text{degree } 1 \text{ prime ideals}\})$.
\end{lemma}
\begin{proof}
    From the proof of \autoref{lem:8_4}, we have
    \begin{equation*}
        \sum_{\substack{\fp \in S \\ \text{degree} \neq 1}} N(\fp)^{-s} \sim 0
    \end{equation*}
    Then
    \begin{equation*}
        \sum_{\fp \in S} N(\fp)^{-s} \sim \sum_{\fp \in S \cap \{\text{degree } 1 \text{ primes}\}} N(\fp)^{-s}
    \end{equation*}
\end{proof}

Let $K$ be a number field, $L/K$ a Galois extension. Let $G = \Gal(L/K)$. Recall that if $G$ is a finite group, for any $g \in G$, the number of elements in its conjugacy class equals $[G : C_G(g)]$, where $C_G(g) = \{a \in G \mid ag=ga\}$ is the centraliser of $g$.

\begin{proof}[Proof of \autoref{lem:8_6}]
    For $(m, n)=1$, $C_G(\sigma) = C_G(\sigma^m)$, so $\sigma^m$ has $[G : C_G(\sigma)]$ conjugates, so as $m$ ranges over all integers between $1$ and $n$ relatively prime to $n$, then we count $\phi(n)[G : C_G(\sigma)]$ conjugates. They are not all distinct, we count an element $q$ times if it is conjugate to $q$ different powers $\sigma^m$. The number of distinct powers of $\sigma^m$ that are conjugate to $\sigma$ is the number of distinct automorphisms of $H$ induced by conjugation, i.e. $q = [N_G(H) : C_G(\sigma)]$, so $t = \frac{\phi(n) [G : C_G(\sigma)]}{[N_G(H) : C_G(\sigma)]} = \phi(n)[G : N_G(H)]$.
\end{proof}

\begin{proof}[Proof of \autoref{thm:8_7}]
    Let $S_1$ be the set $S$ in the statement.
    We proceed by induction on $n$, the order of $\sigma$.

    Suppose $n = 1$. Then $S_1$ is the set of primes of $K$ that split completely in $L$ (by \autoref{cor:1_7}). Let $S_L$ be the set of primes of $L$ that lie above some prime in $S_1$. Then each prime $p$ in $S_1$ has exactly $[L:K] = \abs{G}$ primes in $S_L$ lying above it, and any such prime has norm $\fp$, so we find
    \begin{equation*}
        \sum_{\cp \in S_L} N_{L/\QQ}(\cp)^{-s}
        = \sum_{\cp \in S_L} N_{K/\QQ}(N_{L/K}(\cp))^{-s}
        = \abs{G} \sum_{\fp \in S_1} N_{K/\QQ}(\fp)^{-s}
    \end{equation*}
    Let $S_L^1$ be the set of primes of $L$ having degree $1$ over $\QQ$, then $S_L^1 \subseteq S_L$. By \autoref{lem:8_4} and \autoref{lem:8_9}, $d(S_L) = d(S_L \cap S_L^1) = d(S_L^1) = 1$. Hence
    \begin{equation*}
        \abs{G} \sum_{\fp \in S_1} N_{K/\QQ}(\fp)^{-s} \sim \sum_{\cp \in S_L} N_{L/\QQ}(\cp)^{-s} \sim -\log(s-1)
    \end{equation*}
    and so $d(S_1) = \frac{1}{\abs{G}}$.

    Now assume $\sigma$ has order $n > 1$. For each divisor $d$ of $n$, let $t_d$ be the number of elements in the division of $\sigma^d$. Let $S_d$ be the set of primes of $K$ lying under some prime $\cp$ of $L$ whose Artin symbol belongs to the division of $\sigma^d$ ($S_1$ is the set we are interested in). By induction, for $1 \neq d \mid n$ we know that $d(S_d) = \frac{t_d}{\abs{G}}$.

    Let $E = L^H$, the subfield of $L$ fixed element-wise by $H = \langle \sigma \rangle$. The primes $\fp$ of $K$ which have at least one degree $1$ prime in $E$ lying above it are exactly those that lie under a prime $\fp \subseteq \cO_L$ such that $\leg{L/K}{\cp}$ is conjugate to some power of $\sigma$, so $\fp \in S_d$ for some $d \mid n$.

    Next let $S_E$ denote the primes of $E$ having inertial degree $1$ over $K$. For each $\fp \subseteq S_d$, let $n(\fp)$ be the number of primes in $S_E$ lying above $\fp$, so $\fp \in S_d$ is the norm of exactly $n(\fp)$ distinct primes in $S_E$. Since $S_E$ contains all the degree $1$ primes of $L$ over $\QQ$, $d(S_L) = 1$, so
    \begin{equation}\label{eqn:8_7_star}
        -\log(s-1) \sim \sum_{\cp_E \in S_E} N_{K/\QQ}(N_{E/K}(\cp_E))^{-s} = \sum_{d \mid n} \sum_{\fp \in S_d} \frac{n(\fp)}{N(\fp)^s}
    \end{equation}
    Note by Galois theory, for any $\fp \in S_d$, this $n(\fp)$ is exactly the number of distinct cosets $H \tau_i$ such that $H \tau_i \sigma^d = H \tau_i$ (exercise). This happens iff $\tau_i \sigma^d \tau_i^{-1} \in H$, but since $H$ is cyclic, this can only happen if $\tau_i \in N_G(\langle \sigma^d \rangle)$, so $[N_G(\langle \sigma^d \rangle) : H]$. Using the induction hypothesis for the sum over $S_d$ for $d \neq 1$ and rewriting \eqref{eqn:8_7_star} gives
    \begin{equation*}
        [N_G(H) : H] \sum_{\fp \in S_1} N(\fp)^{-s} \sim \left(-1 + \sum_{1 \neq d \mid n} \frac{[N_G(\langle \sigma^d \rangle) : H] t_d}{\abs{G}}\right) \log(s-1)
    \end{equation*}
    By \autoref{lem:8_6}, we can rewrite the coefficient on the right as
    \begin{align*}
        -1 + \sum_{1 \neq d \mid n} \frac{\phi(\frac{n}{d}) [G : N_G(\langle \sigma^d \rangle)] [N_G(\langle \sigma^d \rangle) : H]}{\abs{G}}
        &= -1 + \sum_{1 \neq d \mid n} \frac{\phi(\frac{n}{d}) [G : H]}{\abs{G}}\\
        &= -1 + \sum_{1 \neq d \mid n} \frac{1}{n} \phi\left(\frac{n}{d}\right)\\
        &= -1 - \frac{\phi(n)}{n} + \frac{1}{n} \sum_{d \mid n} \phi\left(\frac{n}{d}\right)
    \end{align*}
    we have the identity $\sum_{d \mid n} \phi\left(\frac{n}{d}\right) = n$, so the coefficient is $-1 - \frac{\phi(n)}{n} + \frac{1}{n} n = - \frac{\phi(n)}{n}$. This implies
    \begin{equation*}
        \sum_{\fp \in S_1} N(\fp)^{-s} \sim \frac{-\phi(n)}{n [N_G(H) : H]} \log(s-1) = -\frac{t}{\abs{G}} \log(s-1)
    \end{equation*}
    where the equality follows from \autoref{lem:8_6}. Thus $d(S_1) = \frac{t}{\abs{G}}$.
\end{proof}

\begin{corollary}\label{cor:8_10}
    Assume $\Gal(L/K)$ is cyclic of order $n$, and let $d \mid n$. Let $S_d$ be the set of prime ideals in $\cO_K$ having exactly $d$ primes lying above it in $\cO_L$. Then $S_d$ has Dirichlet density $\frac{\phi(n/d)}{n}$. In particular, there exists infinitely many primes of $\cO_K$ which remain prime in $\cO_L$.
\end{corollary}
\begin{proof}
    We ignore the finite set of primes of $K$ that ramify in $L$. A prime $\fp$ of $\cO_K$ has $d$ factors in $\cO_L$ iff $\sigma = \leg{L/K}{\cp}$ has order $\frac{n}{d}$. In a cyclic group, the number of such elements is $\phi\left(\frac{n}{d}\right)$. By Frobenius density theorem, $d(S_d) = \frac{\phi(n/d)}{n}$.
\end{proof}

\begin{theorem}\label{thm:8_11}
    Let $K$ be a number field, $\fm$ a modulus of $K$. Let $H$ be a congruence subgroup for $\fm$, i.e. $P_K(\fm) \subseteq H \subseteq I_K(\fm)$. Let $S$ be the set of prime ideals contained in $H$. If $S$ has a Dirichlet density, then $d(S) \le \frac{1}{[I_K(\fm):H]}$.
\end{theorem}
\noindent The proof uses characters of the group $I_K(\fm) / H$.

\begin{theorem}[First Fundamental Inequality of Class Field Theory]\label{thm:8_12}
    Let $L/K$ be a Galois extension, $\fm$ a modulus of $K$. Let $I_L(\fm)$ be the subgroup of $I_L$ generated by all primes $\cp$ of $L$ for which $\cp \cap \cO_K$ is in $I_K(\fm)$. Then
    \begin{equation*}
        [I_K(\fm) : N_{L/K}(I_L(\fm)) P_K(\fm)] \le [L:K]
    \end{equation*}
\end{theorem}
\begin{proof}
    Let $H = N_{L/K}(I_L(\fm)) P_K(\fm)$. Then except for a finite set of primes, the primes of $K$ that split completely in $L$ are in $N_{L/K}(I_L(\fm))$. The density of this set is $\frac{1}{[L:K]}$ by the Frobenius density theorem with $\sigma = 1$. By \autoref{thm:8_11}, we have $\frac{1}{[L:K]} \le \frac{1}{[I_K(\fm) : H]}$.
\end{proof}

\noindent The second fundamental inequality is
\begin{equation*}
    [I_K(\fm) : N_{L/K}(I_L(\fm)) P_K(\fm)] \ge [L : K]
\end{equation*}

\subsection{Chebotarev Density Theorem}
This is a refinement of the Frobenius density theorem.

\begin{theorem}[Chebotarev Density Theorem]\label{thm:8_13}
    Let $L/K$ be Galois, $G = \Gal(L/K)$. Fix $\sigma \in G$, and suppose that $\sigma$ has $c$ conjugates in $G$. Then the set of primes $\fp$ of $K$ which has a prime $\cp$ in $L$ lying above it such that $\leg{L/K}{\cp} = \sigma$ has density $\frac{c}{\abs{G}}$.
\end{theorem}

Note that the Chebotarev density theorem can be stated in two ways, either with the set $S = \{\fp \subseteq \cO_K \mid \leg{L/K}{\fp} = \{\text{conjugacy class of } \sigma\}\}$ or $S = \{\fp \subseteq \cO_K \mid \leg{L/K}{\cp} = \sigma \text{ for some prime } \cp \text{ in } \cO_L \text{ such that } \cp \mid \fp\}$. We implicitly assume that any $\fp \in S$ is unramified for the Artin symbol to make sense. The theorem then says that $d(S) = \frac{c}{\abs{G}}$.

\begin{corollary}\label{cor:8_14}
    Let $L/K$ be abelian, $\fm$ a modulus of $K$ divisible by all primes of $K$ that ramify in $L$, and let $\sigma \in G$. Then the set $S$ of primes $\fp \nmid \fm$ such that $\leg{L/K}{\fp} = \sigma$ has density $d(S) = \frac{1}{[L : K]}$, and $S$ is infinite.
\end{corollary}

\noindent Note that this also implies the surjectivity of the Artin map.

\begin{proposition}\label{prop:8_15}
    For any Galois extension $L/K$, there are infinity many primes of $L$ that split completely in $L$.
\end{proposition}
\begin{proof}
    Applying \autoref{thm:8_13} to $1 \in \Gal(L/K)$, the primes $\fp \subseteq \cO_K$ such that $\leg{L/K}{\fp} = 1$ has density $\frac{1}{[L:K]}$. The result follows since $\leg{L/K}{\fp} = 1$ iff $\fp$ splits completely in $L$.
\end{proof}

We will see next that the primes that split completely in $L$ characterise the extension $L/K$ uniquely.

\begin{notation}\label{not:8_16}
    Given two sets $S$ and $T$, say $S \subsetdot T$ if $S \subseteq T \cup \Sigma$ for some finite set $\Sigma$, and say $S \eqdot T$ if $S \subsetdot T$ and $T \subsetdot S$. Given any finite $L/K$, we set $S_{L/K} = \{\fp \subseteq \cO_K \mid \fp \text{ splits completely in } L\}$.
\end{notation}

\begin{theorem}\label{thm:8_17}
    Let $L$ and $M$ be Galois extensions of $K$, then
    \begin{enumerate}
        \item $L \subseteq M \iff S_{M/K} \subsetdot S_{L/K}$;
        \item $L = M \iff S_{M/K} \eqdot S_{L/K}$.
    \end{enumerate}
\end{theorem}

\begin{proposition}\label{prop:8_18}
    Let $L$ and $M$ be finite extensions of $K$.
    \begin{enumerate}[label=\roman*)]
        \item If $M$ is Galois over $K$, then $L \subseteq M \iff S_{M/K} \subsetdot S_{L/K}$.
        \item If $L$ is Galois over $K$, then $L \subseteq M \iff \widetilde{S}_{M/K} \subsetdot S_{L/K}$, where $\widetilde{S}_{M/K} = \{\fp \subseteq \cO_K \mid \fp \text{ unramified in } M \text{ and } f_{\cp / \fp} = 1 \text{ for some } \cp \text{ in } M\}$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    We first prove ii). When $L \subseteq M$ it is not too hard to show $\widetilde{S}_{M/K} \subsetdot S_{L/K}$ (exercise). Next assume $\widetilde{S}_{M/K} \subsetdot S_{L/K}$. Let $N$ be a Galois extension of $K$ containing both $L$ and $M$. To prove $L \subseteq M$, by Galois theory, it suffices to prove that $\Gal(N/M) \subseteq \Gal(N/L)$. Thus for any $\sigma \in \Gal(N/M)$, we need to show $\sigma \vert_L$ is the identity. By Chebotarev density theorem, there is a prime $\fp$ in $\cO_K$ (unramified in $N$) such that $\leg{N/K}{\cp}$ is the conjugacy class of $\sigma$. Hence there is a prime $\cp$ in $\cO_N$ containing $\fp$ such that $\leg{N/K}{\cp} = \sigma$. We claim $\fp \in S_{M/K}$. Let $\cp_M = \cp \cap \cO_M$. Then for $\alpha \in \cO_M$, we have $\alpha \equiv \sigma(\alpha) \equiv \alpha^{N(\fp)} \pmod{\cp_M}$. The first congruence holds since $\sigma \vert_M = 1$, and the second follows from the definition of the Artin symbol. This implies $\cO_M / \cp_M \cong \cO_K / \fp$, so that $f_{\cp_M / \fp} = 1$, so $\fp \in \widetilde{S}_{M/K}$. Now by Chebotarev density theorem, there are infinitely many such primes. Since we assumed $\widetilde{S}_{M/K} \subsetdot S_{L/K}$, this implies we can assume $\fp \in S_{L/K}$, i.e. $\leg{L/K}{\fp} = 1$. Since $\leg{L/K}{\fp} = \leg{N/K}{\cp} \vert_L$, and since $\sigma = \leg{N/K}{\cp}$, this implies $\sigma \vert_L = 1$.

    Now to prove i), first note $L \subseteq M$ implies $S_{M/K} \subsetdot S_{L/K}$ (exercise). Suppose $S_{M/K} \subsetdot S_{L/K}$, and let $L'$ be the Galois closure of $L$ over $K$.
    \begin{fact}
        A prime splits completely in $L$ iff it splits completely in $L'$.
    \end{fact}
    This means $S_{L/K} = S_{L'/K}$. Since $M$ is Galois over $K$, we have $\widetilde{S}_{M/K} = S_{M/K}$ (exercise). So we may rewrite our assumption $S_{M/K} \subsetdot S_{L/K}$ as $\widetilde{S}_{M/K} \subsetdot S_{L'/K}$. Hence by part ii), we obtain $L' \subseteq M$, and in particular $L \subseteq M$.
\end{proof}

It is now easy to prove \autoref{thm:8_17}.
\begin{proof}[Proof of \autoref{thm:8_17}]
    ii) follows from i).

    i) follows from \autoref{prop:8_18} (either part, since if $M$ is Galois over $K$, then $\widetilde{S}_{M/K} = S_{M/K}$).
\end{proof}

Now we complete the proof of \autoref{prop:3_10}:
\begin{proof}
    Since $\ff_{L/K} \mid \fm$, we know $P_K(\fm) \subseteq \ker \Phi_\fm \subseteq I_K(\fm)$. For any $\fa \in I_K(\fm)$, the corresponding $\leg{L/K}{\fa}$ only depends on the class of $\fa$ modulo $P_K(\fm)$. Now by the Chebotarev density theorem, for any $\sigma \in \Gal(K_\fm / K)$, there is a prime $\fp$ in $\cO_K$ such that $\leg{L/K}{\fp} = \sigma$. In fact, there are finitely many, so we can choose a prime $\fp$ such that $\fp \nmid \fm$. Since we have an isomorphism $I_K(\fm) / P_K(\fm) \cong \Gal(K_m / K)$, this implies that every $\fa \in I_K(\fm)$ is equivalent to a prime $\fp$ modulo $P_K(\fm)$. Now suppose $\fp \subseteq \cO_K$ is such that $\fp \in \ker(\Phi_\fm)$. Then $\leg{L/K}{\fp} = 1$, so $\fp$ splits completely in $L$. Thus if we have $\cp \subseteq \cO_L$ such that $\cp \mid \fp$, then $N_{L/K}(\cp) = \fp^{f_{\cp/\fp}} = \fp$ since $f_{\cp/\fp} = 1$. Hence $\fp \in N_{L/K}(I_L(\fm)) \subseteq N_{L/K}(I_L(\fm)) P_K(\fm)$.
\end{proof}

\section{Ideles and Adeles}

\subsection{Introduction}

Idele is a modification of the notion of ideal. The original term was `ideal element', abbreviated to idel. Adele was derived from the term `additive idele'.

Let $K$ be a number field. Recall from the Local Fields course that any absolute value is equivalent to either $\abs{\cdot}_\fp$, $\fp$ a nonzero prime ideal, or $\abs{\cdot}_\sigma$, $\sigma : K \hookrightarrow \RR, \CC$. Now let $\fp$ be a prime, infinite or finite. Let $K_\fp$ be the completion at $\fp$. This is either a $p$-adic field, or the reals or the complex field. For a non-archimedian valued field $F$, define the valuation ring of $F$ to be $\cO_K = \{x \in F \mid \abs{x} \le 1\}$. This is an open subring of $F$, and $\cO_F^\times = \{x \in F \mid \abs{x} = 1\}$.

To use local fields or valuation theory to study a number field $K$, it is useful to embed $K$ into all the completions $K_\fp$ simultaneously. However, $\prod_\fp K_\fp$ is not nice topologically (i.e. not locally compact). We make an adjustment to this.

\subsection{Restricted Product Topology}

\begin{definition}\label{def:9_1}
    Let $(X_i)$ be a family of topological spaces indexed by $i \in I$. Let $(U_i)$ be a family of open sets, $U_i \subseteq X_i$. Then the \emph{restricted product} $\rprod (X_i, U_i)$ is the topological space
    \begin{equation*}
        \rprod(X_i, U_i) = \{(x_i) \mid x_i \in U_i \text{ for almost all } i \in I\} \subseteq \prod X_i
    \end{equation*}
    with the basis of open sets
    \begin{equation*}
        \mathbb{B} = \left\{\prod V_i \mid V_i \subseteq X_i \text{ open for all } i \in I, \text{ and } V_i = U_i \text{ for almost all } i \in I\right\}
    \end{equation*}
\end{definition}
Note that this is in general not the same as the subspace topology it inherits from $\prod X_i$, it has more open sets. The restricted product is a generalisation of the direct product, they are the same iff $U_i = X_i$ for all $i \in I$.

\begin{proposition}\label{prop:9_2}
    Let $(X_i)_{i \in I}$ be a family of locally compact topological spaces and let $(U_i)_{i \in I}$ be a corresponding family of open subsets $U_i \subseteq X_i$, almost all of which are compact. Then the restricted product $X = \rprod(X_i, U_i)$ is locally compact.
\end{proposition}

\subsection{The Ring of Adeles}

\begin{definition}[Adele] An \emph{adele} of $K$ is a family $\alpha = (\alpha_\fp)$ of elements $\alpha_\fp \in K_\fp$ where $\fp$ runs through all primes of $K$, and $\alpha_\fp$ is integral in $K_\fp$ for almost all $\fp$.
\end{definition}
We write $\bA_K$ for the ring of adeles.
\begin{align*}
    \bA_k
    &= \left\{(\alpha_\fp) \in \prod_{\fp} K_\fp \mid \alpha_\fp \in \cO_{K_\fp} \text{ for almost all } \fp\right\}\\
    &= \rprod_{\fp} (K_\fp, \cO_{K_\fp})
\end{align*}

Note for finite $\fp$, $\cO_K$ is the valuation ring, while for infinite $\fp$, we set $\cO_{K_\fp} = K_\fp$.

This is a subset of $\prod_{\fp} K_\fp$. For each $\alpha \in \bA_K$ as above, we write $\alpha_\fp$ for its projection in $K_\fp$. We make $\bA_K$ a ring by defining addition and multiplication componentwise.

\begin{example}\label{eg:9_4}
    Let $K = \QQ$. Then $\bA_\QQ = \RR \times \{(\alpha_\fp) \in \prod_{p \nmid \infty} \QQ_p \mid \text{for almost all } p, \alpha_p \in \ZZ_p\} = \rprod_{\fp} (\QQ_p, \ZZ_p)$. Thus $\bA_\QQ$ is the union of the rings $\RR \times \prod_{p \in S} \QQ_p \times \prod_{p \notin S} \ZZ_p$ as $S$ varies over all finite set of primes. Alternately, $\bA_\QQ = \RR \times \{(\alpha_p) \in \prod_p \QQ_p \mid \abs{\alpha_p} \le 1 \text{ for almost all } p\}$.
\end{example}

\begin{proposition}\label{prop:9_5}
    The ring of adeles $\bA_K$ is locally compact and Hausdorff.
\end{proposition}
\begin{proof}
    Local compactness follows from \autoref{prop:9_2}, since all local fields $K_\fp$ are locally compact and all but finitely many $\cO_{K_f}$ are valuation rings of a non-archimedian local field, hence compact.

    Now $\prod_{\fp} K_\fp$ is Hausdorff, since each $K_\fp$ is Hausdorff. Since the topology on $\bA_K \subseteq \prod_{\fp} K_\fp$ is finer than the subspace topology, $\bA_K$ is also Hausdorff.
\end{proof}

Now for each finite set of primes $S$, we have the subring of $S$-adeles $\bA_{K,S} = \prod_{\fp \in S} K_\fp \times \prod_{\fp \notin S} \cO_{K_\fp}$. The canonical embeddings $K \hookrightarrow K_\fp$ induce a canonical embedding $K \hookrightarrow \bA_K$, $x \mapsto (x, x, \ldots)$. For each $x \in K$, we have $x \in \cO_{K_\fp}$ for all but finitely many $\fp$. The image of $K$ in $\bA_K$ is the subring of \emph{principal adeles}.

\subsection{The Idele Group}

This is the unit group of the ring of adeles $\bA_K$.

\begin{equation*}
    \bA_K^\times = \{(\alpha_\fp) \in \bA_K \mid \alpha_\fp \in K_\fp^\times \text{ for all } \fp, \alpha_\fp \in \cO_{K_\fp}^\times \text{ for almost all } \fp\}
\end{equation*}
As a subspace of $\bA_K$, $\bA_K^\times$ is not a topological group. We give it the restricted product topology.

\begin{definition}\label{def:9_6}
    The \emph{idele group} of $K$ is the topological group
    \begin{equation*}
        \II_K = \rprod_{\fp} (K_\fp^\times, \cO_{K_\fp}^\times)
    \end{equation*}
    with multiplication defined componentwise.
\end{definition}

\begin{proposition}\label{prop:9_7}
    The idele group $\II_K$ is locally compact and Hausdorff.
\end{proposition}
\begin{proof}
    Now $\II_K$ is Hausdorff since the topology is finer than the topology of $\bA_K^\times \subseteq \bA_K$, which is Hausdorff by \autoref{prop:9_5}. For each finite prime, the set $\cO_{K_\fp}^\times = \{x \in K_\fp \mid \abs{x}_\fp = 1\}$ is a closed subset of the compact set $\cO_{K_\fp}$, hence compact. This applies to almost all primes, and the $K_\fp^\times$ are all locally compact by \autoref{prop:9_2}. Thus $\rprod_\fp (K_\fp^\times, \cO_K^\times) = \II_K$ is locally compact.
\end{proof}

\end{document}
